<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- CodeMirror for the SQL editor -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/sql/sql.min.js"></script>

    <!-- Syntax Highlighter for examples page -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #1a1a1a;
        color: #e0e0e0;
        overflow: hidden;
      }
      .CodeMirror {
        font-family: "Fira Code", monospace;
        font-size: 14px;
        line-height: 21px;
        height: 100%;
        background-color: #1e1e1e;
      }
      .CodeMirror-gutters {
        background-color: #1e1e1e !important;
        border-right: 1px solid #3a3a3a;
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #2d2d2d;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #555;
        border-radius: 4px;
      }
      .resizer {
        background-color: #3a3a3a;
        cursor: col-resize;
        width: 5px;
        height: 100%;
        z-index: 10;
      }
      .mobile-nav-btn.active,
      .header-tab.active {
        color: #22c55e;
        border-bottom-color: #22c55e;
      }
      .mobile-nav-btn.active {
        border-top-color: #22c55e;
      }

      /* Responsive Layout Adjustments */
      @media (max-width: 768px) {
        #playground-view {
          flex-direction: column;
        }
        #left-panel,
        #right-panel {
          width: 100%;
          height: 100%;
        }
        .resizer {
          display: none;
        }
        #mobile-nav {
          display: flex;
        }

        #examples-view .max-w-4xl {
          max-width: 100%;
        }
        #examples-view pre {
          overflow-x: auto;
          white-space: pre;
        }
        #examples-view h1 {
          font-size: 1.5rem;
        }
        #examples-view h2 {
          font-size: 1.25rem;
        }
        #examples-view h3 {
          font-size: 1.1rem;
        }
        #examples-view p {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body class="flex flex-col h-screen">
    <header
      class="bg-[#282828] text-white flex items-center justify-between px-4 flex-shrink-0 border-b border-gray-700"
    >
      <div class="flex items-center gap-6">
        <h1 class="text-xl font-semibold text-gray-300 py-2">SQL Playground</h1>
        <div class="hidden sm:flex items-center gap-4">
          <button
            class="header-tab text-sm font-medium py-3 border-b-2"
            data-view="playground"
          >
            Playground
          </button>
          <button
            class="header-tab text-sm font-medium py-3 border-b-2 border-transparent text-gray-400"
            data-view="examples"
          >
            Examples
          </button>
        </div>
      </div>
      <div id="db-status" class="text-sm flex items-center gap-2">
        <div
          id="status-indicator"
          class="w-3 h-3 rounded-full bg-yellow-500 animate-pulse"
        ></div>
        <span id="status-text">Initializing DB...</span>
      </div>
    </header>

    <div id="playground-view" class="flex flex-grow overflow-hidden">
      <!-- Panels here -->
      <div id="left-panel" class="flex flex-col w-1/2 h-full bg-[#1e1e1e]">
        <div
          class="flex-shrink-0 bg-[#282828] p-2 flex justify-between items-center border-b border-gray-700"
        >
          <h2 class="font-semibold text-gray-200">SQL Editor</h2>
          <button
            id="run-query-btn"
            class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-1.5 rounded-md text-sm flex items-center gap-2 disabled:bg-gray-500 disabled:cursor-not-allowed"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"
              />
            </svg>
            Run
          </button>
        </div>
        <div class="flex-grow overflow-hidden">
          <textarea id="sql-editor"></textarea>
        </div>
      </div>
      <div id="resizer" class="resizer"></div>
      <div id="right-panel" class="flex flex-col w-1/2 h-full bg-[#252526]">
        <div class="flex-shrink-0 bg-[#282828] p-2 border-b border-gray-700">
          <div class="flex gap-2">
            <button
              id="schema-tab"
              class="schema-tab text-sm px-3 py-1 rounded border-b-2 border-transparent text-gray-400 hover:text-gray-200"
            >
              Schema
            </button>
            <button
              id="visualization-tab"
              class="schema-tab text-sm px-3 py-1 rounded border-b-2 border-transparent text-gray-400 hover:text-gray-200"
            >
              Visualization
            </button>
            <button
              id="output-tab"
              class="schema-tab active text-sm px-3 py-1 rounded border-b-2 border-blue-500 text-blue-400"
            >
              Output
            </button>
          </div>
        </div>
        <div
          id="schema-content"
          class="hidden flex-grow p-4 overflow-y-auto custom-scrollbar"
        >
          <div id="schema-viewer"></div>
        </div>
        <div
          id="visualization-content"
          class="hidden flex-grow p-4 overflow-y-auto custom-scrollbar"
        >
          <div id="database-visualization">
            <div class="mb-4">
              <h3 class="text-lg font-semibold text-gray-200 mb-2">
                Database Schema Visualization
              </h3>
              <p class="text-gray-400 text-sm">
                Visual representation of table relationships and structure.
              </p>
            </div>
            <div
              id="schema-diagram"
              class="bg-gray-800 rounded-lg p-4 min-h-[400px]"
            ></div>
          </div>
        </div>
        <div
          id="output-content"
          class="flex-grow p-4 overflow-y-auto custom-scrollbar"
        >
          <div class="flex-grow h-full flex flex-col">
            <div
              class="flex-shrink-0 bg-[#282828] p-2 border-b border-gray-700 mb-4"
            >
              <h2 class="font-semibold text-gray-200">Query Results</h2>
            </div>
            <div
              id="results-container"
              class="flex-grow overflow-auto custom-scrollbar"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="examples-view"
      class="hidden flex-grow overflow-y-auto custom-scrollbar p-6 sm:p-8"
    >
      <div class="max-w-6xl mx-auto pb-16">
        <h1 class="text-3xl font-bold mb-6 text-gray-100">
          DuckDB SQL Playground
        </h1>

        <section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-emerald-300"
          >
            Complete Table Definition & Constraints
          </h2>
          <p class="text-gray-400 mb-4">
            Comprehensive guide to creating tables with all types of constraints
            - column-level, table-level, and advanced options.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Column-level constraints
CREATE TABLE employees (
    -- Primary key constraint
    employee_id SERIAL PRIMARY KEY,
    
    -- NOT NULL constraint
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    
    -- UNIQUE constraint
    email VARCHAR(100) NOT NULL UNIQUE,
    social_security_number CHAR(11) UNIQUE,
    
    -- CHECK constraint
    age INTEGER CHECK (age >= 18 AND age <= 120),
    salary DECIMAL(10,2) CHECK (salary > 0),
    
    -- DEFAULT constraint
    hire_date DATE DEFAULT CURRENT_DATE,
    status VARCHAR(20) DEFAULT 'active',
    is_manager BOOLEAN DEFAULT false,
    
    -- Foreign key constraint
    department_id INTEGER REFERENCES departments(department_id),
    
    -- Multiple constraints on same column
    phone VARCHAR(15) NOT NULL CHECK (LENGTH(phone) >= 10)
);

-- Show the table structure
DESCRIBE employees;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  1. Column-Level Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Apply constraints directly to individual columns during CREATE
                  TABLE
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  column_name data_type PRIMARY KEY | UNIQUE | NOT NULL | CHECK
                  | DEFAULT
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Table-level constraints with named constraints
CREATE TABLE orders (
    order_id SERIAL,
    customer_id INTEGER NOT NULL,
    order_date DATE NOT NULL,
    ship_date DATE,
    total_amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) NOT NULL,
    discount_percent DECIMAL(5,2),
    
    -- Table-level PRIMARY KEY
    CONSTRAINT pk_orders PRIMARY KEY (order_id),
    
    -- Table-level FOREIGN KEY with actions
    CONSTRAINT fk_orders_customer 
        FOREIGN KEY (customer_id) 
        REFERENCES customers(customer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    
    -- Table-level CHECK constraints
    CONSTRAINT chk_order_amount CHECK (total_amount >= 0),
    CONSTRAINT chk_order_status CHECK (status IN ('pending', 'processing', 'shipped', 'delivered', 'cancelled')),
    CONSTRAINT chk_order_dates CHECK (ship_date IS NULL OR ship_date >= order_date),
    CONSTRAINT chk_discount CHECK (discount_percent IS NULL OR (discount_percent >= 0 AND discount_percent <= 100)),
    
    -- Table-level UNIQUE constraint
    CONSTRAINT uk_orders_customer_date UNIQUE (customer_id, order_date)
);

-- Composite primary key example
CREATE TABLE order_items (
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
    
    -- Composite primary key
    CONSTRAINT pk_order_items PRIMARY KEY (order_id, product_id),
    
    -- Multiple foreign keys
    CONSTRAINT fk_order_items_order FOREIGN KEY (order_id) REFERENCES orders(order_id) ON DELETE CASCADE,
    CONSTRAINT fk_order_items_product FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE RESTRICT
);"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  2. Table-Level Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Named constraints applied at table level with referential
                  actions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CONSTRAINT name PRIMARY KEY | FOREIGN KEY | CHECK | UNIQUE
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced constraint examples
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    sku VARCHAR(20) NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    category_id INTEGER,
    price DECIMAL(10,2) NOT NULL,
    cost DECIMAL(10,2) NOT NULL,
    weight DECIMAL(8,3),
    dimensions_length DECIMAL(8,2),
    dimensions_width DECIMAL(8,2),
    dimensions_height DECIMAL(8,2),
    stock_quantity INTEGER DEFAULT 0,
    reorder_level INTEGER DEFAULT 10,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    -- Complex CHECK constraints
    CONSTRAINT chk_product_price CHECK (price > cost),
    CONSTRAINT chk_product_dimensions CHECK (
        (dimensions_length IS NULL AND dimensions_width IS NULL AND dimensions_height IS NULL) OR
        (dimensions_length > 0 AND dimensions_width > 0 AND dimensions_height > 0)
    ),
    CONSTRAINT chk_stock_levels CHECK (stock_quantity >= 0 AND reorder_level >= 0),
    CONSTRAINT chk_weight CHECK (weight IS NULL OR weight > 0),
    
    -- UNIQUE constraints
    CONSTRAINT uk_product_sku UNIQUE (sku),
    
    -- Foreign key with specific actions
    CONSTRAINT fk_product_category 
        FOREIGN KEY (category_id) 
        REFERENCES categories(category_id) 
        ON DELETE SET NULL 
        ON UPDATE CASCADE
);

-- Self-referencing foreign key
CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    parent_category_id INTEGER,
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    
    -- Self-referencing foreign key
    CONSTRAINT fk_category_parent 
        FOREIGN KEY (parent_category_id) 
        REFERENCES categories(category_id) 
        ON DELETE SET NULL,
    
    -- Prevent self-reference
    CONSTRAINT chk_not_self_parent CHECK (category_id != parent_category_id),
    
    CONSTRAINT uk_category_name UNIQUE (name)
);"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  3. Advanced Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Complex CHECK constraints, self-referencing FKs, and
                  conditional logic
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Complex CHECK conditions, self-referencing FOREIGN KEY
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- All data types showcase
CREATE TABLE data_types_demo (
    -- Numeric types
    small_int SMALLINT,
    regular_int INTEGER,
    big_int BIGINT,
    decimal_fixed DECIMAL(10,2),
    numeric_type NUMERIC(15,4),
    real_number REAL,
    double_precision DOUBLE PRECISION,
    serial_id SERIAL,
    
    -- String types
    char_fixed CHAR(10),
    varchar_variable VARCHAR(255),
    text_unlimited TEXT,
    
    -- Date and time types
    date_only DATE,
    time_only TIME,
    timestamp_with_zone TIMESTAMPTZ,
    timestamp_without_zone TIMESTAMP,
    interval_type INTERVAL,
    
    -- Boolean type
    boolean_flag BOOLEAN,
    
    -- Binary data
    blob_data BLOB,
    
    -- Array types (DuckDB specific)
    integer_array INTEGER[],
    text_array TEXT[],
    
    -- JSON type (DuckDB specific)
    json_data JSON,
    
    -- UUID type
    uuid_field UUID,
    
    -- Enum type example
    status_enum VARCHAR(20) CHECK (status_enum IN ('active', 'inactive', 'pending', 'suspended')),
    
    PRIMARY KEY (serial_id),
    
    -- Constraints on different data types
    CONSTRAINT chk_positive_numbers CHECK (
        small_int IS NULL OR small_int > 0
    ),
    CONSTRAINT chk_date_range CHECK (
        date_only IS NULL OR date_only >= '2000-01-01'
    ),
    CONSTRAINT chk_text_length CHECK (
        LENGTH(text_unlimited) <= 1000
    )
);"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  4. Complete Data Types
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  All available data types in DuckDB with examples
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  INTEGER, VARCHAR, DATE, TIMESTAMP, BOOLEAN, ARRAY[], JSON,
                  UUID
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-orange-300"
          >
            Complete Constraint Examples
          </h2>
          <p class="text-gray-400 mb-4">
            Comprehensive guide to all SQL constraints with practical examples
            for every type.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- PRIMARY KEY Constraints - Column Level and Table Level
-- Column-level PRIMARY KEY
CREATE TABLE customers_pk_column (
    customer_id INTEGER PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    phone VARCHAR(20),
    registration_date DATE DEFAULT CURRENT_DATE,
    is_active BOOLEAN DEFAULT true
);

-- Table-level PRIMARY KEY (single column)
CREATE TABLE customers_pk_table (
    customer_id INTEGER,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    registration_date DATE DEFAULT CURRENT_DATE,
    is_active BOOLEAN DEFAULT true,
    CONSTRAINT pk_customers PRIMARY KEY (customer_id)
);

-- Composite PRIMARY KEY (multiple columns)
CREATE TABLE order_items_composite_pk (
    order_id INTEGER,
    product_id INTEGER,
    line_number INTEGER,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
    discount_percentage DECIMAL(5,2) DEFAULT 0 CHECK (discount_percentage BETWEEN 0 AND 100),
    line_total DECIMAL(10,2) GENERATED ALWAYS AS (quantity * unit_price * (1 - discount_percentage/100)) STORED,
    CONSTRAINT pk_order_items PRIMARY KEY (order_id, product_id, line_number)
);

-- AUTO INCREMENT PRIMARY KEY with explicit naming
CREATE TABLE products_auto_pk (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    sku VARCHAR(50) NOT NULL UNIQUE,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL CHECK (price > 0),
    cost DECIMAL(10,2) CHECK (cost >= 0 AND cost <= price),
    category_id INTEGER,
    supplier_id INTEGER,
    stock_quantity INTEGER DEFAULT 0 CHECK (stock_quantity >= 0),
    reorder_level INTEGER DEFAULT 10 CHECK (reorder_level >= 0),
    weight_kg DECIMAL(8,3) CHECK (weight_kg > 0),
    dimensions_cm VARCHAR(50),
    is_active BOOLEAN DEFAULT true,
    created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_date DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Test PRIMARY KEY constraints
INSERT INTO customers_pk_column (customer_id, first_name, last_name, email) VALUES 
(1, 'John', 'Doe', 'john.doe@example.com'),
(2, 'Jane', 'Smith', 'jane.smith@example.com');

-- This will fail - duplicate primary key
-- INSERT INTO customers_pk_column (customer_id, first_name, last_name, email) VALUES 
-- (1, 'Bob', 'Wilson', 'bob.wilson@example.com');

-- Test composite primary key
INSERT INTO order_items_composite_pk (order_id, product_id, line_number, quantity, unit_price) VALUES 
(1, 101, 1, 2, 25.99),
(1, 102, 2, 1, 15.50),
(1, 101, 3, 1, 25.99);  -- Same order_id and product_id but different line_number

-- This will fail - duplicate composite key
-- INSERT INTO order_items_composite_pk (order_id, product_id, line_number, quantity, unit_price) VALUES 
-- (1, 101, 1, 3, 22.99);"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  1. PRIMARY KEY Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Column-level, table-level, composite, and auto-increment
                  primary keys
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Column: id INTEGER PRIMARY KEY | Table: CONSTRAINT name
                  PRIMARY KEY (columns)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- FOREIGN KEY Constraints - All Variations
-- Basic FOREIGN KEY with different actions
CREATE TABLE categories_for_fk (
    category_id INTEGER PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    parent_category_id INTEGER,
    is_active BOOLEAN DEFAULT true,
    created_date DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- FOREIGN KEY with CASCADE DELETE
CREATE TABLE products_fk_cascade (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(200) NOT NULL,
    category_id INTEGER,
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT fk_products_category_cascade 
        FOREIGN KEY (category_id) 
        REFERENCES categories_for_fk(category_id) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE
);

-- FOREIGN KEY with SET NULL
CREATE TABLE products_fk_set_null (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(200) NOT NULL,
    category_id INTEGER,
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT fk_products_category_null 
        FOREIGN KEY (category_id) 
        REFERENCES categories_for_fk(category_id) 
        ON DELETE SET NULL 
        ON UPDATE SET NULL
);

-- FOREIGN KEY with RESTRICT (default behavior)
CREATE TABLE products_fk_restrict (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(200) NOT NULL,
    category_id INTEGER NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT fk_products_category_restrict 
        FOREIGN KEY (category_id) 
        REFERENCES categories_for_fk(category_id) 
        ON DELETE RESTRICT 
        ON UPDATE RESTRICT
);

-- FOREIGN KEY with SET DEFAULT
CREATE TABLE products_fk_set_default (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(200) NOT NULL,
    category_id INTEGER DEFAULT 1,
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT fk_products_category_default 
        FOREIGN KEY (category_id) 
        REFERENCES categories_for_fk(category_id) 
        ON DELETE SET DEFAULT 
        ON UPDATE SET DEFAULT
);

-- Self-referencing FOREIGN KEY (hierarchical data)
ALTER TABLE categories_for_fk 
ADD CONSTRAINT fk_categories_parent 
    FOREIGN KEY (parent_category_id) 
    REFERENCES categories_for_fk(category_id) 
    ON DELETE SET NULL;

-- Multiple FOREIGN KEYs in one table
CREATE TABLE order_items_multi_fk (
    order_item_id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
    discount_amount DECIMAL(10,2) DEFAULT 0 CHECK (discount_amount >= 0),
    tax_rate DECIMAL(5,4) DEFAULT 0.0825 CHECK (tax_rate >= 0 AND tax_rate <= 1),
    CONSTRAINT fk_order_items_order 
        FOREIGN KEY (order_id) 
        REFERENCES orders(order_id) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
    CONSTRAINT fk_order_items_product 
        FOREIGN KEY (product_id) 
        REFERENCES products_fk_cascade(product_id) 
        ON DELETE RESTRICT 
        ON UPDATE CASCADE
);

-- Test the FOREIGN KEY constraints
INSERT INTO categories_for_fk (category_id, name, description) VALUES 
(1, 'Electronics', 'Electronic devices and gadgets'),
(2, 'Books', 'Physical and digital books'),
(3, 'Clothing', 'Apparel and accessories'),
(4, 'Home & Garden', 'Items for home and garden'),
(5, 'Subcategory Electronics', 'Subcategory of electronics');

-- Update to create hierarchy
UPDATE categories_for_fk SET parent_category_id = 1 WHERE category_id = 5;

INSERT INTO products_fk_cascade (name, category_id, price) VALUES 
('Smartphone', 1, 599.99),
('Laptop', 1, 999.99),
('Novel Book', 2, 14.99);

-- Test CASCADE behavior
-- DELETE FROM categories_for_fk WHERE category_id = 1;  -- This would cascade delete related products

-- Test RESTRICT behavior  
INSERT INTO products_fk_restrict (name, category_id, price) VALUES 
('Tablet', 2, 299.99);
-- DELETE FROM categories_for_fk WHERE category_id = 2;  -- This would fail due to RESTRICT"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  2. FOREIGN KEY Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  CASCADE, SET NULL, RESTRICT, SET DEFAULT, and self-referencing
                  foreign keys
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  FOREIGN KEY (column) REFERENCES table(column) ON DELETE/UPDATE
                  action
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- UNIQUE Constraints - Column and Table Level
-- Column-level UNIQUE constraints
CREATE TABLE users_unique_demo (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    phone VARCHAR(20) UNIQUE,  -- Can be NULL but if provided must be unique
    social_security_number VARCHAR(11) UNIQUE,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    date_of_birth DATE,
    created_date DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Table-level UNIQUE constraints (composite unique)
CREATE TABLE user_profiles_composite_unique (
    profile_id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    platform VARCHAR(50) NOT NULL,
    platform_user_id VARCHAR(100) NOT NULL,
    profile_url VARCHAR(500),
    is_verified BOOLEAN DEFAULT false,
    follower_count INTEGER DEFAULT 0,
    created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uk_user_platform UNIQUE (user_id, platform),
    CONSTRAINT uk_platform_user_id UNIQUE (platform, platform_user_id),
    CONSTRAINT uk_profile_url UNIQUE (profile_url)
);

-- Multiple UNIQUE constraints on same table
CREATE TABLE products_multiple_unique (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    sku VARCHAR(50) NOT NULL,
    upc_code VARCHAR(12),
    isbn VARCHAR(13),
    model_number VARCHAR(100),
    name VARCHAR(200) NOT NULL,
    manufacturer_part_number VARCHAR(100),
    brand VARCHAR(100),
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT uk_products_sku UNIQUE (sku),
    CONSTRAINT uk_products_upc UNIQUE (upc_code),
    CONSTRAINT uk_products_isbn UNIQUE (isbn),
    CONSTRAINT uk_products_model UNIQUE (brand, model_number),
    CONSTRAINT uk_products_mpn UNIQUE (manufacturer_part_number)
);

-- Partial UNIQUE constraint (with WHERE clause - SQLite specific)
-- CREATE UNIQUE INDEX uk_active_users_email ON users_unique_demo(email) WHERE is_active = true;

-- Test UNIQUE constraints
INSERT INTO users_unique_demo (username, email, phone, first_name, last_name) VALUES 
('john_doe', 'john@example.com', '555-1234', 'John', 'Doe'),
('jane_smith', 'jane@example.com', '555-5678', 'Jane', 'Smith'),
('bob_wilson', 'bob@example.com', NULL, 'Bob', 'Wilson');  -- NULL phone is allowed

-- This will fail - duplicate username
-- INSERT INTO users_unique_demo (username, email, first_name, last_name) VALUES 
-- ('john_doe', 'john2@example.com', 'John', 'Doe');

-- This will fail - duplicate email
-- INSERT INTO users_unique_demo (username, email, first_name, last_name) VALUES 
-- ('john_doe2', 'john@example.com', 'John', 'Doe');

-- Test composite unique constraints
INSERT INTO user_profiles_composite_unique (user_id, platform, platform_user_id, profile_url) VALUES 
(1, 'Twitter', 'john_doe_twitter', 'https://twitter.com/john_doe'),
(1, 'LinkedIn', 'john_doe_linkedin', 'https://linkedin.com/in/john_doe'),
(2, 'Twitter', 'jane_smith_twitter', 'https://twitter.com/jane_smith');

-- This will fail - duplicate user_id + platform combination
-- INSERT INTO user_profiles_composite_unique (user_id, platform, platform_user_id) VALUES 
-- (1, 'Twitter', 'john_doe_twitter2');

-- Test multiple unique constraints on products
INSERT INTO products_multiple_unique (sku, upc_code, name, brand, model_number, price) VALUES 
('PHONE-001', '123456789012', 'Smartphone Pro', 'TechBrand', 'TB-SP-001', 699.99),
('LAPTOP-001', '123456789013', 'Laptop Ultra', 'TechBrand', 'TB-LU-001', 1299.99),
('BOOK-001', NULL, 'Programming Guide', 'BookPublisher', NULL, 49.99);

-- Show how to handle UNIQUE constraint violations
-- UPDATE users_unique_demo SET email = 'john@example.com' WHERE user_id = 2;  -- This would fail"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  3. UNIQUE Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Single column, composite, and multiple unique constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Column: email VARCHAR(100) UNIQUE | Table: CONSTRAINT name
                  UNIQUE (columns)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- CHECK Constraints - All Variations and Complex Examples
-- Column-level CHECK constraints
CREATE TABLE employees_check_demo (
    employee_id INTEGER PRIMARY KEY AUTOINCREMENT,
    first_name VARCHAR(50) NOT NULL CHECK (LENGTH(first_name) >= 2),
    last_name VARCHAR(50) NOT NULL CHECK (LENGTH(last_name) >= 2),
    email VARCHAR(100) NOT NULL CHECK (email LIKE '%@%.%' AND LENGTH(email) >= 5),
    age INTEGER CHECK (age >= 16 AND age <= 100),
    salary DECIMAL(10,2) CHECK (salary >= 0),
    hire_date DATE NOT NULL CHECK (hire_date >= DATE('1900-01-01') AND hire_date <= CURRENT_DATE),
    employment_status VARCHAR(20) CHECK (employment_status IN ('ACTIVE', 'INACTIVE', 'TERMINATED', 'ON_LEAVE')),
    department VARCHAR(50) NOT NULL,
    performance_rating DECIMAL(3,2) CHECK (performance_rating BETWEEN 1.0 AND 5.0),
    is_manager BOOLEAN DEFAULT false,
    phone VARCHAR(20) CHECK (phone IS NULL OR (LENGTH(phone) >= 10 AND phone NOT LIKE '%[^0-9()-. ]%')),
    emergency_contact_phone VARCHAR(20) CHECK (emergency_contact_phone IS NULL OR LENGTH(emergency_contact_phone) >= 10)
);

-- Table-level CHECK constraints (complex business rules)
CREATE TABLE orders_complex_check (
    order_id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    order_date DATE NOT NULL,
    ship_date DATE,
    delivery_date DATE,
    subtotal DECIMAL(10,2) NOT NULL,
    tax_amount DECIMAL(10,2) NOT NULL,
    shipping_cost DECIMAL(10,2) DEFAULT 0,
    discount_amount DECIMAL(10,2) DEFAULT 0,
    total_amount DECIMAL(10,2) NOT NULL,
    order_status VARCHAR(20) NOT NULL,
    priority_level VARCHAR(10),
    payment_method VARCHAR(20),
    shipping_method VARCHAR(30),
    
    -- Complex CHECK constraints
    CONSTRAINT chk_orders_dates CHECK (
        ship_date IS NULL OR ship_date >= order_date
    ),
    CONSTRAINT chk_orders_delivery_date CHECK (
        delivery_date IS NULL OR 
        (ship_date IS NOT NULL AND delivery_date >= ship_date) OR
        (ship_date IS NULL AND delivery_date >= order_date)
    ),
    CONSTRAINT chk_orders_amounts CHECK (
        subtotal >= 0 AND 
        tax_amount >= 0 AND 
        shipping_cost >= 0 AND 
        discount_amount >= 0 AND
        total_amount = subtotal + tax_amount + shipping_cost - discount_amount
    ),
    CONSTRAINT chk_orders_status CHECK (
        order_status IN ('PENDING', 'CONFIRMED', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED', 'RETURNED')
    ),
    CONSTRAINT chk_orders_priority CHECK (
        priority_level IN ('LOW', 'NORMAL', 'HIGH', 'URGENT') OR priority_level IS NULL
    ),
    CONSTRAINT chk_orders_payment CHECK (
        payment_method IN ('CREDIT_CARD', 'DEBIT_CARD', 'PAYPAL', 'BANK_TRANSFER', 'CASH', 'CHECK') OR payment_method IS NULL
    ),
    CONSTRAINT chk_orders_shipping_method CHECK (
        shipping_method IN ('STANDARD', 'EXPRESS', 'OVERNIGHT', 'SAME_DAY', 'PICKUP') OR shipping_method IS NULL
    ),
    CONSTRAINT chk_orders_business_rules CHECK (
        (order_status = 'SHIPPED' AND ship_date IS NOT NULL) OR order_status != 'SHIPPED'
    )
);

-- Advanced CHECK constraints with functions and complex logic
CREATE TABLE products_advanced_check (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    sku VARCHAR(50) NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    category VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    cost DECIMAL(10,2),
    weight_kg DECIMAL(8,3),
    dimensions_length_cm DECIMAL(6,2),
    dimensions_width_cm DECIMAL(6,2),
    dimensions_height_cm DECIMAL(6,2),
    stock_quantity INTEGER DEFAULT 0,
    reorder_level INTEGER DEFAULT 10,
    max_stock_level INTEGER DEFAULT 1000,
    expiry_date DATE,
    manufacture_date DATE,
    is_active BOOLEAN DEFAULT true,
    is_hazardous BOOLEAN DEFAULT false,
    
    -- Complex CHECK constraints
    CONSTRAINT chk_products_pricing CHECK (
        price > 0 AND 
        (cost IS NULL OR cost >= 0) AND 
        (cost IS NULL OR cost <= price)
    ),
    CONSTRAINT chk_products_sku_format CHECK (
        LENGTH(sku) >= 3 AND 
        sku NOT LIKE '% %' AND  -- No spaces
        UPPER(sku) = sku         -- Must be uppercase
    ),
    CONSTRAINT chk_products_dimensions CHECK (
        (weight_kg IS NULL OR weight_kg > 0) AND
        (dimensions_length_cm IS NULL OR dimensions_length_cm > 0) AND
        (dimensions_width_cm IS NULL OR dimensions_width_cm > 0) AND
        (dimensions_height_cm IS NULL OR dimensions_height_cm > 0)
    ),
    CONSTRAINT chk_products_stock_levels CHECK (
        stock_quantity >= 0 AND
        reorder_level >= 0 AND
        max_stock_level > reorder_level AND
        stock_quantity <= max_stock_level
    ),
    CONSTRAINT chk_products_dates CHECK (
        (expiry_date IS NULL OR expiry_date > CURRENT_DATE) AND
        (manufacture_date IS NULL OR manufacture_date <= CURRENT_DATE) AND
        (expiry_date IS NULL OR manufacture_date IS NULL OR expiry_date > manufacture_date)
    ),
    CONSTRAINT chk_products_category_specific CHECK (
        (category != 'FOOD' OR expiry_date IS NOT NULL) AND
        (category != 'ELECTRONICS' OR weight_kg IS NOT NULL)
    )
);

-- Test CHECK constraints
INSERT INTO employees_check_demo (
    first_name, last_name, email, age, salary, hire_date, 
    employment_status, department, performance_rating, phone
) VALUES 
('John', 'Smith', 'john.smith@company.com', 30, 75000.00, '2023-01-15', 
 'ACTIVE', 'Engineering', 4.2, '555-123-4567'),
('Sarah', 'Johnson', 'sarah.j@company.com', 28, 68000.00, '2023-03-01', 
 'ACTIVE', 'Marketing', 3.8, NULL);

-- This will fail - age too young
-- INSERT INTO employees_check_demo (first_name, last_name, email, age, salary, hire_date, employment_status, department) 
-- VALUES ('Young', 'Person', 'young@company.com', 15, 50000, '2023-01-01', 'ACTIVE', 'Engineering');

-- Test complex order constraints
INSERT INTO orders_complex_check (
    customer_id, order_date, subtotal, tax_amount, shipping_cost, 
    discount_amount, total_amount, order_status, priority_level, payment_method
) VALUES 
(1, CURRENT_DATE, 100.00, 8.25, 5.99, 10.00, 104.24, 'PENDING', 'NORMAL', 'CREDIT_CARD');

-- This will fail - total doesn't match calculation
-- INSERT INTO orders_complex_check (customer_id, order_date, subtotal, tax_amount, total_amount, order_status) 
-- VALUES (1, CURRENT_DATE, 100.00, 8.25, 200.00, 'PENDING');

-- Test product constraints
INSERT INTO products_advanced_check (
    sku, name, category, price, cost, weight_kg, stock_quantity, 
    reorder_level, max_stock_level, manufacture_date
) VALUES 
('ELEC-001', 'Smartphone', 'ELECTRONICS', 599.99, 300.00, 0.18, 50, 10, 200, '2024-01-01'),
('FOOD-001', 'Organic Milk', 'FOOD', 4.99, 2.50, 1.0, 24, 5, 100, '2024-08-20');

-- Update expiry date for food item (required by constraint)
UPDATE products_advanced_check 
SET expiry_date = DATE(manufacture_date, '+30 days') 
WHERE category = 'FOOD';"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  4. CHECK Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Column-level, table-level, and complex business rule
                  constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CHECK (condition) | CONSTRAINT name CHECK (complex_conditions)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- NOT NULL Constraints and Default Values
-- Various NOT NULL scenarios
CREATE TABLE customer_profiles_not_null (
    profile_id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),  -- Optional field (can be NULL)
    date_of_birth DATE,  -- Optional
    gender VARCHAR(10) CHECK (gender IN ('MALE', 'FEMALE', 'OTHER', 'PREFER_NOT_TO_SAY') OR gender IS NULL),
    address_line1 VARCHAR(200) NOT NULL,
    address_line2 VARCHAR(200),  -- Optional
    city VARCHAR(100) NOT NULL,
    state_province VARCHAR(100),  -- Optional for international addresses
    postal_code VARCHAR(20) NOT NULL,
    country VARCHAR(100) NOT NULL DEFAULT 'United States',
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_login_date DATETIME,  -- Optional
    is_email_verified BOOLEAN NOT NULL DEFAULT false,
    is_phone_verified BOOLEAN NOT NULL DEFAULT false,
    marketing_opt_in BOOLEAN NOT NULL DEFAULT false,
    account_status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' CHECK (account_status IN ('ACTIVE', 'SUSPENDED', 'CLOSED')),
    preferred_language VARCHAR(10) NOT NULL DEFAULT 'en' CHECK (preferred_language IN ('en', 'es', 'fr', 'de', 'zh', 'ja')),
    timezone VARCHAR(50) NOT NULL DEFAULT 'UTC'
);

-- Comprehensive DEFAULT values examples
CREATE TABLE orders_with_defaults (
    order_id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    order_number VARCHAR(50) NOT NULL DEFAULT ('ORD-' || strftime('%Y%m%d%H%M%S', 'now')),
    order_date DATE NOT NULL DEFAULT CURRENT_DATE,
    order_time TIME NOT NULL DEFAULT CURRENT_TIME,
    order_timestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    priority VARCHAR(10) NOT NULL DEFAULT 'NORMAL',
    subtotal DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    tax_rate DECIMAL(5,4) NOT NULL DEFAULT 0.0825,  -- 8.25% default tax
    tax_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    shipping_cost DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    discount_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    total_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    currency_code VARCHAR(3) NOT NULL DEFAULT 'USD',
    payment_status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    shipping_method VARCHAR(30) DEFAULT 'STANDARD',
    estimated_delivery_date DATE,
    notes TEXT,
    created_by INTEGER NOT NULL DEFAULT 1,  -- System user ID
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT chk_orders_status CHECK (status IN ('PENDING', 'CONFIRMED', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED')),
    CONSTRAINT chk_orders_priority CHECK (priority IN ('LOW', 'NORMAL', 'HIGH', 'URGENT')),
    CONSTRAINT chk_orders_payment_status CHECK (payment_status IN ('PENDING', 'AUTHORIZED', 'CAPTURED', 'FAILED', 'REFUNDED'))
);

-- Calculated/Computed DEFAULT values
CREATE TABLE products_calculated_defaults (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,
    sku VARCHAR(50) NOT NULL DEFAULT ('SKU-' || strftime('%Y%m%d%H%M%S', 'now')),
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    cost DECIMAL(10,2),
    markup_percentage DECIMAL(5,2) DEFAULT 50.00,  -- 50% markup
    suggested_retail_price DECIMAL(10,2),  -- Will be calculated
    category_id INTEGER NOT NULL DEFAULT 1,
    brand VARCHAR(100) DEFAULT 'Generic',
    weight_kg DECIMAL(8,3) DEFAULT 0.000,
    stock_quantity INTEGER NOT NULL DEFAULT 0,
    reorder_level INTEGER NOT NULL DEFAULT 10,
    max_stock_level INTEGER NOT NULL DEFAULT 1000,
    is_active BOOLEAN NOT NULL DEFAULT true,
    is_featured BOOLEAN NOT NULL DEFAULT false,
    is_on_sale BOOLEAN NOT NULL DEFAULT false,
    sale_price DECIMAL(10,2),
    sale_start_date DATE,
    sale_end_date DATE,
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER NOT NULL DEFAULT 1,
    
    -- Constraints involving NOT NULL and DEFAULT combinations
    CONSTRAINT chk_products_markup CHECK (markup_percentage >= 0),
    CONSTRAINT chk_products_sale CHECK (
        (is_on_sale = false) OR 
        (is_on_sale = true AND sale_price IS NOT NULL AND sale_price > 0 AND sale_price < price)
    ),
    CONSTRAINT chk_products_sale_dates CHECK (
        (sale_start_date IS NULL AND sale_end_date IS NULL) OR
        (sale_start_date IS NOT NULL AND sale_end_date IS NOT NULL AND sale_end_date >= sale_start_date)
    )
);

-- Test NOT NULL and DEFAULT constraints
INSERT INTO customer_profiles_not_null (
    customer_id, first_name, last_name, email, address_line1, city, postal_code
) VALUES 
(1, 'John', 'Doe', 'john.doe@example.com', '123 Main St', 'Anytown', '12345');

-- This will use many default values
INSERT INTO customer_profiles_not_null (
    customer_id, first_name, last_name, email, address_line1, city, postal_code, phone, date_of_birth
) VALUES 
(2, 'Jane', 'Smith', 'jane.smith@example.com', '456 Oak Ave', 'Another City', '67890', '555-1234', '1990-05-15');

-- This will fail - missing required NOT NULL field
-- INSERT INTO customer_profiles_not_null (customer_id, first_name, email, address_line1, city, postal_code) 
-- VALUES (3, 'Bob', 'bob@example.com', '789 Pine St', 'Some City', '11111');  -- Missing last_name

-- Test orders with defaults
INSERT INTO orders_with_defaults (customer_id) VALUES (1);  -- Most fields will use defaults

INSERT INTO orders_with_defaults (customer_id, status, priority, subtotal, notes) VALUES 
(2, 'CONFIRMED', 'HIGH', 150.00, 'Rush order for important client');

-- Test products with calculated values
INSERT INTO products_calculated_defaults (name, price, cost) VALUES 
('Test Product 1', 29.99, 15.00);

INSERT INTO products_calculated_defaults (
    name, price, cost, category_id, brand, is_featured, is_on_sale, sale_price
) VALUES 
('Premium Product', 199.99, 80.00, 2, 'Premium Brand', true, true, 149.99);

-- Show how to update DEFAULT values
UPDATE products_calculated_defaults 
SET suggested_retail_price = price * (1 + markup_percentage/100)
WHERE suggested_retail_price IS NULL;

-- Demonstrate handling NULL vs NOT NULL in queries
SELECT 
    profile_id,
    first_name,
    last_name,
    email,
    COALESCE(phone, 'Not Provided') AS phone_display,
    COALESCE(date_of_birth, '1900-01-01') AS birth_date_display,
    country,
    account_status,
    CASE 
        WHEN last_login_date IS NULL THEN 'Never Logged In'
        ELSE 'Last Login: ' || last_login_date
    END AS login_status
FROM customer_profiles_not_null
ORDER BY profile_id;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  5. NOT NULL and DEFAULT Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Required fields, default values, and calculated defaults
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  column_name TYPE NOT NULL DEFAULT value
                </div>
              </button>
            </div>
          </div>
        
</section>
<section id="constraints" class="mb-12 scroll-mt-20">
          <h2
            class="text-3xl font-bold border-b border-gray-600 pb-3 mb-6 text-red-300"
          >
            Constraints - Data Integrity
          </h2>
          <p class="text-gray-400 mb-6">
            Complete guide to table-level and column-level constraints for
            maintaining data integrity and business rules.
          </p>

          <div class="space-y-8">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- PRIMARY KEY Constraints
-- Column-level primary key (single column)
CREATE TABLE customers_pk_demo (
    customer_id INTEGER PRIMARY KEY,  -- Column-level primary key
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT UNIQUE
);

-- Table-level primary key (single column)
CREATE TABLE customers_pk_table_demo (
    customer_id INTEGER,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT,
    CONSTRAINT pk_customers PRIMARY KEY (customer_id)  -- Table-level primary key
);

-- Composite primary key (multiple columns) - Table-level only
CREATE TABLE order_items_pk_demo (
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT pk_order_items PRIMARY KEY (order_id, product_id)  -- Composite primary key
);

-- Primary key with auto-increment (SQLite AUTOINCREMENT)
CREATE TABLE products_pk_auto_demo (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,  -- Auto-incrementing primary key
    name TEXT NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Primary key examples and rules:
-- 1. Each table can have only ONE primary key
-- 2. Primary key columns cannot be NULL
-- 3. Primary key values must be unique
-- 4. Primary key automatically creates a unique index

-- Insert test data to demonstrate primary key constraints
INSERT INTO customers_pk_demo VALUES (1, 'John', 'Doe', 'john@example.com');
INSERT INTO customers_pk_demo VALUES (2, 'Jane', 'Smith', 'jane@example.com');

-- This will fail - duplicate primary key
-- INSERT INTO customers_pk_demo VALUES (1, 'Bob', 'Johnson', 'bob@example.com');

-- This will fail - NULL primary key
-- INSERT INTO customers_pk_demo VALUES (NULL, 'Alice', 'Brown', 'alice@example.com');

-- Composite primary key examples
INSERT INTO order_items_pk_demo VALUES (1, 101, 2, 25.99);
INSERT INTO order_items_pk_demo VALUES (1, 102, 1, 15.50);
INSERT INTO order_items_pk_demo VALUES (2, 101, 3, 25.99);

-- This will fail - duplicate composite key
-- INSERT INTO order_items_pk_demo VALUES (1, 101, 5, 30.00);"
              >
                <h3 class="text-xl font-semibold text-red-400 mb-3">
                  1. PRIMARY KEY Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Single column, composite, and auto-increment primary keys
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Column: id INTEGER PRIMARY KEY | Table: CONSTRAINT pk_name
                  PRIMARY KEY (col1, col2)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- FOREIGN KEY Constraints
-- Column-level foreign key
CREATE TABLE orders_fk_demo (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER REFERENCES customers_pk_demo(customer_id),  -- Column-level FK
    order_date DATE NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL
);

-- Table-level foreign key with explicit constraint name
CREATE TABLE order_items_fk_demo (
    item_id INTEGER PRIMARY KEY,
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    CONSTRAINT fk_order_items_order FOREIGN KEY (order_id) REFERENCES orders_fk_demo(order_id),
    CONSTRAINT fk_order_items_product FOREIGN KEY (product_id) REFERENCES products_pk_auto_demo(product_id)
);

-- Foreign key with ON DELETE and ON UPDATE actions
CREATE TABLE customer_addresses_fk_demo (
    address_id INTEGER PRIMARY KEY,
    customer_id INTEGER,
    address_type TEXT NOT NULL,  -- 'billing', 'shipping'
    street TEXT NOT NULL,
    city TEXT NOT NULL,
    country TEXT NOT NULL,
    CONSTRAINT fk_addresses_customer FOREIGN KEY (customer_id) 
        REFERENCES customers_pk_demo(customer_id)
        ON DELETE CASCADE  -- Delete addresses when customer is deleted
        ON UPDATE CASCADE  -- Update customer_id when parent customer_id changes
);

-- Self-referencing foreign key (hierarchical data)
CREATE TABLE categories_hierarchy_demo (
    category_id INTEGER PRIMARY KEY,
    category_name TEXT NOT NULL,
    parent_category_id INTEGER,
    CONSTRAINT fk_categories_parent FOREIGN KEY (parent_category_id) 
        REFERENCES categories_hierarchy_demo(category_id)
        ON DELETE SET NULL  -- Set parent to NULL if parent category is deleted
);

-- Multiple foreign keys in one table
CREATE TABLE employee_projects_demo (
    assignment_id INTEGER PRIMARY KEY,
    employee_id INTEGER,
    project_id INTEGER,
    manager_id INTEGER,
    start_date DATE NOT NULL,
    end_date DATE,
    CONSTRAINT fk_assignment_employee FOREIGN KEY (employee_id) REFERENCES employees_demo(employee_id),
    CONSTRAINT fk_assignment_project FOREIGN KEY (project_id) REFERENCES projects_demo(project_id),
    CONSTRAINT fk_assignment_manager FOREIGN KEY (manager_id) REFERENCES employees_demo(employee_id)
);

-- Foreign key referential actions:
-- ON DELETE CASCADE: Delete child records when parent is deleted
-- ON DELETE SET NULL: Set foreign key to NULL when parent is deleted
-- ON DELETE RESTRICT: Prevent deletion of parent if children exist
-- ON DELETE SET DEFAULT: Set foreign key to default value when parent is deleted
-- ON UPDATE CASCADE: Update foreign key when parent key changes
-- ON UPDATE SET NULL: Set foreign key to NULL when parent key changes
-- ON UPDATE RESTRICT: Prevent update of parent key if children exist

-- Insert test data to demonstrate foreign key constraints
INSERT INTO orders_fk_demo VALUES (1, 1, '2024-01-15', 150.75);
INSERT INTO orders_fk_demo VALUES (2, 2, '2024-01-16', 89.50);

-- This will fail - foreign key violation (customer_id 999 doesn't exist)
-- INSERT INTO orders_fk_demo VALUES (3, 999, '2024-01-17', 200.00);

-- Demonstrate CASCADE behavior
INSERT INTO customer_addresses_fk_demo VALUES 
(1, 1, 'billing', '123 Main St', 'New York', 'USA'),
(2, 1, 'shipping', '456 Oak Ave', 'New York', 'USA'),
(3, 2, 'billing', '789 Pine St', 'Los Angeles', 'USA');

-- Check addresses before deletion
SELECT * FROM customer_addresses_fk_demo;

-- Delete customer (will cascade to addresses if ON DELETE CASCADE is enabled)
-- DELETE FROM customers_pk_demo WHERE customer_id = 1;"
              >
                <h3 class="text-xl font-semibold text-red-400 mb-3">
                  2. FOREIGN KEY Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Column-level and table-level foreign keys with referential
                  actions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Column: REFERENCES table(col) | Table: FOREIGN KEY (col)
                  REFERENCES table(col) ON DELETE CASCADE
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- UNIQUE Constraints
-- Column-level unique constraint
CREATE TABLE users_unique_demo (
    user_id INTEGER PRIMARY KEY,
    username TEXT UNIQUE,  -- Column-level unique
    email TEXT UNIQUE,     -- Column-level unique
    phone TEXT,
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table-level unique constraint with explicit name
CREATE TABLE products_unique_demo (
    product_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    sku TEXT NOT NULL,
    barcode TEXT,
    category_id INTEGER,
    CONSTRAINT uk_products_sku UNIQUE (sku),           -- Table-level unique
    CONSTRAINT uk_products_barcode UNIQUE (barcode)    -- Table-level unique
);

-- Composite unique constraint (multiple columns together must be unique)
CREATE TABLE course_enrollments_demo (
    enrollment_id INTEGER PRIMARY KEY,
    student_id INTEGER NOT NULL,
    course_id INTEGER NOT NULL,
    semester TEXT NOT NULL,
    year INTEGER NOT NULL,
    grade TEXT,
    -- Student can only enroll in same course once per semester/year
    CONSTRAINT uk_enrollment_student_course_term UNIQUE (student_id, course_id, semester, year)
);

-- Multiple unique constraints on same table
CREATE TABLE social_accounts_demo (
    account_id INTEGER PRIMARY KEY,
    user_id INTEGER NOT NULL,
    platform TEXT NOT NULL,  -- 'twitter', 'facebook', 'instagram'
    platform_username TEXT NOT NULL,
    platform_user_id TEXT,
    is_verified BOOLEAN DEFAULT FALSE,
    -- Each user can have only one account per platform
    CONSTRAINT uk_social_user_platform UNIQUE (user_id, platform),
    -- Platform username must be unique within each platform
    CONSTRAINT uk_social_platform_username UNIQUE (platform, platform_username),
    -- Platform user ID must be unique within each platform
    CONSTRAINT uk_social_platform_user_id UNIQUE (platform, platform_user_id)
);

-- Unique constraint with NULL handling
-- Note: In SQLite, NULL values are considered unique (multiple NULLs allowed)
CREATE TABLE employee_ssn_demo (
    employee_id INTEGER PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    ssn TEXT UNIQUE,  -- Can have multiple NULLs but all non-NULL values must be unique
    employee_number TEXT UNIQUE NOT NULL  -- Cannot be NULL and must be unique
);

-- Insert test data to demonstrate unique constraints
INSERT INTO users_unique_demo (username, email, phone) VALUES 
('john_doe', 'john@example.com', '555-0001'),
('jane_smith', 'jane@example.com', '555-0002'),
('bob_wilson', 'bob@example.com', NULL);

-- This will fail - duplicate username
-- INSERT INTO users_unique_demo (username, email) VALUES ('john_doe', 'john2@example.com');

-- This will fail - duplicate email
-- INSERT INTO users_unique_demo (username, email) VALUES ('john_doe2', 'john@example.com');

-- Composite unique constraint examples
INSERT INTO course_enrollments_demo VALUES
(1, 101, 201, 'Fall', 2024, 'A'),
(2, 101, 202, 'Fall', 2024, 'B'),
(3, 102, 201, 'Fall', 2024, 'A'),
(4, 101, 201, 'Spring', 2025, NULL);  -- Same student/course but different semester - OK

-- This will fail - duplicate composite unique constraint
-- INSERT INTO course_enrollments_demo VALUES (5, 101, 201, 'Fall', 2024, 'B');

-- Multiple NULLs are allowed for unique columns
INSERT INTO employee_ssn_demo VALUES
(1, 'John', 'Doe', '123-45-6789', 'EMP001'),
(2, 'Jane', 'Smith', NULL, 'EMP002'),         -- NULL SSN is OK
(3, 'Bob', 'Johnson', NULL, 'EMP003'),        -- Another NULL SSN is OK
(4, 'Alice', 'Brown', '987-65-4321', 'EMP004');

-- This will fail - duplicate SSN
-- INSERT INTO employee_ssn_demo VALUES (5, 'Charlie', 'Wilson', '123-45-6789', 'EMP005');"
              >
                <h3 class="text-xl font-semibold text-red-400 mb-3">
                  3. UNIQUE Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Single column, composite, and multiple unique constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Column: email TEXT UNIQUE | Table: CONSTRAINT uk_name UNIQUE
                  (col1, col2)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- NOT NULL and CHECK Constraints
-- NOT NULL constraints (column-level only)
CREATE TABLE customers_notnull_demo (
    customer_id INTEGER PRIMARY KEY,
    first_name TEXT NOT NULL,      -- Cannot be NULL
    last_name TEXT NOT NULL,       -- Cannot be NULL
    email TEXT NOT NULL UNIQUE,    -- Cannot be NULL and must be unique
    phone TEXT,                    -- Can be NULL
    birth_date DATE,               -- Can be NULL
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL  -- Default + NOT NULL
);

-- CHECK constraints - Column-level
CREATE TABLE products_check_demo (
    product_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    price DECIMAL(10,2) NOT NULL CHECK (price > 0),           -- Column-level CHECK
    discount_percent INTEGER CHECK (discount_percent BETWEEN 0 AND 100),  -- Column-level CHECK
    stock_quantity INTEGER NOT NULL CHECK (stock_quantity >= 0),  -- Column-level CHECK
    category TEXT CHECK (category IN ('Electronics', 'Clothing', 'Books', 'Home'))  -- Column-level CHECK
);

-- CHECK constraints - Table-level with complex conditions
CREATE TABLE orders_check_demo (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER NOT NULL,
    order_date DATE NOT NULL,
    ship_date DATE,
    order_total DECIMAL(10,2) NOT NULL,
    discount_amount DECIMAL(10,2) DEFAULT 0,
    tax_amount DECIMAL(10,2) NOT NULL,
    status TEXT NOT NULL,
    -- Table-level CHECK constraints
    CONSTRAINT chk_order_total CHECK (order_total > 0),
    CONSTRAINT chk_discount CHECK (discount_amount >= 0 AND discount_amount <= order_total),
    CONSTRAINT chk_tax CHECK (tax_amount >= 0),
    CONSTRAINT chk_ship_date CHECK (ship_date IS NULL OR ship_date >= order_date),
    CONSTRAINT chk_status CHECK (status IN ('pending', 'processing', 'shipped', 'delivered', 'cancelled')),
    CONSTRAINT chk_final_amount CHECK (order_total - discount_amount + tax_amount > 0)
);

-- Complex CHECK constraints with multiple conditions
CREATE TABLE employees_check_demo (
    employee_id INTEGER PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT NOT NULL UNIQUE,
    hire_date DATE NOT NULL,
    birth_date DATE,
    salary DECIMAL(10,2),
    department TEXT NOT NULL,
    employment_type TEXT NOT NULL,
    -- Complex table-level CHECK constraints
    CONSTRAINT chk_employee_age CHECK (
        birth_date IS NULL OR 
        (JULIANDAY('now') - JULIANDAY(birth_date)) / 365.25 >= 16  -- At least 16 years old
    ),
    CONSTRAINT chk_hire_date CHECK (hire_date >= DATE('2000-01-01')),  -- No hires before 2000
    CONSTRAINT chk_salary_by_type CHECK (
        (employment_type = 'intern' AND salary BETWEEN 0 AND 30000) OR
        (employment_type = 'part-time' AND salary BETWEEN 15000 AND 50000) OR
        (employment_type = 'full-time' AND salary BETWEEN 30000 AND 200000) OR
        (employment_type = 'contractor' AND salary IS NULL)
    ),
    CONSTRAINT chk_department CHECK (department IN ('IT', 'Sales', 'Marketing', 'HR', 'Finance', 'Operations')),
    CONSTRAINT chk_employment_type CHECK (employment_type IN ('full-time', 'part-time', 'intern', 'contractor'))
);

-- DEFAULT constraints with expressions
CREATE TABLE audit_log_demo (
    log_id INTEGER PRIMARY KEY AUTOINCREMENT,
    table_name TEXT NOT NULL,
    operation TEXT NOT NULL CHECK (operation IN ('INSERT', 'UPDATE', 'DELETE')),
    record_id INTEGER NOT NULL,
    old_values TEXT,  -- JSON string of old values
    new_values TEXT,  -- JSON string of new values
    changed_by TEXT DEFAULT 'system',
    changed_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ip_address TEXT,
    user_agent TEXT,
    -- Ensure operation-specific data requirements
    CONSTRAINT chk_update_values CHECK (
        (operation = 'INSERT' AND old_values IS NULL) OR
        (operation = 'DELETE' AND new_values IS NULL) OR
        (operation = 'UPDATE' AND old_values IS NOT NULL AND new_values IS NOT NULL)
    )
);

-- Insert test data to demonstrate constraints
INSERT INTO products_check_demo VALUES
(1, 'Laptop', 999.99, 10, 50, 'Electronics'),
(2, 'T-Shirt', 19.99, 0, 100, 'Clothing'),
(3, 'SQL Guide', 29.99, 15, 25, 'Books');

-- These will fail due to CHECK constraints:
-- INSERT INTO products_check_demo VALUES (4, 'Invalid', -10.00, 0, 5, 'Electronics');  -- Negative price
-- INSERT INTO products_check_demo VALUES (5, 'Invalid', 50.00, 150, 5, 'Electronics');  -- Discount > 100%
-- INSERT INTO products_check_demo VALUES (6, 'Invalid', 50.00, 10, -5, 'Electronics');  -- Negative stock
-- INSERT INTO products_check_demo VALUES (7, 'Invalid', 50.00, 10, 5, 'InvalidCategory');  -- Invalid category

INSERT INTO orders_check_demo VALUES
(1, 101, '2024-01-15', '2024-01-17', 150.00, 10.00, 12.00, 'shipped'),
(2, 102, '2024-01-16', NULL, 89.99, 0.00, 7.20, 'processing');

-- These will fail due to CHECK constraints:
-- INSERT INTO orders_check_demo VALUES (3, 103, '2024-01-17', '2024-01-16', 100.00, 0.00, 8.00, 'shipped');  -- Ship date before order date
-- INSERT INTO orders_check_demo VALUES (4, 104, '2024-01-18', NULL, 100.00, 150.00, 8.00, 'pending');  -- Discount > order total
-- INSERT INTO orders_check_demo VALUES (5, 105, '2024-01-19', NULL, 100.00, 10.00, 8.00, 'invalid_status');  -- Invalid status"
              >
                <h3 class="text-xl font-semibold text-red-400 mb-3">
                  4. NOT NULL and CHECK Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Data validation and business rule enforcement
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Column: price CHECK (price > 0) | Table: CONSTRAINT chk_name
                  CHECK (condition)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Constraint Management and Information
-- View constraint information (SQLite specific)
SELECT 
    name,
    type,
    sql
FROM sqlite_master 
WHERE type = 'table' 
AND name LIKE '%demo%'
ORDER BY name;

-- In other databases, you'd query information schema:
-- PostgreSQL: SELECT * FROM information_schema.table_constraints;
-- MySQL: SELECT * FROM information_schema.table_constraints;
-- SQL Server: SELECT * FROM sys.check_constraints;

-- Disable foreign key constraints (SQLite specific)
-- PRAGMA foreign_keys = OFF;  -- Disable FK checks
-- PRAGMA foreign_keys = ON;   -- Enable FK checks (default)

-- Check current foreign key setting
PRAGMA foreign_keys;

-- Add constraints to existing tables (ALTER TABLE)
-- Note: SQLite has limited ALTER TABLE support for constraints

-- Example of adding constraints in databases that support it:
-- ALTER TABLE products ADD CONSTRAINT chk_price CHECK (price > 0);
-- ALTER TABLE customers ADD CONSTRAINT uk_email UNIQUE (email);

-- Drop constraints (where supported)
-- ALTER TABLE products DROP CONSTRAINT chk_price;
-- ALTER TABLE customers DROP CONSTRAINT uk_email;

-- Constraint violation handling
-- Create a table to demonstrate constraint violations
CREATE TABLE constraint_test_demo (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT UNIQUE,
    age INTEGER CHECK (age >= 0 AND age <= 150),
    status TEXT CHECK (status IN ('active', 'inactive', 'pending'))
);

-- Insert valid data
INSERT INTO constraint_test_demo VALUES 
(1, 'John Doe', 'john@example.com', 25, 'active'),
(2, 'Jane Smith', 'jane@example.com', 30, 'inactive');

-- Demonstrate various constraint violations and error handling
-- (These would fail in actual execution)

-- PRIMARY KEY violation
-- INSERT INTO constraint_test_demo VALUES (1, 'Bob Johnson', 'bob@example.com', 35, 'active');

-- NOT NULL violation  
-- INSERT INTO constraint_test_demo VALUES (3, NULL, 'alice@example.com', 28, 'pending');

-- UNIQUE violation
-- INSERT INTO constraint_test_demo VALUES (4, 'Charlie Brown', 'john@example.com', 40, 'active');

-- CHECK constraint violation
-- INSERT INTO constraint_test_demo VALUES (5, 'David Wilson', 'david@example.com', -5, 'active');
-- INSERT INTO constraint_test_demo VALUES (6, 'Eve Adams', 'eve@example.com', 25, 'unknown_status');

-- Best practices for constraints:
-- 1. Always name your constraints explicitly for easier management
-- 2. Use descriptive constraint names (pk_, fk_, uk_, chk_ prefixes)
-- 3. Document business rules that constraints enforce
-- 4. Test constraint violations during development
-- 5. Consider performance impact of complex CHECK constraints
-- 6. Use appropriate referential actions for foreign keys
-- 7. Plan constraint modifications for schema changes

-- Constraint naming conventions:
-- PRIMARY KEY: pk_tablename or pk_tablename_column
-- FOREIGN KEY: fk_tablename_referencedtable or fk_tablename_column
-- UNIQUE: uk_tablename_column or uk_tablename_columns
-- CHECK: chk_tablename_column or chk_tablename_description

-- Example with proper naming:
CREATE TABLE example_proper_constraints (
    id INTEGER,
    user_id INTEGER,
    email TEXT,
    age INTEGER,
    status TEXT,
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT pk_example_id PRIMARY KEY (id),
    CONSTRAINT fk_example_user FOREIGN KEY (user_id) REFERENCES users(user_id),
    CONSTRAINT uk_example_email UNIQUE (email),
    CONSTRAINT chk_example_age CHECK (age BETWEEN 0 AND 150),
    CONSTRAINT chk_example_status CHECK (status IN ('active', 'inactive', 'pending'))
);

-- Cleanup demo tables (uncomment when needed)
-- DROP TABLE IF EXISTS customers_pk_demo;
-- DROP TABLE IF EXISTS customers_pk_table_demo;
-- DROP TABLE IF EXISTS order_items_pk_demo;
-- DROP TABLE IF EXISTS products_pk_auto_demo;
-- DROP TABLE IF EXISTS orders_fk_demo;
-- DROP TABLE IF EXISTS order_items_fk_demo;
-- DROP TABLE IF EXISTS customer_addresses_fk_demo;
-- DROP TABLE IF EXISTS categories_hierarchy_demo;
-- DROP TABLE IF EXISTS users_unique_demo;
-- DROP TABLE IF EXISTS products_unique_demo;
-- DROP TABLE IF EXISTS course_enrollments_demo;
-- DROP TABLE IF EXISTS social_accounts_demo;
-- DROP TABLE IF EXISTS employee_ssn_demo;
-- DROP TABLE IF EXISTS customers_notnull_demo;
-- DROP TABLE IF EXISTS products_check_demo;
-- DROP TABLE IF EXISTS orders_check_demo;
-- DROP TABLE IF EXISTS employees_check_demo;
-- DROP TABLE IF EXISTS audit_log_demo;
-- DROP TABLE IF EXISTS constraint_test_demo;
-- DROP TABLE IF EXISTS example_proper_constraints;"
              >
                <h3 class="text-xl font-semibold text-red-400 mb-3">
                  5. Constraint Management
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Managing, viewing, and troubleshooting constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  PRAGMA foreign_keys | ALTER TABLE ADD/DROP CONSTRAINT | Naming
                  conventions
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-rose-300"
          >
            Views & Virtual Tables
          </h2>
          <p class="text-gray-400 mb-4">
            Create reusable queries and virtual tables for simplified data
            access and security.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Create comprehensive business views
-- Customer summary view with calculated fields
CREATE VIEW customer_summary AS
SELECT 
    c.customer_id,
    c.first_name || ' ' || c.last_name AS full_name,
    c.email,
    c.registration_date,
    c.city,
    c.country,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    MAX(o.order_date) AS last_order_date,
    MIN(o.order_date) AS first_order_date,
    CASE 
        WHEN COUNT(o.order_id) = 0 THEN 'Never Purchased'
        WHEN MAX(o.order_date) >= CURRENT_DATE - INTERVAL 30 DAY THEN 'Active'
        WHEN MAX(o.order_date) >= CURRENT_DATE - INTERVAL 90 DAY THEN 'At Risk'
        ELSE 'Churned'
    END AS customer_status
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, 
         c.registration_date, c.city, c.country;

-- Use the customer summary view
SELECT * FROM customer_summary 
WHERE customer_status = 'Active' 
ORDER BY total_spent DESC 
LIMIT 10;

-- Product performance view
CREATE VIEW product_performance AS
SELECT 
    p.product_id,
    p.name,
    p.sku,
    c.name AS category_name,
    p.price,
    p.stock_quantity,
    COUNT(oi.order_item_id) AS times_ordered,
    COALESCE(SUM(oi.quantity), 0) AS total_quantity_sold,
    COALESCE(SUM(oi.quantity * oi.unit_price), 0) AS total_revenue,
    COALESCE(AVG(oi.unit_price), p.price) AS avg_selling_price,
    CASE 
        WHEN COUNT(oi.order_item_id) = 0 THEN 'Never Sold'
        WHEN COUNT(oi.order_item_id) >= 10 THEN 'Best Seller'
        WHEN COUNT(oi.order_item_id) >= 5 THEN 'Popular'
        ELSE 'Slow Mover'
    END AS performance_category
FROM products p
LEFT JOIN categories c ON p.category_id = c.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name, p.sku, c.name, p.price, p.stock_quantity;

SELECT * FROM product_performance 
WHERE performance_category != 'Never Sold'
ORDER BY total_revenue DESC;"
              >
                <h3 class="text-lg font-semibold text-rose-400 mb-2">
                  1. Business Intelligence Views
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Customer analytics and product performance views
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE VIEW with business logic and calculations
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Security and access control views
-- Create view that hides sensitive customer information
CREATE VIEW customer_public AS
SELECT 
    customer_id,
    first_name,
    LEFT(last_name, 1) || '***' AS last_name_masked,
    LEFT(email, 3) || '***@' || SUBSTR(email, INSTR(email, '@') + 1) AS email_masked,
    city,
    country,
    registration_date
FROM customers;

-- Use the masked view
SELECT * FROM customer_public LIMIT 5;

-- Create view for specific user roles (conceptual)
CREATE VIEW sales_dashboard AS
SELECT 
    DATE_TRUNC('month', o.order_date) AS month,
    COUNT(*) AS total_orders,
    SUM(o.total_amount) AS total_revenue,
    AVG(o.total_amount) AS avg_order_value,
    COUNT(DISTINCT o.customer_id) AS unique_customers,
    SUM(o.total_amount) / COUNT(DISTINCT o.customer_id) AS revenue_per_customer
FROM orders o
WHERE o.order_date >= CURRENT_DATE - INTERVAL 12 MONTH
GROUP BY DATE_TRUNC('month', o.order_date);

-- Manager view with additional details
CREATE VIEW manager_dashboard AS
SELECT 
    sd.*,
    (SELECT COUNT(*) FROM customers WHERE registration_date >= sd.month) AS new_customers_in_month,
    (SELECT COUNT(*) FROM products WHERE created_date >= sd.month) AS new_products_in_month
FROM sales_dashboard sd;

-- Simple updatable view (single table, no aggregations)
CREATE VIEW active_products AS
SELECT product_id, name, sku, price, stock_quantity, is_active
FROM products
WHERE is_active = true;

-- Update through view (works for simple views)
UPDATE active_products 
SET price = price * 1.05 
WHERE stock_quantity > 100;"
              >
                <h3 class="text-lg font-semibold text-rose-400 mb-2">
                  2. Security & Access Control Views
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Data masking, role-based views, and updatable views
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Views for data security and role-based access
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced view operations and management
-- Show view definitions
SELECT name, sql FROM sqlite_master 
WHERE type = 'view' 
ORDER BY name;

-- Create view with complex joins and subqueries
CREATE VIEW order_analysis AS
SELECT 
    o.order_id,
    o.order_date,
    c.first_name || ' ' || c.last_name AS customer_name,
    c.email,
    o.total_amount,
    o.status,
    COUNT(oi.order_item_id) AS item_count,
    STRING_AGG(p.name, ', ') AS products_ordered,
    CASE 
        WHEN o.total_amount > 1000 THEN 'High Value'
        WHEN o.total_amount > 300 THEN 'Medium Value'
        ELSE 'Low Value'
    END AS order_value_category,
    ROW_NUMBER() OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS customer_order_number
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY o.order_id, o.order_date, c.first_name, c.last_name, 
         c.email, o.total_amount, o.status, c.customer_id;

-- Use the complex view
SELECT * FROM order_analysis 
WHERE order_value_category = 'High Value'
ORDER BY order_date DESC 
LIMIT 10;

-- Create materialized view simulation (table from view)
CREATE TABLE monthly_sales_snapshot AS
SELECT * FROM sales_dashboard;

-- Refresh the snapshot (manual process in DuckDB)
DELETE FROM monthly_sales_snapshot;
INSERT INTO monthly_sales_snapshot SELECT * FROM sales_dashboard;

-- Drop views
DROP VIEW IF EXISTS customer_public;
DROP VIEW IF EXISTS active_products;
DROP VIEW IF EXISTS order_analysis;

-- Drop materialized view simulation
DROP TABLE IF EXISTS monthly_sales_snapshot;

-- List all remaining views
SELECT name FROM sqlite_master WHERE type = 'view';"
              >
                <h3 class="text-lg font-semibold text-rose-400 mb-2">
                  3. Advanced View Management
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Complex views, materialized view simulation, and maintenance
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Complex JOINs in views, materialized view patterns
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- UPDATE VIEWS - Modifying and replacing view definitions
-- Note: Views are updated by dropping and recreating, or using ALTER VIEW

-- Method 1: DROP and CREATE pattern
DROP VIEW IF EXISTS customer_summary;

CREATE VIEW customer_summary AS
SELECT 
    c.customer_id,
    c.first_name || ' ' || c.last_name AS full_name,
    c.email,
    c.phone,  -- Added new column
    c.registration_date,
    c.city,
    c.country,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    MAX(o.order_date) AS last_order_date,
    MIN(o.order_date) AS first_order_date,
    JULIANDAY('now') - JULIANDAY(MAX(o.order_date)) AS days_since_last_order,  -- New calculation
    CASE 
        WHEN COUNT(o.order_id) = 0 THEN 'Never Purchased'
        WHEN MAX(o.order_date) >= DATE('now', '-30 days') THEN 'Active'
        WHEN MAX(o.order_date) >= DATE('now', '-90 days') THEN 'At Risk'
        ELSE 'Churned'
    END AS customer_status
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.phone,
         c.registration_date, c.city, c.country;

-- Method 2: CREATE OR REPLACE VIEW (if supported)
-- CREATE OR REPLACE VIEW product_performance AS
-- ... new definition

-- View versioning strategy - create new version
CREATE VIEW customer_summary_v2 AS
SELECT 
    c.customer_id,
    c.first_name || ' ' || c.last_name AS full_name,
    c.email,
    c.phone,
    c.registration_date,
    c.city,
    c.country,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    MAX(o.order_date) AS last_order_date,
    MIN(o.order_date) AS first_order_date,
    JULIANDAY('now') - JULIANDAY(MAX(o.order_date)) AS days_since_last_order,
    -- Enhanced status logic
    CASE 
        WHEN COUNT(o.order_id) = 0 THEN 'Never Purchased'
        WHEN MAX(o.order_date) >= DATE('now', '-30 days') THEN 'Active'
        WHEN MAX(o.order_date) >= DATE('now', '-60 days') THEN 'Warming'
        WHEN MAX(o.order_date) >= DATE('now', '-90 days') THEN 'At Risk'
        WHEN MAX(o.order_date) >= DATE('now', '-180 days') THEN 'Dormant'
        ELSE 'Churned'
    END AS customer_status,
    -- New loyalty tier calculation
    CASE 
        WHEN COALESCE(SUM(o.total_amount), 0) >= 5000 THEN 'Platinum'
        WHEN COALESCE(SUM(o.total_amount), 0) >= 2000 THEN 'Gold'
        WHEN COALESCE(SUM(o.total_amount), 0) >= 500 THEN 'Silver'
        WHEN COUNT(o.order_id) > 0 THEN 'Bronze'
        ELSE 'None'
    END AS loyalty_tier
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.phone,
         c.registration_date, c.city, c.country;

-- Test the updated view
SELECT * FROM customer_summary_v2 
WHERE loyalty_tier IN ('Gold', 'Platinum')
ORDER BY total_spent DESC;

-- Update dependent objects after view changes
-- If other views depend on customer_summary, they need to be updated too

-- Migration strategy: gradually switch to new view
-- Step 1: Create new view
-- Step 2: Update applications to use new view
-- Step 3: Drop old view when no longer needed
-- DROP VIEW customer_summary;  -- After migration is complete

-- View dependency checking
SELECT 
    view_name,
    view_definition
FROM (
    SELECT name as view_name, sql as view_definition
    FROM sqlite_master 
    WHERE type = 'view'
    AND sql LIKE '%customer_summary%'
);

-- Complex view update with multiple tables
DROP VIEW IF EXISTS comprehensive_order_view;

CREATE VIEW comprehensive_order_view AS
SELECT 
    o.order_id,
    o.order_date,
    o.status,
    o.total_amount,
    c.customer_id,
    c.first_name || ' ' || c.last_name AS customer_name,
    c.email,
    c.city,
    c.country,
    COUNT(oi.order_item_id) AS item_count,
    STRING_AGG(p.name, ', ') AS product_names,
    SUM(oi.quantity) AS total_quantity,
    AVG(oi.unit_price) AS avg_item_price,
    -- New calculated fields
    o.total_amount / COUNT(oi.order_item_id) AS avg_item_value,
    CASE 
        WHEN JULIANDAY('now') - JULIANDAY(o.order_date) <= 7 THEN 'Recent'
        WHEN JULIANDAY('now') - JULIANDAY(o.order_date) <= 30 THEN 'This Month'
        WHEN JULIANDAY('now') - JULIANDAY(o.order_date) <= 90 THEN 'This Quarter'
        ELSE 'Older'
    END AS order_age_category
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY o.order_id, o.order_date, o.status, o.total_amount,
         c.customer_id, c.first_name, c.last_name, c.email, c.city, c.country;"
              >
                <h3 class="text-lg font-semibold text-rose-400 mb-2">
                  4. Updating Views - Definition Management
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Modify view definitions, versioning strategies, and dependency
                  management
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP/CREATE pattern, CREATE OR REPLACE, view versioning
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-teal-300"
          >
            Views - Virtual Tables
          </h2>
          <p class="text-gray-400 mb-4">
            Create, use, and manage views for data abstraction and security.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic View Creation
-- Simple view for customer information
CREATE VIEW customer_summary AS
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    city,
    country,
    registration_date,
    JULIANDAY('now') - JULIANDAY(registration_date) AS days_since_registration
FROM customers;

-- Use the view like a table
SELECT * FROM customer_summary WHERE country = 'USA';
SELECT COUNT(*) FROM customer_summary WHERE days_since_registration < 30;

-- Complex view with aggregations
CREATE VIEW customer_order_stats AS
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    MIN(o.order_date) AS first_order_date,
    MAX(o.order_date) AS last_order_date,
    CASE 
        WHEN COUNT(o.order_id) = 0 THEN 'No Orders'
        WHEN COUNT(o.order_id) = 1 THEN 'One-time Customer'
        WHEN COUNT(o.order_id) BETWEEN 2 AND 5 THEN 'Occasional Customer'
        WHEN COUNT(o.order_id) BETWEEN 6 AND 10 THEN 'Regular Customer'
        ELSE 'Frequent Customer'
    END AS customer_type,
    CASE 
        WHEN MAX(o.order_date) >= DATE('now', '-30 days') THEN 'Active'
        WHEN MAX(o.order_date) >= DATE('now', '-90 days') THEN 'Recent'
        WHEN MAX(o.order_date) IS NOT NULL THEN 'Inactive'
        ELSE 'Prospect'
    END AS customer_status
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.registration_date;

-- Query the complex view
SELECT 
    customer_type,
    customer_status,
    COUNT(*) AS customer_count,
    AVG(total_spent) AS avg_total_spent,
    SUM(total_spent) AS group_revenue
FROM customer_order_stats
GROUP BY customer_type, customer_status
ORDER BY group_revenue DESC;

-- Product performance view
CREATE VIEW product_performance AS
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.stock_quantity,
    c.name AS category_name,
    COALESCE(sales.units_sold, 0) AS units_sold,
    COALESCE(sales.revenue, 0) AS total_revenue,
    COALESCE(sales.order_count, 0) AS times_ordered,
    p.price * p.stock_quantity AS inventory_value,
    CASE 
        WHEN COALESCE(sales.units_sold, 0) = 0 THEN 'No Sales'
        WHEN COALESCE(sales.units_sold, 0) < 10 THEN 'Low Sales'
        WHEN COALESCE(sales.units_sold, 0) < 50 THEN 'Medium Sales'
        ELSE 'High Sales'
    END AS sales_performance,
    ROUND(
        COALESCE(sales.revenue, 0) / NULLIF(COALESCE(sales.units_sold, 0), 0), 
        2
    ) AS avg_selling_price
FROM products p
JOIN categories c ON p.category_id = c.category_id
LEFT JOIN (
    SELECT 
        oi.product_id,
        SUM(oi.quantity) AS units_sold,
        SUM(oi.price * oi.quantity) AS revenue,
        COUNT(DISTINCT oi.order_id) AS order_count
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    WHERE o.order_date >= DATE('now', '-12 months')
    GROUP BY oi.product_id
) sales ON p.product_id = sales.product_id;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  1. Creating Views
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Basic and complex view creation with aggregations
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE VIEW view_name AS SELECT columns FROM tables WHERE
                  conditions
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- When to Use Views and Their Advantages

-- Advantage 1: Data Security and Access Control
-- Hide sensitive columns, only show what users need
CREATE VIEW public_customer_info AS
SELECT 
    customer_id,
    first_name,
    last_name,
    city,
    country,
    registration_date
    -- Excluding: email, phone, address (sensitive data)
FROM customers;

-- Advantage 2: Simplify Complex Queries
-- Instead of writing complex JOINs repeatedly, create a view
CREATE VIEW order_details_full AS
SELECT 
    o.order_id,
    o.order_date,
    o.status AS order_status,
    o.total_amount AS order_total,
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.city AS customer_city,
    c.country AS customer_country,
    oi.product_id,
    oi.quantity,
    oi.price AS item_price,
    oi.quantity * oi.price AS item_total,
    p.name AS product_name,
    p.sku,
    cat.name AS category_name
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
JOIN categories cat ON p.category_id = cat.category_id;

-- Now complex analysis becomes simple
SELECT 
    category_name,
    customer_country,
    COUNT(DISTINCT order_id) AS orders,
    SUM(item_total) AS revenue
FROM order_details_full
WHERE order_date >= DATE('now', '-3 months')
GROUP BY category_name, customer_country
ORDER BY revenue DESC;

-- Advantage 3: Data Abstraction and Consistency
-- Standardize business logic across applications
CREATE VIEW high_value_customers AS
SELECT 
    cos.*,
    'VIP' AS service_level,
    CASE 
        WHEN total_spent > 5000 THEN 'Platinum'
        WHEN total_spent > 2000 THEN 'Gold'
        ELSE 'Silver'
    END AS tier
FROM customer_order_stats cos
WHERE total_spent > 1000
   OR total_orders > 10;

-- Use cases for views:
-- 1. Reporting dashboards
-- 2. API data sources
-- 3. Data warehouse staging
-- 4. Role-based data access
-- 5. Legacy system compatibility

-- Advantage 4: Calculated Fields Standardization
CREATE VIEW product_metrics AS
SELECT 
    p.*,
    ROUND(p.price * 0.7, 2) AS wholesale_price,
    ROUND(p.price * 1.2, 2) AS suggested_retail_price,
    CASE 
        WHEN p.stock_quantity = 0 THEN 'Out of Stock'
        WHEN p.stock_quantity < 10 THEN 'Low Stock'
        WHEN p.stock_quantity < 50 THEN 'Medium Stock'
        ELSE 'Well Stocked'
    END AS stock_status,
    p.price * p.stock_quantity AS inventory_value
FROM products p;

-- Monthly sales reports view
CREATE VIEW monthly_sales_report AS
SELECT 
    strftime('%Y', order_date) AS year,
    strftime('%m', order_date) AS month,
    strftime('%Y-%m', order_date) AS year_month,
    COUNT(DISTINCT order_id) AS total_orders,
    COUNT(DISTINCT customer_id) AS unique_customers,
    SUM(total_amount) AS total_revenue,
    AVG(total_amount) AS avg_order_value,
    -- Previous month comparison
    LAG(SUM(total_amount)) OVER (ORDER BY strftime('%Y-%m', order_date)) AS prev_month_revenue,
    ROUND(
        (SUM(total_amount) - LAG(SUM(total_amount)) OVER (ORDER BY strftime('%Y-%m', order_date))) * 100.0 /
        NULLIF(LAG(SUM(total_amount)) OVER (ORDER BY strftime('%Y-%m', order_date)), 0), 2
    ) AS revenue_growth_pct
FROM orders
WHERE order_date IS NOT NULL
GROUP BY strftime('%Y-%m', order_date);

-- Quarterly performance view
CREATE VIEW quarterly_performance AS
SELECT 
    strftime('%Y', order_date) AS year,
    CASE 
        WHEN CAST(strftime('%m', order_date) AS INTEGER) BETWEEN 1 AND 3 THEN 'Q1'
        WHEN CAST(strftime('%m', order_date) AS INTEGER) BETWEEN 4 AND 6 THEN 'Q2'
        WHEN CAST(strftime('%m', order_date) AS INTEGER) BETWEEN 7 AND 9 THEN 'Q3'
        ELSE 'Q4'
    END AS quarter,
    COUNT(*) AS orders,
    SUM(total_amount) AS revenue,
    COUNT(DISTINCT customer_id) AS customers,
    AVG(total_amount) AS avg_order_value
FROM orders
GROUP BY year, quarter
ORDER BY year, quarter;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  2. View Use Cases and Advantages
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Security, simplification, abstraction, and reporting scenarios
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Data security | Query simplification | Business logic
                  standardization
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- View Management and Best Practices

-- List all views in the database
SELECT 
    name,
    sql
FROM sqlite_master 
WHERE type = 'view'
ORDER BY name;

-- Update/Replace a view
-- Note: SQLite doesn't support ALTER VIEW, use DROP and CREATE
DROP VIEW IF EXISTS customer_summary;
CREATE VIEW customer_summary AS
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    city,
    country,
    registration_date,
    JULIANDAY('now') - JULIANDAY(registration_date) AS days_since_registration,
    -- New calculated field
    CASE 
        WHEN JULIANDAY('now') - JULIANDAY(registration_date) < 30 THEN 'New Customer'
        WHEN JULIANDAY('now') - JULIANDAY(registration_date) < 365 THEN 'Regular Customer'
        ELSE 'Long-time Customer'
    END AS customer_tenure
FROM customers;

-- View dependencies and impact analysis
-- Check what depends on a view before dropping it
SELECT 
    type,
    name,
    sql
FROM sqlite_master 
WHERE sql LIKE '%customer_summary%'
  AND name != 'customer_summary';

-- Performance considerations
-- Views don't store data - they execute the underlying query each time
-- For frequently accessed complex views, consider materialized views or tables

-- Create a materialized view equivalent (using table)
CREATE TABLE materialized_customer_stats AS
SELECT 
    customer_id,
    first_name,
    last_name,
    total_orders,
    total_spent,
    customer_type,
    customer_status,
    CURRENT_TIMESTAMP AS last_updated
FROM customer_order_stats;

-- Refresh materialized view (manual process in SQLite)
-- DELETE FROM materialized_customer_stats;
-- INSERT INTO materialized_customer_stats 
-- SELECT *, CURRENT_TIMESTAMP FROM customer_order_stats;

-- View naming conventions
-- Prefix: v_ or vw_
-- Purpose: summary, report, security, etc.
-- Examples:
-- v_customer_summary
-- vw_monthly_sales_report
-- v_public_product_catalog

-- Security view example - role-based access
CREATE VIEW v_manager_dashboard AS
SELECT 
    'Customer Stats' AS metric_category,
    COUNT(*) AS total_count,
    COUNT(*) FILTER (WHERE customer_status = 'Active') AS active_count,
    ROUND(AVG(total_spent), 2) AS avg_value
FROM customer_order_stats
UNION ALL
SELECT 
    'Product Stats' AS metric_category,
    COUNT(*) AS total_count,
    COUNT(*) FILTER (WHERE sales_performance != 'No Sales') AS active_count,
    ROUND(AVG(total_revenue), 2) AS avg_value
FROM product_performance;

-- View limitations and considerations:
-- 1. Cannot contain ORDER BY (in some databases)
-- 2. Cannot be indexed directly
-- 3. Performance depends on underlying query complexity
-- 4. Updates through views have restrictions
-- 5. May not reflect real-time data changes

-- Drop views when no longer needed
-- DROP VIEW IF EXISTS old_customer_view;
-- DROP VIEW IF EXISTS deprecated_sales_view;

-- Best practices:
-- 1. Use descriptive names
-- 2. Document view purpose and dependencies
-- 3. Keep views simple when possible
-- 4. Consider materialized views for complex aggregations
-- 5. Regularly review and cleanup unused views
-- 6. Test view performance with realistic data volumes

-- Example: View for data export/API
CREATE VIEW api_product_catalog AS
SELECT 
    p.product_id,
    p.name,
    p.description,
    p.price,
    p.sku,
    c.name AS category,
    CASE WHEN p.stock_quantity > 0 THEN 'In Stock' ELSE 'Out of Stock' END AS availability,
    p.stock_quantity,
    -- Only include active products
    p.is_active
FROM products p
JOIN categories c ON p.category_id = c.category_id
WHERE p.is_active = 1;

-- Test the API view
SELECT * FROM api_product_catalog WHERE category = 'Electronics' LIMIT 5;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  3. View Management and Performance
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Update, monitor, and optimize views for production use
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP VIEW | Performance considerations | Materialized views |
                  Security views
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-amber-300"
          >
            Indexes & Performance Optimization
          </h2>
          <p class="text-gray-400 mb-4">
            Create and manage indexes for query optimization and performance
            tuning.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic index creation
-- Simple index on single column
CREATE INDEX idx_customers_email ON customers(email);
CREATE INDEX idx_customers_lastname ON customers(last_name);
CREATE INDEX idx_orders_date ON orders(order_date);
CREATE INDEX idx_products_name ON products(name);

-- Unique indexes (enforces uniqueness and improves performance)
CREATE UNIQUE INDEX idx_customers_email_unique ON customers(email);
CREATE UNIQUE INDEX idx_products_sku_unique ON products(sku);

-- Composite indexes (multiple columns) - order matters!
CREATE INDEX idx_customers_name ON customers(last_name, first_name);
CREATE INDEX idx_orders_customer_date ON orders(customer_id, order_date);
CREATE INDEX idx_order_items_lookup ON order_items(order_id, product_id);

-- Functional indexes for case-insensitive searches
CREATE INDEX idx_customers_email_lower ON customers(LOWER(email));
CREATE INDEX idx_products_name_lower ON products(LOWER(name));

-- Show all indexes on a table
PRAGMA index_list('customers');

-- Show detailed index information
PRAGMA index_info('idx_customers_email');"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  1. Creating Indexes
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Single column, composite, unique, and functional indexes
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE [UNIQUE] INDEX name ON table(columns);
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Query performance analysis and optimization
-- Explain query execution plan (before optimization)
EXPLAIN QUERY PLAN 
SELECT * FROM customers WHERE email = 'john.smith@example.com';

-- Create index to optimize the query
CREATE INDEX idx_customers_email_perf ON customers(email);

-- Explain again (should show index usage)
EXPLAIN QUERY PLAN 
SELECT * FROM customers WHERE email = 'john.smith@example.com';

-- Complex query optimization
EXPLAIN QUERY PLAN
SELECT 
    c.first_name,
    c.last_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_spent
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE c.registration_date >= '2024-01-01'
GROUP BY c.customer_id, c.first_name, c.last_name
HAVING COUNT(o.order_id) > 0
ORDER BY total_spent DESC;

-- Create indexes to optimize the complex query
CREATE INDEX idx_customers_registration ON customers(registration_date);
CREATE INDEX idx_orders_customer_amount ON orders(customer_id, total_amount);

-- Explain the optimized query
EXPLAIN QUERY PLAN
SELECT 
    c.first_name,
    c.last_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_spent
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE c.registration_date >= '2024-01-01'
GROUP BY c.customer_id, c.first_name, c.last_name
HAVING COUNT(o.order_id) > 0
ORDER BY total_spent DESC;

-- Performance comparison queries
-- Test without index
SELECT COUNT(*) FROM orders WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31';

-- Create index for date range queries
CREATE INDEX idx_orders_date_range ON orders(order_date);

-- Test with index (should be faster)
SELECT COUNT(*) FROM orders WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31';"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  2. Performance Analysis & Optimization
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  EXPLAIN plans, query optimization, and performance testing
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  EXPLAIN QUERY PLAN; Performance before/after indexing
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Index maintenance and advanced operations
-- Drop indexes when no longer needed
DROP INDEX IF EXISTS idx_customers_email_perf;
DROP INDEX IF EXISTS idx_orders_customer_date;

-- Recreate with better definition
CREATE INDEX idx_customers_search ON customers(last_name, first_name, email);

-- Expression indexes for computed values
CREATE INDEX idx_customers_full_name ON customers(first_name || ' ' || last_name);
CREATE INDEX idx_orders_year ON orders(strftime('%Y', order_date));
CREATE INDEX idx_orders_month_year ON orders(strftime('%Y-%m', order_date));

-- Test expression indexes
SELECT * FROM customers 
WHERE first_name || ' ' || last_name = 'John Smith';

SELECT COUNT(*), strftime('%Y', order_date) as year
FROM orders 
GROUP BY strftime('%Y', order_date);

-- Index for JSON data (if using JSON columns)
-- CREATE INDEX idx_customer_metadata ON customers((metadata->>'city'));

-- Covering indexes (include additional columns)
-- Note: DuckDB syntax may vary
CREATE INDEX idx_orders_covering ON orders(customer_id, order_date, total_amount);

-- Show all indexes in the database
SELECT name, sql FROM sqlite_master 
WHERE type = 'index' 
AND name NOT LIKE 'sqlite_%'
ORDER BY name;

-- Analyze tables to update statistics
ANALYZE customers;
ANALYZE orders;
ANALYZE products;

-- Database size and storage information
PRAGMA database_size;
PRAGMA page_size;"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  3. Advanced Index Management
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Expression indexes, covering indexes, and maintenance
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Expression indexes, ANALYZE, database statistics
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- CLUSTER INDEXES - Physical data organization
-- Note: Not all databases support cluster indexes (SQL Server, Oracle do)
-- In SQLite/DuckDB, we demonstrate concepts and alternatives

-- Conceptual cluster index (organizes table data physically)
-- In SQL Server syntax (for reference):
-- CREATE CLUSTERED INDEX idx_orders_date_clustered ON orders(order_date);

-- Alternative: Sort table data physically in SQLite/DuckDB
-- Create new table with desired order
CREATE TABLE orders_clustered AS
SELECT * FROM orders ORDER BY order_date, customer_id;

-- Drop original and rename (effectively clustering by order_date)
-- DROP TABLE orders;
-- ALTER TABLE orders_clustered RENAME TO orders;

-- Cluster index benefits demonstration
-- Data is physically stored in order, improving range queries
SELECT * FROM orders_clustered 
WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31'
ORDER BY order_date;

-- Multi-column cluster concept
CREATE TABLE customer_orders_clustered AS
SELECT * FROM (
    SELECT o.*, c.country, c.city
    FROM orders o
    JOIN customers c ON o.customer_id = c.customer_id
) ORDER BY country, city, order_date;

-- NONCLUSTERED indexes (regular indexes) work with clustered data
CREATE INDEX idx_clustered_amount ON orders_clustered(total_amount);
CREATE INDEX idx_clustered_status ON orders_clustered(status);

-- Benefits of clustering
SELECT 
    'Clustered by date - efficient range scans' AS benefit,
    COUNT(*) as order_count
FROM orders_clustered 
WHERE order_date >= DATE('now', '-30 days')
UNION ALL
SELECT 
    'Improved ORDER BY performance',
    COUNT(*)
FROM orders_clustered 
ORDER BY order_date
LIMIT 1000;"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  4. Cluster Indexes & Physical Organization
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Physical data organization and clustering concepts
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CLUSTERED INDEX concepts, physical data ordering
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- MULTI-LEVEL INDEXES - Hierarchical and nested indexing strategies
-- Complex indexing for multi-dimensional data access patterns

-- Level 1: Primary grouping indexes
CREATE INDEX idx_level1_country ON customers(country);
CREATE INDEX idx_level1_category ON products(category_id);
CREATE INDEX idx_level1_date_year ON orders(strftime('%Y', order_date));

-- Level 2: Secondary grouping within primary groups
CREATE INDEX idx_level2_country_city ON customers(country, city);
CREATE INDEX idx_level2_category_brand ON products(category_id, brand);
CREATE INDEX idx_level2_date_month ON orders(strftime('%Y', order_date), strftime('%m', order_date));

-- Level 3: Detailed access patterns within groups
CREATE INDEX idx_level3_customer_detail ON customers(country, city, last_name, first_name);
CREATE INDEX idx_level3_product_detail ON products(category_id, brand, price, name);
CREATE INDEX idx_level3_order_detail ON orders(strftime('%Y', order_date), customer_id, total_amount);

-- Multi-level query optimization examples
-- Level 1 query - broad grouping
SELECT country, COUNT(*) as customer_count
FROM customers 
GROUP BY country
ORDER BY customer_count DESC;

-- Level 2 query - refined grouping  
SELECT country, city, COUNT(*) as customer_count
FROM customers 
WHERE country IN ('USA', 'Canada', 'UK')
GROUP BY country, city
ORDER BY country, customer_count DESC;

-- Level 3 query - detailed access
SELECT country, city, last_name, first_name, email
FROM customers 
WHERE country = 'USA' 
AND city = 'New York'
AND last_name BETWEEN 'A' AND 'J'
ORDER BY last_name, first_name;

-- Complex multi-level join optimization
SELECT 
    c.country,
    c.city,
    p.category_id,
    p.brand,
    COUNT(*) as order_count,
    SUM(oi.quantity * oi.unit_price) as revenue
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE c.country = 'USA'
AND strftime('%Y', o.order_date) = '2024'
GROUP BY c.country, c.city, p.category_id, p.brand
HAVING revenue > 1000
ORDER BY c.country, c.city, revenue DESC;

-- Covering multi-level indexes (include all needed columns)
CREATE INDEX idx_multilevel_covering ON order_items(
    order_id, product_id, quantity, unit_price
) -- INCLUDE (created_date, notes) -- Some databases support INCLUDE

-- Hierarchical data indexing
CREATE INDEX idx_hierarchy_path ON categories(parent_category_id, category_id, name);

-- Show index usage analysis
EXPLAIN QUERY PLAN
SELECT c.country, c.city, COUNT(*) 
FROM customers c 
WHERE c.country = 'USA' 
GROUP BY c.country, c.city;"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  5. Multi-Level Indexes & Hierarchical Access
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Complex indexing strategies for multi-dimensional queries
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Hierarchical indexes, covering indexes, query optimization
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-indigo-300"
          >
            Indexes - Performance Optimization
          </h2>
          <p class="text-gray-400 mb-4">
            When and how to create indexes for optimal query performance.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic Index Creation
-- Single column indexes
CREATE INDEX idx_customers_email ON customers(email);
CREATE INDEX idx_customers_last_name ON customers(last_name);
CREATE INDEX idx_orders_order_date ON orders(order_date);
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_products_price ON products(price);

-- Unique indexes (enforce uniqueness)
CREATE UNIQUE INDEX idx_customers_email_unique ON customers(email);
CREATE UNIQUE INDEX idx_products_sku_unique ON products(sku);

-- Composite (multi-column) indexes
CREATE INDEX idx_orders_customer_date ON orders(customer_id, order_date);
CREATE INDEX idx_order_items_order_product ON order_items(order_id, product_id);
CREATE INDEX idx_products_category_price ON products(category_id, price);
CREATE INDEX idx_customers_city_country ON customers(city, country);

-- Partial indexes (with WHERE clause)
CREATE INDEX idx_active_products ON products(name) WHERE is_active = 1;
CREATE INDEX idx_recent_orders ON orders(order_date) WHERE order_date >= DATE('now', '-1 year');
CREATE INDEX idx_high_value_orders ON orders(total_amount) WHERE total_amount > 1000;

-- When to use indexes:
-- 1. Frequently searched columns (WHERE clauses)
-- 2. JOIN conditions
-- 3. ORDER BY columns
-- 4. GROUP BY columns (sometimes)
-- 5. Foreign key columns

-- Query performance comparison (conceptual)
-- Without index:
SELECT * FROM customers WHERE email = 'john@example.com';  -- Full table scan

-- With index on email:
-- Same query will use index seek - much faster on large tables"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  1. Index Creation and Types
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Create single, composite, unique, and partial indexes
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE [UNIQUE] INDEX index_name ON table(column1, column2)
                  [WHERE condition]
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Index Usage Guidelines and Best Practices

-- Analyze existing indexes
SELECT 
    name,
    tbl_name,
    sql
FROM sqlite_master 
WHERE type = 'index' 
AND name NOT LIKE 'sqlite_autoindex%'
ORDER BY tbl_name, name;

-- Scenario 1: Search and Filter Operations
-- Good candidates for indexing:
-- - Columns frequently used in WHERE clauses
-- - Columns used in JOIN conditions
-- - Columns used in ORDER BY

-- Example: Customer search scenarios
-- These queries benefit from indexes:
-- INDEX: customers(last_name)
SELECT * FROM customers WHERE last_name = 'Smith';

-- INDEX: customers(last_name, first_name) 
SELECT * FROM customers WHERE last_name = 'Smith' AND first_name = 'John';

-- INDEX: customers(registration_date)
SELECT * FROM customers WHERE registration_date >= DATE('now', '-30 days');

-- INDEX: customers(city, country)
SELECT * FROM customers WHERE city = 'New York' AND country = 'USA';

-- Scenario 2: JOIN Performance
-- INDEX: orders(customer_id) - foreign key
-- INDEX: order_items(order_id) - foreign key
-- INDEX: order_items(product_id) - foreign key
SELECT 
    c.first_name,
    c.last_name,
    o.order_date,
    p.name AS product_name,
    oi.quantity,
    oi.price
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE c.country = 'USA'  -- INDEX: customers(country)
AND o.order_date >= DATE('now', '-90 days');  -- INDEX: orders(order_date)

-- Scenario 3: Sorting Performance
-- INDEX: products(price DESC) for descending sorts
SELECT * FROM products ORDER BY price DESC LIMIT 10;

-- INDEX: orders(order_date DESC, total_amount DESC)
SELECT * FROM orders ORDER BY order_date DESC, total_amount DESC LIMIT 20;

-- Scenario 4: Range Queries
-- INDEX: orders(order_date) - excellent for range queries
SELECT COUNT(*), SUM(total_amount)
FROM orders 
WHERE order_date BETWEEN DATE('now', '-30 days') AND DATE('now');

-- INDEX: products(price) - for price range searches
SELECT * FROM products WHERE price BETWEEN 100 AND 500;

-- When NOT to create indexes:
-- 1. Small tables (< 1000 rows typically)
-- 2. Columns that change frequently (high UPDATE/INSERT volume)
-- 3. Tables with very high INSERT/UPDATE/DELETE ratio
-- 4. Columns with low selectivity (few distinct values)"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  2. When to Use Indexes
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Scenarios where indexes provide performance benefits
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE clauses | JOIN conditions | ORDER BY | Range queries
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Index Management and Optimization

-- Drop unused or redundant indexes
DROP INDEX IF EXISTS idx_old_unused_index;
DROP INDEX IF EXISTS idx_redundant_single_column;

-- Identify potentially redundant indexes
-- If you have INDEX(a,b,c), you usually don't need INDEX(a) or INDEX(a,b)
-- But INDEX(b) or INDEX(c) would still be needed

-- Index naming conventions
-- Format: idx_tablename_column1_column2_purpose
CREATE INDEX idx_orders_customer_date_recent ON orders(customer_id, order_date);
CREATE INDEX idx_products_category_price_active ON products(category_id, price) WHERE is_active = 1;

-- Monitor index usage (conceptual - varies by database)
-- In production environments, you'd monitor:
-- - Which indexes are being used
-- - Query execution plans
-- - Index scan vs. index seek operations

-- Rebuild indexes (maintenance)
-- SQLite automatically maintains indexes, but other databases may need:
-- REINDEX index_name;  -- SQLite syntax for rebuild
-- ALTER INDEX index_name REBUILD;  -- SQL Server
-- ANALYZE TABLE table_name;  -- MySQL

-- Index size and storage considerations
-- Check index information (SQLite specific)
SELECT 
    name,
    tbl_name,
    CASE 
        WHEN sql LIKE '%UNIQUE%' THEN 'UNIQUE'
        ELSE 'REGULAR'
    END AS index_type,
    sql
FROM sqlite_master 
WHERE type = 'index' 
AND name NOT LIKE 'sqlite_autoindex%'
ORDER BY tbl_name;

-- Performance testing approach
-- 1. Create test data
CREATE TABLE performance_test AS
SELECT 
    ROW_NUMBER() OVER() AS id,
    'Customer_' || ROW_NUMBER() OVER() AS name,
    CASE (ROW_NUMBER() OVER()) % 10
        WHEN 0 THEN 'New York'
        WHEN 1 THEN 'Los Angeles'
        WHEN 2 THEN 'Chicago'
        WHEN 3 THEN 'Houston'
        WHEN 4 THEN 'Phoenix'
        WHEN 5 THEN 'Philadelphia'
        WHEN 6 THEN 'San Antonio'
        WHEN 7 THEN 'San Diego'
        WHEN 8 THEN 'Dallas'
        ELSE 'San Jose'
    END AS city,
    DATE('now', '-' || (ROW_NUMBER() OVER() % 365) || ' days') AS registration_date
FROM (
    SELECT 1 FROM (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) a,
                  (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) b,
                  (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) c,
                  (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) d
);

-- 2. Test query without index
-- EXPLAIN QUERY PLAN SELECT * FROM performance_test WHERE city = 'New York';

-- 3. Create index
CREATE INDEX idx_performance_test_city ON performance_test(city);

-- 4. Test same query with index
-- EXPLAIN QUERY PLAN SELECT * FROM performance_test WHERE city = 'New York';

-- Index best practices summary:
-- 1. Index foreign key columns
-- 2. Index frequently filtered columns
-- 3. Use composite indexes for multi-column filters
-- 4. Consider partial indexes for filtered queries
-- 5. Monitor and remove unused indexes
-- 6. Be careful with indexes on frequently updated columns
-- 7. Test performance with realistic data volumes

-- Cleanup test table
DROP TABLE IF EXISTS performance_test;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  3. Index Management and Best Practices
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Maintain, monitor, and optimize database indexes
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP INDEX | REINDEX | Monitor usage | Performance testing
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-indigo-300"
          >
            Window Functions - Complete Guide
          </h2>
          <p class="text-gray-400 mb-4">
            Advanced analytical functions for ranking, aggregation, and
            statistical analysis over data windows.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- ROW_NUMBER() - Assigns unique sequential integers to rows
-- Example: Number all orders for each customer
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    ROW_NUMBER() OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS order_sequence_number,
    ROW_NUMBER() OVER (ORDER BY o.total_amount DESC) AS overall_rank_by_amount,
    ROW_NUMBER() OVER (ORDER BY o.order_date) AS chronological_order_number
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- Use ROW_NUMBER for pagination simulation
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    registration_date,
    ROW_NUMBER() OVER (ORDER BY registration_date DESC) AS row_num
FROM customers
WHERE ROW_NUMBER() OVER (ORDER BY registration_date DESC) BETWEEN 1 AND 10;

-- ROW_NUMBER to find first and last orders per customer
WITH numbered_orders AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        o.order_id,
        o.order_date,
        o.total_amount,
        ROW_NUMBER() OVER (PARTITION BY c.customer_id ORDER BY o.order_date ASC) AS first_order_rank,
        ROW_NUMBER() OVER (PARTITION BY c.customer_id ORDER BY o.order_date DESC) AS last_order_rank
    FROM customers c
    INNER JOIN orders o ON c.customer_id = o.customer_id
)
SELECT 
    customer_id,
    first_name,
    last_name,
    order_id,
    order_date,
    total_amount,
    CASE 
        WHEN first_order_rank = 1 THEN 'First Order'
        WHEN last_order_rank = 1 THEN 'Most Recent Order'
        ELSE 'Middle Order'
    END AS order_type
FROM numbered_orders
WHERE first_order_rank = 1 OR last_order_rank = 1
ORDER BY customer_id, order_date;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  1. ROW_NUMBER()
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Assigns unique sequential integers to rows within a partition
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ROW_NUMBER() OVER (PARTITION BY column ORDER BY column)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- RANK() and DENSE_RANK() - Ranking functions with gap handling
-- Example: Rank customers by total spending
WITH customer_spending AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        c.email,
        COALESCE(SUM(o.total_amount), 0) AS total_spent,
        COUNT(o.order_id) AS total_orders
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name, c.email
)
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    total_spent,
    total_orders,
    RANK() OVER (ORDER BY total_spent DESC) AS spending_rank,
    DENSE_RANK() OVER (ORDER BY total_spent DESC) AS spending_dense_rank,
    ROW_NUMBER() OVER (ORDER BY total_spent DESC) AS spending_row_number,
    CASE 
        WHEN RANK() OVER (ORDER BY total_spent DESC) <= 3 THEN 'Top 3 Spender'
        WHEN RANK() OVER (ORDER BY total_spent DESC) <= 10 THEN 'Top 10 Spender'
        ELSE 'Regular Customer'
    END AS customer_tier
FROM customer_spending
ORDER BY total_spent DESC;

-- Rank products by sales performance within each category
SELECT 
    p.product_id,
    p.name AS product_name,
    c.name AS category_name,
    p.price,
    COALESCE(SUM(oi.quantity), 0) AS total_quantity_sold,
    COALESCE(SUM(oi.quantity * oi.unit_price), 0) AS total_revenue,
    RANK() OVER (PARTITION BY p.category_id ORDER BY COALESCE(SUM(oi.quantity * oi.unit_price), 0) DESC) AS category_revenue_rank,
    DENSE_RANK() OVER (PARTITION BY p.category_id ORDER BY COALESCE(SUM(oi.quantity), 0) DESC) AS category_quantity_rank,
    RANK() OVER (ORDER BY COALESCE(SUM(oi.quantity * oi.unit_price), 0) DESC) AS overall_revenue_rank
FROM products p
LEFT JOIN categories c ON p.category_id = c.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name, c.name, p.price, p.category_id
ORDER BY p.category_id, total_revenue DESC;

-- Demonstrate difference between RANK(), DENSE_RANK(), and ROW_NUMBER()
WITH sample_scores AS (
    SELECT 'Alice' AS student_name, 95 AS score
    UNION ALL SELECT 'Bob', 92
    UNION ALL SELECT 'Charlie', 92
    UNION ALL SELECT 'David', 88
    UNION ALL SELECT 'Eve', 88
    UNION ALL SELECT 'Frank', 85
    UNION ALL SELECT 'Grace', 82
)
SELECT 
    student_name,
    score,
    RANK() OVER (ORDER BY score DESC) AS rank_with_gaps,
    DENSE_RANK() OVER (ORDER BY score DESC) AS dense_rank_no_gaps,
    ROW_NUMBER() OVER (ORDER BY score DESC) AS row_number_unique,
    'RANK: ' || RANK() OVER (ORDER BY score DESC) || 
    ', DENSE_RANK: ' || DENSE_RANK() OVER (ORDER BY score DESC) || 
    ', ROW_NUMBER: ' || ROW_NUMBER() OVER (ORDER BY score DESC) AS comparison
FROM sample_scores
ORDER BY score DESC;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  2. RANK() and DENSE_RANK()
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Ranking functions - RANK() leaves gaps, DENSE_RANK() doesn't
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  RANK() OVER (ORDER BY column) | DENSE_RANK() OVER (ORDER BY
                  column)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- NTILE() - Distributes rows into a specified number of groups
-- Example: Divide customers into quartiles based on spending
WITH customer_spending AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        COALESCE(SUM(o.total_amount), 0) AS total_spent
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name
)
SELECT 
    customer_id,
    first_name,
    last_name,
    total_spent,
    NTILE(4) OVER (ORDER BY total_spent DESC) AS spending_quartile,
    NTILE(10) OVER (ORDER BY total_spent DESC) AS spending_decile,
    CASE 
        WHEN NTILE(4) OVER (ORDER BY total_spent DESC) = 1 THEN 'High Value (Top 25%)'
        WHEN NTILE(4) OVER (ORDER BY total_spent DESC) = 2 THEN 'Medium-High Value (25-50%)'
        WHEN NTILE(4) OVER (ORDER BY total_spent DESC) = 3 THEN 'Medium-Low Value (50-75%)'
        ELSE 'Low Value (Bottom 25%)'
    END AS customer_segment,
    CASE 
        WHEN NTILE(10) OVER (ORDER BY total_spent DESC) = 1 THEN 'Top 10% - VIP'
        WHEN NTILE(10) OVER (ORDER BY total_spent DESC) <= 3 THEN 'Top 30% - Premium'
        WHEN NTILE(10) OVER (ORDER BY total_spent DESC) <= 7 THEN 'Middle 40% - Standard'
        ELSE 'Bottom 30% - Basic'
    END AS detailed_segment
FROM customer_spending
ORDER BY total_spent DESC;

-- Divide products into price tiers
SELECT 
    product_id,
    name AS product_name,
    price,
    stock_quantity,
    NTILE(3) OVER (ORDER BY price) AS price_tier,
    NTILE(5) OVER (ORDER BY stock_quantity DESC) AS inventory_tier,
    CASE 
        WHEN NTILE(3) OVER (ORDER BY price) = 1 THEN 'Budget Tier'
        WHEN NTILE(3) OVER (ORDER BY price) = 2 THEN 'Mid-Range Tier'
        ELSE 'Premium Tier'
    END AS price_category,
    CASE 
        WHEN NTILE(5) OVER (ORDER BY stock_quantity DESC) = 1 THEN 'Very High Stock'
        WHEN NTILE(5) OVER (ORDER BY stock_quantity DESC) = 2 THEN 'High Stock'
        WHEN NTILE(5) OVER (ORDER BY stock_quantity DESC) = 3 THEN 'Medium Stock'
        WHEN NTILE(5) OVER (ORDER BY stock_quantity DESC) = 4 THEN 'Low Stock'
        ELSE 'Very Low Stock'
    END AS inventory_status
FROM products
WHERE is_active = true
ORDER BY price;

-- Create balanced groups for A/B testing
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    registration_date,
    NTILE(2) OVER (ORDER BY customer_id) AS ab_test_group,
    NTILE(3) OVER (ORDER BY RANDOM()) AS three_way_test_group,
    CASE 
        WHEN NTILE(2) OVER (ORDER BY customer_id) = 1 THEN 'Group A - Control'
        ELSE 'Group B - Treatment'
    END AS test_assignment,
    CASE 
        WHEN NTILE(3) OVER (ORDER BY RANDOM()) = 1 THEN 'Variant A'
        WHEN NTILE(3) OVER (ORDER BY RANDOM()) = 2 THEN 'Variant B'
        ELSE 'Variant C'
    END AS three_way_assignment
FROM customers
ORDER BY customer_id;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  3. NTILE()
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Divides result set into specified number of roughly equal
                  groups
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  NTILE(number_of_groups) OVER (ORDER BY column)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LAG() and LEAD() - Access previous and next row values
-- Example: Compare current order with previous/next orders
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS previous_order_date,
    LEAD(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS next_order_date,
    LAG(o.total_amount) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS previous_order_amount,
    LEAD(o.total_amount) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS next_order_amount,
    o.total_amount - LAG(o.total_amount, 1, 0) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS amount_change_from_previous,
    CASE 
        WHEN LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) IS NULL THEN 'First Order'
        WHEN LEAD(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) IS NULL THEN 'Latest Order'
        ELSE 'Middle Order'
    END AS order_position
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- Calculate days between consecutive orders
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS previous_order_date,
    JULIANDAY(o.order_date) - JULIANDAY(LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date)) AS days_since_last_order,
    CASE 
        WHEN LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) IS NULL THEN 'First Order'
        WHEN (JULIANDAY(o.order_date) - JULIANDAY(LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date))) <= 7 THEN 'Frequent Buyer (< 7 days)'
        WHEN (JULIANDAY(o.order_date) - JULIANDAY(LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date))) <= 30 THEN 'Regular Buyer (< 30 days)'
        WHEN (JULIANDAY(o.order_date) - JULIANDAY(LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date))) <= 90 THEN 'Occasional Buyer (< 90 days)'
        ELSE 'Rare Buyer (> 90 days)'
    END AS purchase_frequency
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- Advanced LAG/LEAD usage with multiple offsets and default values
SELECT 
    o.order_id,
    o.order_date,
    o.total_amount,
    LAG(o.total_amount, 1, 0) OVER (ORDER BY o.order_date) AS previous_1_amount,
    LAG(o.total_amount, 2, 0) OVER (ORDER BY o.order_date) AS previous_2_amount,
    LAG(o.total_amount, 3, 0) OVER (ORDER BY o.order_date) AS previous_3_amount,
    LEAD(o.total_amount, 1, 0) OVER (ORDER BY o.order_date) AS next_1_amount,
    LEAD(o.total_amount, 2, 0) OVER (ORDER BY o.order_date) AS next_2_amount,
    (o.total_amount + LAG(o.total_amount, 1, 0) OVER (ORDER BY o.order_date) + LAG(o.total_amount, 2, 0) OVER (ORDER BY o.order_date)) / 3.0 AS three_order_moving_avg,
    o.total_amount - ((o.total_amount + LAG(o.total_amount, 1, 0) OVER (ORDER BY o.order_date) + LAG(o.total_amount, 2, 0) OVER (ORDER BY o.order_date)) / 3.0) AS deviation_from_avg
FROM orders o
ORDER BY o.order_date;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  4. LAG() and LEAD()
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Access values from previous (LAG) or next (LEAD) rows in the
                  result set
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  LAG(column, offset, default) OVER (ORDER BY column) |
                  LEAD(column, offset, default) OVER (ORDER BY column)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- FIRST_VALUE() and LAST_VALUE() - Get first and last values in window
-- Example: Compare each order to customer's first and most recent orders
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    FIRST_VALUE(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS first_order_date,
    LAST_VALUE(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS latest_order_date,
    FIRST_VALUE(o.total_amount) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS first_order_amount,
    LAST_VALUE(o.total_amount) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS latest_order_amount,
    o.total_amount - FIRST_VALUE(o.total_amount) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS amount_change_from_first,
    CASE 
        WHEN o.order_date = FIRST_VALUE(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) THEN 'First Order'
        WHEN o.order_date = LAST_VALUE(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) THEN 'Most Recent Order'
        ELSE 'Middle Order'
    END AS order_classification
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- Get highest and lowest values within each group
SELECT 
    p.category_id,
    c.name AS category_name,
    p.product_id,
    p.name AS product_name,
    p.price,
    FIRST_VALUE(p.price) OVER (PARTITION BY p.category_id ORDER BY p.price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS highest_price_in_category,
    LAST_VALUE(p.price) OVER (PARTITION BY p.category_id ORDER BY p.price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS lowest_price_in_category,
    FIRST_VALUE(p.name) OVER (PARTITION BY p.category_id ORDER BY p.price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS most_expensive_product,
    LAST_VALUE(p.name) OVER (PARTITION BY p.category_id ORDER BY p.price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS least_expensive_product,
    p.price - LAST_VALUE(p.price) OVER (PARTITION BY p.category_id ORDER BY p.price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS price_above_minimum,
    FIRST_VALUE(p.price) OVER (PARTITION BY p.category_id ORDER BY p.price DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) - p.price AS price_below_maximum
FROM products p
INNER JOIN categories c ON p.category_id = c.category_id
WHERE p.is_active = true
ORDER BY p.category_id, p.price DESC;

-- Advanced window frame usage
SELECT 
    o.order_id,
    o.order_date,
    o.total_amount,
    FIRST_VALUE(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS first_in_5row_window,
    LAST_VALUE(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS last_in_5row_window,
    FIRST_VALUE(o.order_id) OVER (ORDER BY o.order_date RANGE BETWEEN INTERVAL 30 DAY PRECEDING AND INTERVAL 30 DAY FOLLOWING) AS first_order_in_60day_window,
    LAST_VALUE(o.order_id) OVER (ORDER BY o.order_date RANGE BETWEEN INTERVAL 30 DAY PRECEDING AND INTERVAL 30 DAY FOLLOWING) AS last_order_in_60day_window
FROM orders o
ORDER BY o.order_date;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  5. FIRST_VALUE() and LAST_VALUE()
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Get the first and last values within the specified window
                  frame
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  FIRST_VALUE(column) OVER (window_specification) |
                  LAST_VALUE(column) OVER (window_specification)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Aggregate window functions: SUM, COUNT, AVG, MIN, MAX
-- Example: Running totals and moving averages
SELECT 
    o.order_id,
    o.customer_id,
    o.order_date,
    o.total_amount,
    -- Running totals
    SUM(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_total_all_orders,
    SUM(o.total_amount) OVER (PARTITION BY o.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_total_per_customer,
    -- Moving averages
    AVG(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg_3_orders,
    AVG(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS moving_avg_7_orders,
    -- Counting functions
    COUNT(*) OVER (ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cumulative_order_count,
    COUNT(*) OVER (PARTITION BY o.customer_id ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS customer_order_count,
    -- Min and Max in windows
    MIN(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 4 PRECEDING AND CURRENT ROW) AS min_in_last_5_orders,
    MAX(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 4 PRECEDING AND CURRENT ROW) AS max_in_last_5_orders
FROM orders o
ORDER BY o.order_date;

-- Calculate percentage of total and cumulative percentages
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    COALESCE(SUM(o.total_amount), 0) AS customer_total_spent,
    COUNT(o.order_id) AS customer_order_count,
    -- Percentage calculations
    ROUND(
        (COALESCE(SUM(o.total_amount), 0) * 100.0) / 
        SUM(COALESCE(o.total_amount, 0)) OVER (), 
        2
    ) AS percentage_of_total_revenue,
    ROUND(
        SUM(COALESCE(SUM(o.total_amount), 0)) OVER (ORDER BY COALESCE(SUM(o.total_amount), 0) DESC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) * 100.0 / 
        SUM(COALESCE(o.total_amount, 0)) OVER (), 
        2
    ) AS cumulative_percentage,
    -- Aggregate statistics across all customers
    AVG(COALESCE(SUM(o.total_amount), 0)) OVER () AS avg_customer_spending,
    MIN(COALESCE(SUM(o.total_amount), 0)) OVER () AS min_customer_spending,
    MAX(COALESCE(SUM(o.total_amount), 0)) OVER () AS max_customer_spending,
    COUNT(*) OVER () AS total_customers_count
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name
ORDER BY customer_total_spent DESC;

-- Advanced window frames with different specifications
SELECT 
    o.order_date,
    o.total_amount,
    -- Different frame specifications
    SUM(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS total_all_orders,
    SUM(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS sum_from_current_to_end,
    SUM(o.total_amount) OVER (ORDER BY o.order_date ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS sum_3_row_window,
    -- Range-based frames (date ranges)
    COUNT(*) OVER (ORDER BY o.order_date RANGE BETWEEN INTERVAL 7 DAY PRECEDING AND CURRENT ROW) AS orders_in_last_week,
    SUM(o.total_amount) OVER (ORDER BY o.order_date RANGE BETWEEN INTERVAL 30 DAY PRECEDING AND CURRENT ROW) AS revenue_last_30_days,
    AVG(o.total_amount) OVER (ORDER BY o.order_date RANGE BETWEEN INTERVAL 30 DAY PRECEDING AND INTERVAL 30 DAY FOLLOWING) AS avg_in_60_day_window
FROM orders o
ORDER BY o.order_date;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  6. Aggregate Window Functions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Running totals, moving averages, and statistical calculations
                  over windows
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SUM/AVG/COUNT/MIN/MAX() OVER (window_specification)
                </div>
              </button>
            </div>
          </div>
        
- Complete Guide
          </h2>
          <p class="text-gray-400 mb-6">
            Master advanced analytics with window functions for ranking,
            aggregations, and complex calculations over partitions.
          </p>

          <div class="space-y-8">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- ROW_NUMBER() - Assigns unique sequential numbers
-- Basic row numbering
SELECT 
    customer_id,
    first_name,
    last_name,
    registration_date,
    ROW_NUMBER() OVER (ORDER BY registration_date) AS registration_order,
    ROW_NUMBER() OVER (ORDER BY registration_date DESC) AS reverse_order,
    ROW_NUMBER() OVER (ORDER BY last_name, first_name) AS alphabetical_order
FROM customers
ORDER BY registration_date;

-- Row numbering within partitions
SELECT 
    o.customer_id,
    c.first_name,
    c.last_name,
    o.order_date,
    o.total_amount,
    ROW_NUMBER() OVER (PARTITION BY o.customer_id ORDER BY o.order_date) AS order_sequence,
    ROW_NUMBER() OVER (PARTITION BY o.customer_id ORDER BY o.total_amount DESC) AS value_rank,
    ROW_NUMBER() OVER (PARTITION BY DATE(o.order_date) ORDER BY o.total_amount DESC) AS daily_rank
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
ORDER BY o.customer_id, o.order_date;

-- RANK() and DENSE_RANK() - Handle ties differently
SELECT 
    p.name,
    p.price,
    p.category_id,
    -- RANK() leaves gaps after ties
    RANK() OVER (ORDER BY p.price DESC) AS price_rank,
    -- DENSE_RANK() doesn't leave gaps
    DENSE_RANK() OVER (ORDER BY p.price DESC) AS price_dense_rank,
    -- Within each category
    RANK() OVER (PARTITION BY p.category_id ORDER BY p.price DESC) AS category_price_rank,
    DENSE_RANK() OVER (PARTITION BY p.category_id ORDER BY p.price DESC) AS category_dense_rank
FROM products p
ORDER BY p.price DESC;

-- NTILE() - Divide data into equal buckets
SELECT 
    customer_id,
    first_name,
    last_name,
    registration_date,
    -- Divide customers into 4 quartiles by registration date
    NTILE(4) OVER (ORDER BY registration_date) AS registration_quartile,
    -- Divide into 10 deciles
    NTILE(10) OVER (ORDER BY registration_date) AS registration_decile,
    -- Quartiles by total orders value per customer
    NTILE(4) OVER (ORDER BY (
        SELECT COALESCE(SUM(total_amount), 0) 
        FROM orders WHERE customer_id = c.customer_id
    )) AS value_quartile
FROM customers c
ORDER BY registration_date;

-- Practical ranking use cases
WITH customer_stats AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        COUNT(o.order_id) AS total_orders,
        COALESCE(SUM(o.total_amount), 0) AS total_spent,
        COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
        MAX(o.order_date) AS last_order_date
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name
)
SELECT 
    customer_id,
    first_name,
    last_name,
    total_orders,
    total_spent,
    avg_order_value,
    last_order_date,
    -- Customer value rankings
    RANK() OVER (ORDER BY total_spent DESC) AS spending_rank,
    DENSE_RANK() OVER (ORDER BY total_orders DESC) AS frequency_rank,
    NTILE(5) OVER (ORDER BY total_spent DESC) AS value_quintile,
    -- Customer segmentation
    CASE 
        WHEN NTILE(5) OVER (ORDER BY total_spent DESC) = 1 THEN 'VIP'
        WHEN NTILE(5) OVER (ORDER BY total_spent DESC) = 2 THEN 'High Value'
        WHEN NTILE(5) OVER (ORDER BY total_spent DESC) = 3 THEN 'Medium Value'
        WHEN NTILE(5) OVER (ORDER BY total_spent DESC) = 4 THEN 'Low Value'
        ELSE 'New Customer'
    END AS customer_segment
FROM customer_stats
ORDER BY total_spent DESC;"
              >
                <h3 class="text-xl font-semibold text-purple-400 mb-3">
                  1. Ranking Functions
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  ROW_NUMBER(), RANK(), DENSE_RANK(), NTILE() for data ranking
                  and segmentation
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ROW_NUMBER() | RANK() | DENSE_RANK() | NTILE(n) OVER (ORDER BY
                  column)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Aggregate Window Functions
-- Running totals and cumulative calculations
SELECT 
    o.order_date,
    o.total_amount,
    -- Running total of all orders
    SUM(o.total_amount) OVER (ORDER BY o.order_date) AS running_total,
    -- Running average
    AVG(o.total_amount) OVER (ORDER BY o.order_date) AS running_avg,
    -- Running count
    COUNT(*) OVER (ORDER BY o.order_date) AS running_count,
    -- Running minimum and maximum
    MIN(o.total_amount) OVER (ORDER BY o.order_date) AS running_min,
    MAX(o.total_amount) OVER (ORDER BY o.order_date) AS running_max
FROM orders o
ORDER BY o.order_date;

-- Moving averages and sliding windows
SELECT 
    o.order_date,
    o.total_amount,
    -- 7-day moving average (current row + 6 preceding)
    AVG(o.total_amount) OVER (
        ORDER BY o.order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS moving_avg_7_days,
    -- 30-day moving sum
    SUM(o.total_amount) OVER (
        ORDER BY o.order_date 
        ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
    ) AS moving_sum_30_days,
    -- Centered 5-day moving average (2 before, current, 2 after)
    AVG(o.total_amount) OVER (
        ORDER BY o.order_date 
        ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING
    ) AS centered_avg_5_days,
    -- Count of orders in last 7 days
    COUNT(*) OVER (
        ORDER BY o.order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS orders_last_7_days
FROM orders o
ORDER BY o.order_date;

-- Partitioned aggregations
SELECT 
    o.customer_id,
    c.first_name,
    c.last_name,
    o.order_date,
    o.total_amount,
    -- Customer-specific running totals
    SUM(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date
    ) AS customer_running_total,
    -- Customer average order value up to this point
    AVG(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date
    ) AS customer_running_avg,
    -- Total spent by customer (all orders)
    SUM(o.total_amount) OVER (PARTITION BY o.customer_id) AS customer_total_spent,
    -- Customer order count
    COUNT(*) OVER (PARTITION BY o.customer_id) AS customer_total_orders,
    -- Percentage of customer's total spending
    ROUND(
        o.total_amount * 100.0 / 
        SUM(o.total_amount) OVER (PARTITION BY o.customer_id), 
        2
    ) AS pct_of_customer_total
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
ORDER BY o.customer_id, o.order_date;

-- Advanced aggregation scenarios
WITH daily_sales AS (
    SELECT 
        DATE(order_date) AS sale_date,
        COUNT(*) AS order_count,
        SUM(total_amount) AS daily_revenue,
        AVG(total_amount) AS avg_order_value
    FROM orders
    GROUP BY DATE(order_date)
)
SELECT 
    sale_date,
    order_count,
    daily_revenue,
    avg_order_value,
    -- Year-to-date metrics
    SUM(daily_revenue) OVER (
        PARTITION BY strftime('%Y', sale_date) 
        ORDER BY sale_date
    ) AS ytd_revenue,
    -- Monthly running totals
    SUM(daily_revenue) OVER (
        PARTITION BY strftime('%Y-%m', sale_date) 
        ORDER BY sale_date
    ) AS monthly_running_total,
    -- Week-over-week growth calculation
    LAG(daily_revenue, 7) OVER (ORDER BY sale_date) AS revenue_7_days_ago,
    ROUND(
        (daily_revenue - LAG(daily_revenue, 7) OVER (ORDER BY sale_date)) * 100.0 / 
        NULLIF(LAG(daily_revenue, 7) OVER (ORDER BY sale_date), 0), 
        2
    ) AS wow_growth_pct
FROM daily_sales
ORDER BY sale_date;"
              >
                <h3 class="text-xl font-semibold text-purple-400 mb-3">
                  2. Aggregate Window Functions
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Running totals, moving averages, and cumulative calculations
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SUM() | AVG() | COUNT() | MIN() | MAX() OVER (PARTITION BY ...
                  ORDER BY ... ROWS BETWEEN ...)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LAG and LEAD Functions - Access previous/next rows
-- Basic LAG and LEAD examples
SELECT 
    o.order_id,
    o.customer_id,
    o.order_date,
    o.total_amount,
    -- Previous order details
    LAG(o.total_amount) OVER (ORDER BY o.order_date) AS prev_order_amount,
    LAG(o.order_date) OVER (ORDER BY o.order_date) AS prev_order_date,
    LAG(o.customer_id) OVER (ORDER BY o.order_date) AS prev_customer_id,
    -- Next order details
    LEAD(o.total_amount) OVER (ORDER BY o.order_date) AS next_order_amount,
    LEAD(o.order_date) OVER (ORDER BY o.order_date) AS next_order_date,
    -- Calculate days between orders
    JULIANDAY(o.order_date) - JULIANDAY(LAG(o.order_date) OVER (ORDER BY o.order_date)) AS days_since_prev_order,
    JULIANDAY(LEAD(o.order_date) OVER (ORDER BY o.order_date)) - JULIANDAY(o.order_date) AS days_to_next_order
FROM orders o
ORDER BY o.order_date;

-- Customer-specific LAG/LEAD analysis
SELECT 
    o.customer_id,
    c.first_name,
    c.last_name,
    o.order_date,
    o.total_amount,
    -- Previous order by same customer
    LAG(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date
    ) AS prev_customer_order_amount,
    LAG(o.order_date) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date
    ) AS prev_customer_order_date,
    -- Next order by same customer
    LEAD(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date
    ) AS next_customer_order_amount,
    -- Days between customer orders
    JULIANDAY(o.order_date) - JULIANDAY(
        LAG(o.order_date) OVER (
            PARTITION BY o.customer_id 
            ORDER BY o.order_date
        )
    ) AS days_since_last_order,
    -- Order value comparison
    o.total_amount - LAG(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date
    ) AS order_value_change,
    ROUND(
        (o.total_amount - LAG(o.total_amount) OVER (
            PARTITION BY o.customer_id 
            ORDER BY o.order_date
        )) * 100.0 / NULLIF(LAG(o.total_amount) OVER (
            PARTITION BY o.customer_id 
            ORDER BY o.order_date
        ), 0), 2
    ) AS order_value_change_pct
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
ORDER BY o.customer_id, o.order_date;

-- Advanced LAG/LEAD use cases
WITH price_changes AS (
    SELECT 
        p.product_id,
        p.name,
        p.price,
        p.last_updated,
        LAG(p.price) OVER (
            PARTITION BY p.product_id 
            ORDER BY p.last_updated
        ) AS prev_price,
        LAG(p.last_updated) OVER (
            PARTITION BY p.product_id 
            ORDER BY p.last_updated
        ) AS prev_update_date,
        -- Price change calculation
        p.price - LAG(p.price) OVER (
            PARTITION BY p.product_id 
            ORDER BY p.last_updated
        ) AS price_change,
        ROUND(
            (p.price - LAG(p.price) OVER (
                PARTITION BY p.product_id 
                ORDER BY p.last_updated
            )) * 100.0 / NULLIF(LAG(p.price) OVER (
                PARTITION BY p.product_id 
                ORDER BY p.last_updated
            ), 0), 2
        ) AS price_change_pct
    FROM products p
    WHERE p.last_updated IS NOT NULL
)
SELECT 
    product_id,
    name,
    price,
    prev_price,
    price_change,
    price_change_pct,
    CASE 
        WHEN price_change > 0 THEN 'Price Increase'
        WHEN price_change < 0 THEN 'Price Decrease'
        WHEN price_change = 0 THEN 'No Change'
        ELSE 'New Product'
    END AS price_trend,
    JULIANDAY(last_updated) - JULIANDAY(prev_update_date) AS days_since_last_change
FROM price_changes
WHERE prev_price IS NOT NULL  -- Exclude first entries
ORDER BY ABS(price_change_pct) DESC;

-- FIRST_VALUE and LAST_VALUE Functions
SELECT 
    o.customer_id,
    o.order_date,
    o.total_amount,
    -- First order by customer
    FIRST_VALUE(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date 
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS first_order_amount,
    FIRST_VALUE(o.order_date) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date 
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS first_order_date,
    -- Most recent order by customer
    LAST_VALUE(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date 
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS latest_order_amount,
    LAST_VALUE(o.order_date) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date 
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS latest_order_date,
    -- Compare current order to first and last
    o.total_amount - FIRST_VALUE(o.total_amount) OVER (
        PARTITION BY o.customer_id 
        ORDER BY o.order_date 
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS change_from_first_order
FROM orders o
ORDER BY o.customer_id, o.order_date;"
              >
                <h3 class="text-xl font-semibold text-purple-400 mb-3">
                  3. LAG, LEAD, and Value Functions
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Access previous/next rows and first/last values in partitions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  LAG() | LEAD() | FIRST_VALUE() | LAST_VALUE() OVER (PARTITION
                  BY ... ORDER BY ...)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Window Frame Specifications - Control which rows are included
-- ROWS vs RANGE window frames
SELECT 
    order_date,
    total_amount,
    -- ROWS: Physical number of rows
    SUM(total_amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING
    ) AS sum_5_rows,
    AVG(total_amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) AS avg_last_3_rows,
    -- RANGE: Logical range of values
    SUM(total_amount) OVER (
        ORDER BY order_date 
        RANGE BETWEEN INTERVAL 7 DAY PRECEDING AND CURRENT ROW
    ) AS sum_last_7_days,
    COUNT(*) OVER (
        ORDER BY order_date 
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS cumulative_count,
    -- Moving window calculations
    MAX(total_amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 5 PRECEDING AND 5 FOLLOWING
    ) AS max_in_11_row_window,
    MIN(total_amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 3 PRECEDING AND 3 FOLLOWING
    ) AS min_in_7_row_window
FROM orders
ORDER BY order_date;

-- Practical window frame examples
WITH daily_metrics AS (
    SELECT 
        DATE(order_date) AS order_day,
        COUNT(*) AS orders_count,
        SUM(total_amount) AS daily_revenue,
        AVG(total_amount) AS daily_avg_order
    FROM orders
    GROUP BY DATE(order_date)
)
SELECT 
    order_day,
    orders_count,
    daily_revenue,
    daily_avg_order,
    -- 7-day rolling metrics
    AVG(daily_revenue) OVER (
        ORDER BY order_day 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_avg_revenue,
    SUM(orders_count) OVER (
        ORDER BY order_day 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_order_count,
    -- Month-to-date calculations
    SUM(daily_revenue) OVER (
        PARTITION BY strftime('%Y-%m', order_day)
        ORDER BY order_day
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS mtd_revenue,
    -- Compare to same day previous week
    LAG(daily_revenue, 7) OVER (ORDER BY order_day) AS revenue_same_day_last_week,
    daily_revenue - LAG(daily_revenue, 7) OVER (ORDER BY order_day) AS wow_revenue_change,
    -- Percentage change calculations
    ROUND(
        (daily_revenue - LAG(daily_revenue, 7) OVER (ORDER BY order_day)) * 100.0 /
        NULLIF(LAG(daily_revenue, 7) OVER (ORDER BY order_day), 0), 2
    ) AS wow_revenue_change_pct
FROM daily_metrics
ORDER BY order_day;

-- Complex window frame scenarios
SELECT 
    p.category_id,
    p.name,
    p.price,
    p.stock_quantity,
    -- Category-based analysis with different frames
    AVG(p.price) OVER (
        PARTITION BY p.category_id
        ORDER BY p.price
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS category_avg_price,
    -- Price percentiles within category
    NTILE(4) OVER (
        PARTITION BY p.category_id 
        ORDER BY p.price
    ) AS price_quartile_in_category,
    -- Rolling stock analysis
    SUM(p.stock_quantity) OVER (
        PARTITION BY p.category_id
        ORDER BY p.price
        ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING
    ) AS nearby_price_range_stock,
    -- Price rank within sliding window
    RANK() OVER (
        PARTITION BY p.category_id
        ORDER BY p.price DESC
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS price_rank_in_category,
    -- Cumulative percentage of category value
    ROUND(
        SUM(p.price * p.stock_quantity) OVER (
            PARTITION BY p.category_id
            ORDER BY p.price DESC
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) * 100.0 / 
        SUM(p.price * p.stock_quantity) OVER (
            PARTITION BY p.category_id
            ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
        ), 2
    ) AS cumulative_pct_of_category_value
FROM products p
ORDER BY p.category_id, p.price;

-- Performance optimization examples
-- Using window functions efficiently
WITH ranked_orders AS (
    SELECT 
        customer_id,
        order_date,
        total_amount,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY order_date DESC
        ) AS order_recency_rank,
        RANK() OVER (
            PARTITION BY customer_id 
            ORDER BY total_amount DESC
        ) AS order_value_rank
    FROM orders
)
SELECT 
    ro.customer_id,
    c.first_name,
    c.last_name,
    ro.order_date,
    ro.total_amount,
    ro.order_recency_rank,
    ro.order_value_rank,
    CASE 
        WHEN ro.order_recency_rank = 1 THEN 'Most Recent'
        WHEN ro.order_value_rank = 1 THEN 'Highest Value'
        ELSE 'Other'
    END AS order_type
FROM ranked_orders ro
JOIN customers c ON ro.customer_id = c.customer_id
WHERE ro.order_recency_rank <= 3  -- Last 3 orders per customer
   OR ro.order_value_rank = 1     -- Highest value order per customer
ORDER BY ro.customer_id, ro.order_recency_rank;"
              >
                <h3 class="text-xl font-semibold text-purple-400 mb-3">
                  4. Window Frames and Advanced Scenarios
                </h3>
                <p class="text-gray-400 text-sm mb-4">
                  Control window boundaries with ROWS/RANGE and optimize
                  performance
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ROWS BETWEEN ... AND ... | RANGE BETWEEN ... AND ... |
                  UNBOUNDED PRECEDING/FOLLOWING
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-pink-300"
          >
            Window Functions & Analytics
          </h2>
          <p class="text-gray-400 mb-4">
            Perform advanced analytics with window functions for ranking,
            running totals, and comparisons.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- ROW_NUMBER for unique ranking
SELECT 
    name,
    price,
    ROW_NUMBER() OVER (ORDER BY price DESC) as price_rank
FROM products
ORDER BY price_rank;

-- Ranking within partitions
SELECT 
    c.name as category,
    p.name as product,
    p.price,
    ROW_NUMBER() OVER (PARTITION BY c.name ORDER BY p.price DESC) as rank_in_category
FROM products p
INNER JOIN categories c ON p.category_id = c.category_id
ORDER BY c.name, rank_in_category;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  1. ROW_NUMBER
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Assign unique sequential numbers to rows
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ROW_NUMBER() OVER (PARTITION BY category ORDER BY price DESC)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- RANK and DENSE_RANK for handling ties
SELECT 
    name,
    price,
    RANK() OVER (ORDER BY price DESC) as rank_with_gaps,
    DENSE_RANK() OVER (ORDER BY price DESC) as dense_rank
FROM products
ORDER BY price DESC;

-- Percentile rankings
SELECT 
    name,
    price,
    PERCENT_RANK() OVER (ORDER BY price) as price_percentile,
    NTILE(4) OVER (ORDER BY price) as price_quartile
FROM products
ORDER BY price;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  2. RANK Functions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Handle ties in rankings and create percentile groups
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  RANK() vs DENSE_RANK() vs NTILE(4)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LAG and LEAD for accessing other rows
SELECT 
    order_date,
    total_amount,
    LAG(total_amount, 1) OVER (ORDER BY order_date) as previous_order_amount,
    LEAD(total_amount, 1) OVER (ORDER BY order_date) as next_order_amount,
    total_amount - LAG(total_amount, 1) OVER (ORDER BY order_date) as amount_change
FROM orders
ORDER BY order_date;

-- Compare with same customer's previous order
SELECT 
    customer_id,
    order_date,
    total_amount,
    LAG(total_amount, 1) OVER (PARTITION BY customer_id ORDER BY order_date) as prev_order,
    total_amount - LAG(total_amount, 1) OVER (PARTITION BY customer_id ORDER BY order_date) as growth
FROM orders
ORDER BY customer_id, order_date;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  3. LAG and LEAD
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Access values from previous or next rows for comparisons
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  LAG(total_amount, 1) OVER (ORDER BY order_date)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Running totals and moving averages
SELECT 
    order_date,
    total_amount,
    SUM(total_amount) OVER (ORDER BY order_date) as running_total,
    AVG(total_amount) OVER (ORDER BY order_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) as moving_avg_3
FROM orders
ORDER BY order_date;

-- Cumulative statistics
SELECT 
    name,
    price,
    SUM(price) OVER (ORDER BY price) as cumulative_price,
    COUNT(*) OVER (ORDER BY price) as products_up_to_price,
    AVG(price) OVER (ORDER BY price) as avg_price_up_to_here
FROM products
ORDER BY price;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  4. Aggregate Window Functions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Calculate running totals, moving averages, and cumulative
                  statistics
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SUM(total_amount) OVER (ORDER BY order_date)
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-teal-300"
          >
            Subqueries - Complete Guide
          </h2>
          <p class="text-gray-400 mb-4">
            Master all types of subqueries: scalar, multi-row, multi-column,
            correlated, and EXISTS.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Scalar Subqueries - Return single value
-- Example: Find customers who spent more than average
SELECT 
    customer_id,
    first_name,
    last_name,
    (SELECT SUM(total_amount) FROM orders WHERE customer_id = c.customer_id) AS total_spent,
    (SELECT AVG(total_amount) FROM orders) AS average_order_value
FROM customers c
WHERE (SELECT SUM(total_amount) FROM orders WHERE customer_id = c.customer_id) > 
      (SELECT AVG(total_amount) FROM orders)
ORDER BY total_spent DESC;

-- Scalar subquery in SELECT clause
SELECT 
    p.product_id,
    p.name,
    p.price,
    (SELECT COUNT(*) FROM order_items WHERE product_id = p.product_id) AS times_ordered,
    (SELECT MAX(order_date) FROM orders o JOIN order_items oi ON o.order_id = oi.order_id WHERE oi.product_id = p.product_id) AS last_ordered_date,
    p.price - (SELECT AVG(price) FROM products WHERE category_id = p.category_id) AS price_vs_category_avg
FROM products p
ORDER BY times_ordered DESC;

-- Scalar subquery with CASE
SELECT 
    order_id,
    customer_id,
    total_amount,
    CASE 
        WHEN total_amount > (SELECT AVG(total_amount) FROM orders) THEN 'Above Average'
        WHEN total_amount = (SELECT AVG(total_amount) FROM orders) THEN 'Average'
        ELSE 'Below Average'
    END AS order_category,
    total_amount - (SELECT MIN(total_amount) FROM orders) AS above_minimum,
    (SELECT MAX(total_amount) FROM orders) - total_amount AS below_maximum
FROM orders
ORDER BY total_amount DESC;

-- Scalar subquery for ranking without window functions
SELECT 
    customer_id,
    first_name,
    last_name,
    (SELECT COUNT(*) FROM customers c2 WHERE (SELECT COALESCE(SUM(total_amount), 0) FROM orders WHERE customer_id = c2.customer_id) > (SELECT COALESCE(SUM(total_amount), 0) FROM orders WHERE customer_id = c1.customer_id)) + 1 AS spending_rank
FROM customers c1
ORDER BY spending_rank;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  1. Scalar Subqueries
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Subqueries that return a single value
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  (SELECT single_value FROM table WHERE condition)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Multi-row Subqueries with IN, ANY, ALL
-- IN operator - value matches any value in subquery
SELECT 
    customer_id,
    first_name,
    last_name,
    email
FROM customers
WHERE customer_id IN (
    SELECT DISTINCT customer_id 
    FROM orders 
    WHERE total_amount > 100
);

-- NOT IN operator - value doesn't match any value in subquery
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    registration_date
FROM customers
WHERE customer_id NOT IN (
    SELECT DISTINCT customer_id 
    FROM orders 
    WHERE customer_id IS NOT NULL
);

-- ANY operator - condition is true for any value in subquery  
SELECT 
    product_id,
    name,
    price
FROM products
WHERE price > ANY (
    SELECT AVG(total_amount) 
    FROM orders 
    GROUP BY customer_id
);

-- ALL operator - condition is true for all values in subquery
SELECT 
    product_id,
    name,
    price
FROM products
WHERE price > ALL (
    SELECT total_amount 
    FROM orders 
    WHERE total_amount < 50
);

-- Complex multi-row subquery example
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.stock_quantity
FROM products p
WHERE p.product_id IN (
    SELECT oi.product_id
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    WHERE o.order_date >= DATE('now', '-30 days')
    GROUP BY oi.product_id
    HAVING SUM(oi.quantity) > 5
)
ORDER BY p.price DESC;

-- Subquery with comparison operators
SELECT 
    customer_id,
    first_name,
    last_name
FROM customers
WHERE customer_id = ANY (
    SELECT customer_id
    FROM orders
    WHERE order_date >= DATE('now', '-7 days')
);

-- Multiple conditions with subqueries
SELECT 
    order_id,
    customer_id,
    order_date,
    total_amount
FROM orders
WHERE customer_id IN (
    SELECT customer_id
    FROM customers
    WHERE city = 'New York'
)
AND total_amount > ALL (
    SELECT AVG(total_amount)
    FROM orders o2
    JOIN customers c2 ON o2.customer_id = c2.customer_id
    WHERE c2.city != 'New York'
    GROUP BY c2.city
    HAVING COUNT(*) > 1
);"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  2. Multi-row Subqueries
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Using IN, NOT IN, ANY, ALL with subqueries that return
                  multiple rows
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE column IN/ANY/ALL (SELECT multiple_values FROM table)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Correlated Subqueries - Inner query references outer query
-- Example: Find customers with above-average spending in their city
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    (SELECT COALESCE(SUM(total_amount), 0) FROM orders WHERE customer_id = c.customer_id) AS customer_total,
    (SELECT AVG(COALESCE(o2.total_amount, 0)) 
     FROM orders o2 
     JOIN customers c2 ON o2.customer_id = c2.customer_id 
     WHERE c2.city = c.city) AS city_average
FROM customers c
WHERE (SELECT COALESCE(SUM(total_amount), 0) FROM orders WHERE customer_id = c.customer_id) > 
      (SELECT AVG(COALESCE(o2.total_amount, 0)) 
       FROM orders o2 
       JOIN customers c2 ON o2.customer_id = c2.customer_id 
       WHERE c2.city = c.city)
ORDER BY customer_total DESC;

-- Correlated subquery to find products never ordered
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.stock_quantity
FROM products p
WHERE NOT EXISTS (
    SELECT 1 
    FROM order_items oi 
    WHERE oi.product_id = p.product_id
);

-- Correlated subquery for running totals
SELECT 
    o1.order_id,
    o1.order_date,
    o1.total_amount,
    (SELECT SUM(o2.total_amount) 
     FROM orders o2 
     WHERE o2.order_date <= o1.order_date) AS running_total
FROM orders o1
ORDER BY o1.order_date;

-- Complex correlated subquery - find each customer's most expensive order
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.total_amount AS highest_order_amount,
    o.order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE o.total_amount = (
    SELECT MAX(o2.total_amount)
    FROM orders o2
    WHERE o2.customer_id = c.customer_id
)
ORDER BY o.total_amount DESC;

-- Correlated subquery with aggregation
SELECT 
    p.product_id,
    p.name,
    p.category_id,
    p.price,
    (SELECT COUNT(*) 
     FROM order_items oi 
     WHERE oi.product_id = p.product_id) AS order_count,
    (SELECT COUNT(*) 
     FROM products p2 
     WHERE p2.category_id = p.category_id 
     AND (SELECT COUNT(*) FROM order_items oi2 WHERE oi2.product_id = p2.product_id) > 
         (SELECT COUNT(*) FROM order_items oi3 WHERE oi3.product_id = p.product_id)) AS products_ordered_more_in_category
FROM products p
ORDER BY order_count DESC;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  3. Correlated Subqueries
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Inner query references outer query columns for row-by-row
                  evaluation
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE condition = (SELECT value FROM table WHERE outer.column
                  = inner.column)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- EXISTS and NOT EXISTS - Test for existence of rows
-- EXISTS - returns true if subquery returns any rows
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date
FROM customers c
WHERE EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id 
    AND o.total_amount > 200
);

-- NOT EXISTS - returns true if subquery returns no rows
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date
FROM customers c
WHERE NOT EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id
);

-- EXISTS with complex conditions
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.category_id
FROM products p
WHERE EXISTS (
    SELECT 1
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    WHERE oi.product_id = p.product_id
    AND o.order_date >= DATE('now', '-90 days')
    AND oi.quantity >= 2
);

-- Multiple EXISTS conditions
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name
FROM customers c
WHERE EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id 
    AND o.total_amount > 100
)
AND EXISTS (
    SELECT 1
    FROM orders o2
    WHERE o2.customer_id = c.customer_id
    AND o2.order_date >= DATE('now', '-30 days')
);

-- EXISTS vs IN performance comparison concept
-- This query using EXISTS:
SELECT c.customer_id, c.first_name, c.last_name
FROM customers c
WHERE EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id 
    AND o.total_amount > 150
);

-- Same logic using IN:
SELECT c.customer_id, c.first_name, c.last_name
FROM customers c
WHERE c.customer_id IN (
    SELECT DISTINCT customer_id 
    FROM orders 
    WHERE total_amount > 150
);

-- Complex EXISTS example - customers who bought products from multiple categories
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    (SELECT COUNT(DISTINCT p.category_id)
     FROM orders o
     JOIN order_items oi ON o.order_id = oi.order_id
     JOIN products p ON oi.product_id = p.product_id
     WHERE o.customer_id = c.customer_id) AS categories_purchased
FROM customers c
WHERE EXISTS (
    SELECT 1
    FROM (
        SELECT o.customer_id, COUNT(DISTINCT p.category_id) as cat_count
        FROM orders o
        JOIN order_items oi ON o.order_id = oi.order_id
        JOIN products p ON oi.product_id = p.product_id
        WHERE o.customer_id = c.customer_id
        GROUP BY o.customer_id
        HAVING COUNT(DISTINCT p.category_id) > 1
    ) multi_category
)"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  4. EXISTS and NOT EXISTS
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Test for existence of rows matching a condition
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE EXISTS/NOT EXISTS (SELECT 1 FROM table WHERE condition)
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-indigo-300"
          >
            Subqueries & Advanced Filtering
          </h2>
          <p class="text-gray-400 mb-4">
            Use subqueries to create complex filters and calculations based on
            other query results.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Subquery in WHERE clause
SELECT name, price FROM products
WHERE price > (SELECT AVG(price) FROM products);

-- Find products in Electronics category using subquery
SELECT name, price, stock_quantity
FROM products
WHERE category_id = (
    SELECT category_id FROM categories WHERE name = 'Electronics'
);

-- Multiple value subquery with IN
SELECT first_name, last_name, email
FROM customers
WHERE customer_id IN (
    SELECT DISTINCT customer_id FROM orders WHERE total_amount > 500
);"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  1. WHERE Subqueries
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Filter rows based on results from other queries
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE price > (SELECT AVG(price) FROM products)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Subquery in SELECT clause
SELECT 
    name,
    price,
    (SELECT AVG(price) FROM products) as avg_price,
    price - (SELECT AVG(price) FROM products) as price_diff
FROM products
ORDER BY price_diff DESC;

-- Correlated subquery
SELECT 
    c.name as category_name,
    (SELECT COUNT(*) FROM products p WHERE p.category_id = c.category_id) as product_count,
    (SELECT AVG(price) FROM products p WHERE p.category_id = c.category_id) as avg_price
FROM categories c;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  2. SELECT Subqueries
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Calculate values using subqueries in the SELECT clause
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  (SELECT AVG(price) FROM products) as avg_price
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- EXISTS subquery
SELECT first_name, last_name, email
FROM customers c
WHERE EXISTS (
    SELECT 1 FROM orders o WHERE o.customer_id = c.customer_id
);

-- NOT EXISTS for customers without orders
SELECT first_name, last_name, email, registration_date
FROM customers c
WHERE NOT EXISTS (
    SELECT 1 FROM orders o WHERE o.customer_id = c.customer_id
);

-- ANY/ALL operators
SELECT name, price FROM products
WHERE price > ALL (
    SELECT price FROM products WHERE category_id = 3  -- Books category
);"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  3. EXISTS and Comparison Operators
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Test for existence and compare against multiple values
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE EXISTS (SELECT 1 FROM orders...)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Common Table Expressions (CTE)
WITH high_value_orders AS (
    SELECT customer_id, COUNT(*) as order_count, SUM(total_amount) as total_spent
    FROM orders
    WHERE total_amount > 300
    GROUP BY customer_id
),
customer_summary AS (
    SELECT 
        c.first_name,
        c.last_name,
        c.email,
        hvo.order_count,
        hvo.total_spent
    FROM customers c
    INNER JOIN high_value_orders hvo ON c.customer_id = hvo.customer_id
)
SELECT * FROM customer_summary
ORDER BY total_spent DESC;

-- Recursive CTE example (category hierarchy)
WITH RECURSIVE category_tree AS (
    SELECT category_id, name, 0 as level
    FROM categories
    WHERE category_id <= 3  -- Base case
    
    UNION ALL
    
    SELECT c.category_id, c.name, ct.level + 1
    FROM categories c
    INNER JOIN category_tree ct ON c.category_id = ct.category_id + 1
    WHERE ct.level < 2
)
SELECT * FROM category_tree;"
              >
                <h3 class="text-lg font-semibold text-indigo-400 mb-2">
                  4. Common Table Expressions (CTE)
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Create temporary named result sets for complex queries
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WITH high_value_orders AS (SELECT...)
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-yellow-300"
          >
            Date and Time Functions
          </h2>
          <p class="text-gray-400 mb-4">
            Complete guide to date/time manipulation, formatting, and
            calculations.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Current Date and Time Functions
-- Get current date and time
SELECT 
    CURRENT_DATE AS current_date,
    CURRENT_TIME AS current_time,
    CURRENT_TIMESTAMP AS current_timestamp,
    DATE('now') AS today,
    TIME('now') AS time_now,
    DATETIME('now') AS datetime_now,
    DATETIME('now', 'localtime') AS local_datetime;

-- Different timezone handling
SELECT 
    DATETIME('now') AS utc_time,
    DATETIME('now', 'localtime') AS local_time,
    DATETIME('now', '+5 hours') AS plus_5_hours,
    DATETIME('now', '-3 hours') AS minus_3_hours,
    DATETIME('now', '+1 day') AS tomorrow,
    DATETIME('now', '-1 day') AS yesterday;

-- Extract parts from current date
SELECT 
    EXTRACT(YEAR FROM CURRENT_DATE) AS current_year,
    EXTRACT(MONTH FROM CURRENT_DATE) AS current_month,
    EXTRACT(DAY FROM CURRENT_DATE) AS current_day,
    EXTRACT(HOUR FROM CURRENT_TIME) AS current_hour,
    EXTRACT(MINUTE FROM CURRENT_TIME) AS current_minute,
    EXTRACT(SECOND FROM CURRENT_TIME) AS current_second;

-- SQLite-specific date functions
SELECT 
    strftime('%Y', 'now') AS year,
    strftime('%m', 'now') AS month,
    strftime('%d', 'now') AS day,
    strftime('%H', 'now') AS hour,
    strftime('%M', 'now') AS minute,
    strftime('%S', 'now') AS second,
    strftime('%w', 'now') AS day_of_week,  -- 0=Sunday, 6=Saturday
    strftime('%j', 'now') AS day_of_year,  -- 1-366
    strftime('%W', 'now') AS week_of_year; -- 0-53

-- Day of week and month names
SELECT 
    CASE strftime('%w', 'now')
        WHEN '0' THEN 'Sunday'
        WHEN '1' THEN 'Monday'
        WHEN '2' THEN 'Tuesday'
        WHEN '3' THEN 'Wednesday'
        WHEN '4' THEN 'Thursday'
        WHEN '5' THEN 'Friday'
        WHEN '6' THEN 'Saturday'
    END AS day_name,
    CASE strftime('%m', 'now')
        WHEN '01' THEN 'January'
        WHEN '02' THEN 'February'
        WHEN '03' THEN 'March'
        WHEN '04' THEN 'April'
        WHEN '05' THEN 'May'
        WHEN '06' THEN 'June'
        WHEN '07' THEN 'July'
        WHEN '08' THEN 'August'
        WHEN '09' THEN 'September'
        WHEN '10' THEN 'October'
        WHEN '11' THEN 'November'
        WHEN '12' THEN 'December'
    END AS month_name;"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  1. Current Date/Time Functions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Get current date, time, and extract date parts
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CURRENT_DATE | CURRENT_TIME | CURRENT_TIMESTAMP | DATE('now')
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Date Arithmetic and Calculations
-- Add and subtract time periods
SELECT 
    order_date,
    DATE(order_date, '+1 day') AS next_day,
    DATE(order_date, '-1 day') AS previous_day,
    DATE(order_date, '+1 week') AS one_week_later,
    DATE(order_date, '+1 month') AS one_month_later,
    DATE(order_date, '+1 year') AS one_year_later,
    DATE(order_date, '+30 days') AS thirty_days_later
FROM orders
LIMIT 5;

-- Calculate differences between dates
SELECT 
    o.order_id,
    o.order_date,
    o.ship_date,
    JULIANDAY(o.ship_date) - JULIANDAY(o.order_date) AS days_to_ship,
    JULIANDAY(CURRENT_DATE) - JULIANDAY(o.order_date) AS days_since_order,
    CASE 
        WHEN JULIANDAY(CURRENT_DATE) - JULIANDAY(o.order_date) <= 7 THEN 'Recent'
        WHEN JULIANDAY(CURRENT_DATE) - JULIANDAY(o.order_date) <= 30 THEN 'This Month'
        WHEN JULIANDAY(CURRENT_DATE) - JULIANDAY(o.order_date) <= 90 THEN 'This Quarter'
        ELSE 'Older'
    END AS order_age_category
FROM orders
WHERE ship_date IS NOT NULL
ORDER BY order_date DESC;

-- Age calculations
SELECT 
    customer_id,
    first_name,
    last_name,
    date_of_birth,
    CAST((JULIANDAY('now') - JULIANDAY(date_of_birth)) / 365.25 AS INTEGER) AS age_years,
    CAST(JULIANDAY('now') - JULIANDAY(date_of_birth) AS INTEGER) AS age_days,
    CASE 
        WHEN CAST((JULIANDAY('now') - JULIANDAY(date_of_birth)) / 365.25 AS INTEGER) < 18 THEN 'Minor'
        WHEN CAST((JULIANDAY('now') - JULIANDAY(date_of_birth)) / 365.25 AS INTEGER) < 65 THEN 'Adult'
        ELSE 'Senior'
    END AS age_group
FROM customers
WHERE date_of_birth IS NOT NULL
ORDER BY age_years DESC;

-- Business days calculation (excluding weekends)
SELECT 
    order_date,
    ship_date,
    JULIANDAY(ship_date) - JULIANDAY(order_date) AS total_days,
    -- Approximate business days (excluding weekends)
    CAST(
        (JULIANDAY(ship_date) - JULIANDAY(order_date)) * 5.0 / 7.0 
        AS INTEGER
    ) AS approximate_business_days
FROM orders
WHERE ship_date IS NOT NULL
AND order_date IS NOT NULL;

-- Date ranges and periods
SELECT 
    'Current Week' AS period,
    DATE('now', 'weekday 0', '-6 days') AS period_start,
    DATE('now', 'weekday 0') AS period_end
UNION ALL
SELECT 
    'Current Month',
    DATE('now', 'start of month'),
    DATE('now', 'start of month', '+1 month', '-1 day')
UNION ALL
SELECT 
    'Current Quarter',
    DATE('now', 'start of year', 
         '+' || ((CAST(strftime('%m', 'now') AS INTEGER) - 1) / 3) * 3 || ' months'),
    DATE('now', 'start of year', 
         '+' || (((CAST(strftime('%m', 'now') AS INTEGER) - 1) / 3) + 1) * 3 || ' months', '-1 day')
UNION ALL
SELECT 
    'Current Year',
    DATE('now', 'start of year'),
    DATE('now', 'start of year', '+1 year', '-1 day');"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  2. Date Arithmetic and Calculations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Add/subtract time periods and calculate differences between
                  dates
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DATE(date, '+1 day') | JULIANDAY(date2) - JULIANDAY(date1)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Date Formatting and Parsing
-- Format dates in different ways
SELECT 
    order_date,
    strftime('%Y-%m-%d', order_date) AS iso_format,
    strftime('%m/%d/%Y', order_date) AS us_format,
    strftime('%d/%m/%Y', order_date) AS european_format,
    strftime('%B %d, %Y', order_date) AS long_format,
    strftime('%a, %b %d, %Y', order_date) AS abbreviated_format,
    strftime('%Y-W%W', order_date) AS year_week,
    strftime('%Y-Q%q', order_date) AS year_quarter
FROM orders
LIMIT 5;

-- Custom date format examples
SELECT 
    CURRENT_DATE AS today,
    strftime('%A', 'now') AS full_day_name,
    strftime('%a', 'now') AS short_day_name,
    strftime('%B', 'now') AS full_month_name,
    strftime('%b', 'now') AS short_month_name,
    strftime('%Y', 'now') AS four_digit_year,
    strftime('%y', 'now') AS two_digit_year,
    strftime('%m', 'now') AS month_number,
    strftime('%d', 'now') AS day_of_month,
    strftime('%H', 'now') AS hour_24,
    strftime('%I', 'now') AS hour_12,
    strftime('%p', 'now') AS am_pm;

-- Parse and convert different date formats
SELECT 
    '2024-03-15' AS input_string,
    DATE('2024-03-15') AS parsed_date,
    DATETIME('2024-03-15 14:30:00') AS parsed_datetime,
    DATE('2024-03-15', '+30 days') AS date_plus_30_days;

-- Working with different input formats
WITH date_strings AS (
    SELECT '2024-03-15' AS date_str, 'ISO format' AS format_type
    UNION ALL SELECT '03/15/2024', 'US format'
    UNION ALL SELECT '15/03/2024', 'European format'
    UNION ALL SELECT '2024-03-15 14:30:00', 'ISO datetime'
)
SELECT 
    date_str,
    format_type,
    -- For demonstration - actual parsing would need format-specific logic
    CASE 
        WHEN format_type = 'ISO format' THEN DATE(date_str)
        WHEN format_type = 'ISO datetime' THEN DATE(date_str)
        -- US format MM/DD/YYYY parsing example
        WHEN format_type = 'US format' THEN 
            DATE(SUBSTR(date_str, 7, 4) || '-' || 
                 SUBSTR(date_str, 1, 2) || '-' || 
                 SUBSTR(date_str, 4, 2))
        -- European format DD/MM/YYYY parsing example  
        WHEN format_type = 'European format' THEN
            DATE(SUBSTR(date_str, 7, 4) || '-' || 
                 SUBSTR(date_str, 4, 2) || '-' || 
                 SUBSTR(date_str, 1, 2))
        ELSE NULL
    END AS converted_date
FROM date_strings;

-- Time zone conversions (conceptual)
SELECT 
    DATETIME('now') AS utc_time,
    DATETIME('now', 'localtime') AS local_time,
    DATETIME('now', '+0 hours') AS london_time,
    DATETIME('now', '-5 hours') AS est_time,
    DATETIME('now', '-8 hours') AS pst_time,
    DATETIME('now', '+9 hours') AS tokyo_time,
    DATETIME('now', '+5:30 hours') AS india_time;

-- Extract and format time components
SELECT 
    CURRENT_TIMESTAMP AS full_timestamp,
    strftime('%H:%M:%S', 'now') AS time_only,
    strftime('%H:%M', 'now') AS hour_minute,
    CAST(strftime('%H', 'now') AS INTEGER) AS hour_number,
    CAST(strftime('%M', 'now') AS INTEGER) AS minute_number,
    CAST(strftime('%S', 'now') AS INTEGER) AS second_number,
    CASE 
        WHEN CAST(strftime('%H', 'now') AS INTEGER) < 12 THEN 'AM'
        ELSE 'PM'
    END AS am_pm_indicator;"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  3. Date Formatting and Parsing
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Format dates for display and parse different date formats
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  strftime('%Y-%m-%d', date) | DATE('string') |
                  DATETIME('string')
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-teal-300"
          >
            Date & Time Analysis
          </h2>
          <p class="text-gray-400 mb-4">
            Master temporal data analysis with DuckDB's powerful date and time
            functions for business intelligence.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Current date and time functions
SELECT 
    NOW() as current_timestamp,
    CURRENT_DATE as today,
    CURRENT_TIME as current_time,
    EXTRACT(year FROM NOW()) as current_year,
    EXTRACT(month FROM NOW()) as current_month,
    EXTRACT(day FROM NOW()) as current_day,
    EXTRACT(hour FROM NOW()) as current_hour;

-- Date arithmetic
SELECT 
    NOW() as now,
    NOW() + INTERVAL 7 DAY as one_week_later,
    NOW() - INTERVAL 1 MONTH as one_month_ago,
    NOW() + INTERVAL '2 years 3 months' as future_date;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  1. Date & Time Basics
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Work with current dates, extract parts, and perform date
                  arithmetic
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  NOW(), CURRENT_DATE, INTERVAL arithmetic
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Date formatting and parsing
SELECT 
    order_date,
    strftime(order_date, '%Y-%m-%d') as formatted_date,
    strftime(order_date, '%B %d, %Y') as readable_date,
    strftime(order_date, '%W') as week_of_year,
    DATE_TRUNC('month', order_date) as month_start,
    DATE_TRUNC('week', order_date) as week_start,
    DATE_TRUNC('year', order_date) as year_start
FROM orders;

-- Parse date strings
SELECT 
    strptime('2024-01-15 14:30:00', '%Y-%m-%d %H:%M:%S') as parsed_datetime,
    DATE '2024-01-15' as date_literal,
    TIMESTAMP '2024-01-15 14:30:00' as timestamp_literal;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  2. Date Formatting
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Format dates for display and truncate to specific time periods
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  strftime(date, '%Y-%m-%d'), DATE_TRUNC('month', date)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Time-based analysis
SELECT 
    DATE_TRUNC('month', order_date) as order_month,
    COUNT(*) as orders_count,
    SUM(total_amount) as monthly_revenue,
    AVG(total_amount) as avg_order_value,
    MAX(total_amount) as largest_order
FROM orders
GROUP BY DATE_TRUNC('month', order_date)
ORDER BY order_month;

-- Day of week analysis
SELECT 
    EXTRACT(dow FROM order_date) as day_of_week,
    CASE EXTRACT(dow FROM order_date)
        WHEN 0 THEN 'Sunday'
        WHEN 1 THEN 'Monday'
        WHEN 2 THEN 'Tuesday'
        WHEN 3 THEN 'Wednesday'
        WHEN 4 THEN 'Thursday'
        WHEN 5 THEN 'Friday'
        WHEN 6 THEN 'Saturday'
    END as day_name,
    COUNT(*) as orders,
    AVG(total_amount) as avg_amount
FROM orders
GROUP BY EXTRACT(dow FROM order_date)
ORDER BY day_of_week;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  3. Time-Based Grouping
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Group data by time periods for trend analysis
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  GROUP BY DATE_TRUNC('month', order_date)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced date calculations
SELECT 
    customer_id,
    first_name,
    last_name,
    registration_date,
    DATE_DIFF('day', registration_date, CURRENT_DATE) as days_since_registration,
    DATE_DIFF('month', registration_date, CURRENT_DATE) as months_as_customer,
    CASE 
        WHEN DATE_DIFF('day', registration_date, CURRENT_DATE) < 30 THEN 'New Customer'
        WHEN DATE_DIFF('day', registration_date, CURRENT_DATE) < 365 THEN 'Regular Customer'
        ELSE 'Loyal Customer'
    END as customer_tenure
FROM customers
ORDER BY registration_date;

-- Find seasonal patterns
SELECT 
    EXTRACT(quarter FROM order_date) as quarter,
    EXTRACT(month FROM order_date) as month,
    COUNT(*) as orders,
    SUM(total_amount) as revenue
FROM orders
GROUP BY EXTRACT(quarter FROM order_date), EXTRACT(month FROM order_date)
ORDER BY quarter, month;"
              >
                <h3 class="text-lg font-semibold text-teal-400 mb-2">
                  4. Date Calculations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Calculate differences between dates and analyze seasonal
                  patterns
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DATE_DIFF('day', start_date, end_date)
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-blue-300"
          >
            JOIN Operations - Complete Guide
          </h2>
          <p class="text-gray-400 mb-4">
            Master all types of JOINs with comprehensive examples showing every
            syntax variation.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- INNER JOIN - Returns only matching records from both tables
-- Example: Get customers with their orders
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    o.order_id,
    o.order_date,
    o.total_amount,
    o.status
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- Multiple INNER JOINs - Get order details with customer and product info
SELECT 
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    p.name AS product_name,
    oi.quantity,
    oi.unit_price,
    (oi.quantity * oi.unit_price) AS line_total
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.product_id
WHERE o.order_date >= '2024-01-01'
ORDER BY o.order_date DESC, o.order_id, oi.order_item_id;

-- INNER JOIN with complex conditions
SELECT 
    c.first_name,
    c.last_name,
    c.city,
    o.order_date,
    o.total_amount
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id 
    AND o.total_amount > 100 
    AND o.order_date >= '2024-01-01'
WHERE c.city IN ('New York', 'Los Angeles', 'Chicago')
ORDER BY o.total_amount DESC;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  1. INNER JOIN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Returns records that have matching values in both tables
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 INNER JOIN table2 ON condition
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LEFT JOIN (LEFT OUTER JOIN) - Returns all records from left table
-- Example: Get all customers and their orders (including customers with no orders)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date,
    o.order_id,
    o.order_date,
    o.total_amount,
    o.status,
    CASE 
        WHEN o.order_id IS NULL THEN 'No Orders'
        ELSE 'Has Orders'
    END AS order_status
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- LEFT JOIN with aggregation - Customer order summary
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(MAX(o.order_date), 'Never') AS last_order_date,
    COALESCE(MIN(o.order_date), 'Never') AS first_order_date,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email
ORDER BY total_spent DESC;

-- LEFT JOIN to find customers without orders
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date,
    DATEDIFF(CURRENT_DATE, c.registration_date) AS days_since_registration
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE o.order_id IS NULL
ORDER BY c.registration_date DESC;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  2. LEFT JOIN (LEFT OUTER JOIN)
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Returns all records from left table and matching records from
                  right table
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 LEFT JOIN table2 ON condition
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- RIGHT JOIN (RIGHT OUTER JOIN) - Returns all records from right table
-- Example: Get all orders and their customers (including orphaned orders if any)
SELECT 
    o.order_id,
    o.order_date,
    o.total_amount,
    o.status,
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    CASE 
        WHEN c.customer_id IS NULL THEN 'Orphaned Order'
        ELSE 'Valid Customer'
    END AS customer_status
FROM customers c
RIGHT JOIN orders o ON c.customer_id = o.customer_id
ORDER BY o.order_date DESC;

-- RIGHT JOIN with product categories - All categories and their products
SELECT 
    cat.category_id,
    cat.name AS category_name,
    cat.description AS category_description,
    p.product_id,
    p.name AS product_name,
    p.price,
    p.stock_quantity,
    p.is_active,
    CASE 
        WHEN p.product_id IS NULL THEN 'Empty Category'
        WHEN p.is_active = false THEN 'Inactive Product'
        ELSE 'Active Product'
    END AS product_status
FROM products p
RIGHT JOIN categories cat ON p.category_id = cat.category_id
ORDER BY cat.category_id, p.name;

-- RIGHT JOIN to find empty categories
SELECT 
    cat.category_id,
    cat.name AS category_name,
    cat.description,
    COUNT(p.product_id) AS product_count
FROM products p
RIGHT JOIN categories cat ON p.category_id = cat.category_id
GROUP BY cat.category_id, cat.name, cat.description
HAVING COUNT(p.product_id) = 0
ORDER BY cat.name;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  3. RIGHT JOIN (RIGHT OUTER JOIN)
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Returns all records from right table and matching records from
                  left table
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 RIGHT JOIN table2 ON condition
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- FULL OUTER JOIN - Returns all records when there's a match in either table
-- Example: Complete view of customers and orders relationship
SELECT 
    COALESCE(c.customer_id, 0) AS customer_id,
    COALESCE(c.first_name, 'Unknown') AS first_name,
    COALESCE(c.last_name, 'Unknown') AS last_name,
    COALESCE(c.email, 'No Email') AS email,
    COALESCE(o.order_id, 0) AS order_id,
    COALESCE(CAST(o.order_date AS TEXT), 'No Date') AS order_date,
    COALESCE(o.total_amount, 0) AS total_amount,
    CASE 
        WHEN c.customer_id IS NULL THEN 'Orphaned Order'
        WHEN o.order_id IS NULL THEN 'Customer No Orders'
        ELSE 'Valid Relationship'
    END AS relationship_status
FROM customers c
FULL OUTER JOIN orders o ON c.customer_id = o.customer_id
ORDER BY c.customer_id, o.order_date;

-- FULL OUTER JOIN for comprehensive product-category analysis
SELECT 
    COALESCE(cat.category_id, 0) AS category_id,
    COALESCE(cat.name, 'Uncategorized') AS category_name,
    COALESCE(p.product_id, 0) AS product_id,
    COALESCE(p.name, 'No Product') AS product_name,
    COALESCE(p.price, 0) AS price,
    COALESCE(p.stock_quantity, 0) AS stock_quantity,
    CASE 
        WHEN cat.category_id IS NULL THEN 'Product Without Category'
        WHEN p.product_id IS NULL THEN 'Empty Category'
        ELSE 'Properly Categorized'
    END AS categorization_status
FROM categories cat
FULL OUTER JOIN products p ON cat.category_id = p.category_id
ORDER BY cat.category_id, p.product_id;

-- FULL OUTER JOIN to identify data quality issues
SELECT 
    COALESCE(o.order_id, 0) AS order_id,
    COALESCE(oi.order_item_id, 0) AS order_item_id,
    CASE 
        WHEN o.order_id IS NULL THEN 'Orphaned Order Item'
        WHEN oi.order_item_id IS NULL THEN 'Order Without Items'
        ELSE 'Valid Order-Item Relationship'
    END AS data_quality_status,
    COALESCE(o.total_amount, 0) AS order_total,
    COALESCE(oi.quantity * oi.unit_price, 0) AS item_total
FROM orders o
FULL OUTER JOIN order_items oi ON o.order_id = oi.order_id
WHERE (o.order_id IS NULL OR oi.order_item_id IS NULL)
ORDER BY data_quality_status, o.order_id;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  4. FULL OUTER JOIN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Returns all records from both tables, with NULLs where no
                  match exists
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 FULL OUTER JOIN table2 ON condition
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- CROSS JOIN - Cartesian product of two tables (every row with every row)
-- Example: Generate all possible customer-product combinations for recommendations
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    p.product_id,
    p.name AS product_name,
    p.price,
    p.category_id,
    'Recommend ' || p.name || ' to ' || c.first_name || ' ' || c.last_name AS recommendation_text,
    CASE 
        WHEN p.price < 50 THEN 'Budget Recommendation'
        WHEN p.price < 200 THEN 'Mid-Range Recommendation'
        ELSE 'Premium Recommendation'
    END AS recommendation_type
FROM customers c
CROSS JOIN products p
WHERE c.customer_id <= 3  -- Limit to first 3 customers to avoid huge result
AND p.product_id <= 5     -- Limit to first 5 products
AND p.is_active = true
ORDER BY c.customer_id, p.product_id;

-- CROSS JOIN for time series analysis - all combinations of dates and metrics
WITH date_range AS (
    SELECT DATE('2024-01-01') AS analysis_date, 'January 2024' AS period_name
    UNION ALL SELECT DATE('2024-02-01'), 'February 2024'
    UNION ALL SELECT DATE('2024-03-01'), 'March 2024'
    UNION ALL SELECT DATE('2024-04-01'), 'April 2024'
    UNION ALL SELECT DATE('2024-05-01'), 'May 2024'
),
metrics AS (
    SELECT 'Total Orders' AS metric_name, 'COUNT(order_id)' AS metric_formula, 'Count of all orders placed' AS metric_description
    UNION ALL SELECT 'Total Revenue', 'SUM(total_amount)', 'Sum of all order amounts'
    UNION ALL SELECT 'Average Order Value', 'AVG(total_amount)', 'Average value per order'
    UNION ALL SELECT 'New Customers', 'COUNT(DISTINCT customer_id)', 'Count of unique customers'
    UNION ALL SELECT 'Active Products', 'COUNT(DISTINCT product_id)', 'Count of products sold'
)
SELECT 
    dr.analysis_date,
    dr.period_name,
    m.metric_name,
    m.metric_formula,
    m.metric_description,
    'Analyze ' || m.metric_name || ' for ' || dr.period_name AS analysis_task
FROM date_range dr
CROSS JOIN metrics m
ORDER BY dr.analysis_date, m.metric_name;

-- CROSS JOIN for generating test data combinations
SELECT 
    'Test_' || c.first_name || '_' || s.status_name AS test_scenario,
    c.customer_id,
    c.email,
    s.status_code,
    s.status_name,
    s.description AS status_description
FROM (
    SELECT customer_id, first_name, email FROM customers LIMIT 2
) c
CROSS JOIN (
    SELECT 'ACTIVE' AS status_code, 'Active' AS status_name, 'Customer is active and can place orders' AS description
    UNION ALL SELECT 'SUSPENDED', 'Suspended', 'Customer account is temporarily suspended'
    UNION ALL SELECT 'CLOSED', 'Closed', 'Customer account is permanently closed'
) s
ORDER BY c.customer_id, s.status_code;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  5. CROSS JOIN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Returns Cartesian product - every row from first table with
                  every row from second table
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 CROSS JOIN table2
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- SELF JOIN - Join a table with itself
-- Example 1: Find customers from the same city
SELECT 
    c1.customer_id AS customer1_id,
    c1.first_name AS customer1_firstname,
    c1.last_name AS customer1_lastname,
    c1.email AS customer1_email,
    c2.customer_id AS customer2_id,
    c2.first_name AS customer2_firstname,
    c2.last_name AS customer2_lastname,
    c2.email AS customer2_email,
    c1.city AS shared_city,
    c1.country AS shared_country
FROM customers c1
INNER JOIN customers c2 ON c1.city = c2.city 
    AND c1.country = c2.country 
    AND c1.customer_id < c2.customer_id  -- Avoid duplicates and self-matches
ORDER BY c1.city, c1.customer_id;

-- Example 2: Compare customer spending patterns
SELECT 
    c1.customer_id AS customer_id,
    c1.first_name || ' ' || c1.last_name AS customer_name,
    c1.total_spent AS customer_spending,
    c2.customer_id AS comparison_customer_id,
    c2.first_name || ' ' || c2.last_name AS comparison_customer_name,
    c2.total_spent AS comparison_spending,
    ABS(c1.total_spent - c2.total_spent) AS spending_difference,
    CASE 
        WHEN c1.total_spent > c2.total_spent THEN 'Spends More'
        WHEN c1.total_spent < c2.total_spent THEN 'Spends Less'
        ELSE 'Spends Same'
    END AS spending_comparison
FROM (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        COALESCE(SUM(o.total_amount), 0) AS total_spent
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name
) c1
INNER JOIN (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        COALESCE(SUM(o.total_amount), 0) AS total_spent
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name
) c2 ON c1.customer_id != c2.customer_id
WHERE c1.customer_id <= 5 AND c2.customer_id <= 5  -- Limit for demonstration
ORDER BY c1.customer_id, spending_difference;

-- Example 3: Hierarchical data (manager-employee structure)
CREATE TEMPORARY TABLE IF NOT EXISTS employees (
    employee_id INTEGER PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    manager_id INTEGER,
    department VARCHAR(50),
    salary DECIMAL(10,2),
    hire_date DATE
);

INSERT OR REPLACE INTO employees VALUES
(1, 'John', 'Smith', NULL, 'Executive', 200000, '2020-01-15'),
(2, 'Sarah', 'Johnson', 1, 'Sales', 150000, '2020-03-01'),
(3, 'Mike', 'Williams', 1, 'Technology', 160000, '2020-02-15'),
(4, 'Lisa', 'Brown', 2, 'Sales', 80000, '2021-01-10'),
(5, 'Tom', 'Davis', 3, 'Technology', 90000, '2021-02-01'),
(6, 'Anna', 'Wilson', 4, 'Sales', 50000, '2022-01-05'),
(7, 'Bob', 'Miller', 5, 'Technology', 70000, '2022-03-01'),
(8, 'Carol', 'Garcia', 2, 'Sales', 55000, '2022-06-15');

-- Self join to show employee-manager relationships
SELECT 
    emp.employee_id,
    emp.first_name || ' ' || emp.last_name AS employee_name,
    emp.department AS employee_department,
    emp.salary AS employee_salary,
    emp.hire_date AS employee_hire_date,
    COALESCE(mgr.employee_id, 0) AS manager_id,
    COALESCE(mgr.first_name || ' ' || mgr.last_name, 'No Manager') AS manager_name,
    COALESCE(mgr.department, 'N/A') AS manager_department,
    COALESCE(mgr.salary, 0) AS manager_salary,
    CASE 
        WHEN mgr.employee_id IS NULL THEN 'Top Level Executive'
        ELSE 'Reports to ' || mgr.first_name || ' ' || mgr.last_name
    END AS reporting_structure,
    CASE 
        WHEN mgr.salary IS NOT NULL AND emp.salary > mgr.salary * 0.8 THEN 'High Salary vs Manager'
        WHEN mgr.salary IS NOT NULL AND emp.salary < mgr.salary * 0.3 THEN 'Low Salary vs Manager'
        ELSE 'Normal Salary Range'
    END AS salary_analysis
FROM employees emp
LEFT JOIN employees mgr ON emp.manager_id = mgr.employee_id
ORDER BY emp.department, emp.employee_id;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  6. SELF JOIN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Join a table with itself to find relationships within the same
                  dataset
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 t1 JOIN table1 t2 ON condition
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-pink-300"
          >
            Advanced JOIN Types and UPSERT Operations
          </h2>
          <p class="text-gray-400 mb-4">
            Master all JOIN variations and INSERT OR REPLACE patterns.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- NATURAL JOIN - Automatically joins on columns with same name
-- Note: Use with caution - can be unpredictable if schema changes

-- Traditional INNER JOIN
SELECT c.customer_id, c.first_name, o.order_date, o.total_amount
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id;

-- NATURAL JOIN equivalent (if both tables have customer_id column)
-- SELECT customer_id, first_name, order_date, total_amount
-- FROM customers
-- NATURAL JOIN orders;

-- CROSS JOIN - Cartesian product of all rows
-- Creates every possible combination
SELECT 
    c.name AS category_name,
    p.name AS product_name,
    c.category_id,
    p.product_id
FROM categories c
CROSS JOIN (SELECT * FROM products LIMIT 3) p  -- Limited for demo
ORDER BY c.name, p.name;

-- Practical CROSS JOIN use case - generating combinations
WITH sizes AS (
    SELECT 'Small' AS size_name, 1 AS size_order
    UNION ALL SELECT 'Medium', 2
    UNION ALL SELECT 'Large', 3
    UNION ALL SELECT 'XL', 4
),
colors AS (
    SELECT 'Red' AS color_name, 1 AS color_order
    UNION ALL SELECT 'Blue', 2
    UNION ALL SELECT 'Green', 3
    UNION ALL SELECT 'Black', 4
)
SELECT 
    colors.color_name,
    sizes.size_name,
    colors.color_name || ' ' || sizes.size_name AS variant_name,
    (colors.color_order * 10) + sizes.size_order AS variant_sku
FROM colors
CROSS JOIN sizes
ORDER BY colors.color_order, sizes.size_order;

-- SELF JOIN - Join table to itself
-- Find customers from the same city
SELECT 
    c1.customer_id AS customer1_id,
    c1.first_name || ' ' || c1.last_name AS customer1_name,
    c2.customer_id AS customer2_id,
    c2.first_name || ' ' || c2.last_name AS customer2_name,
    c1.city,
    c1.country
FROM customers c1
JOIN customers c2 ON c1.city = c2.city AND c1.country = c2.country
WHERE c1.customer_id < c2.customer_id  -- Avoid duplicates and self-matches
ORDER BY c1.city, c1.customer_id;

-- SELF JOIN for hierarchical data (if we had employee management structure)
-- Example with categories having parent categories
WITH category_hierarchy AS (
    SELECT 
        category_id,
        name,
        CASE category_id 
            WHEN 1 THEN NULL  -- Electronics (top level)
            WHEN 2 THEN 1     -- Computers (under Electronics)
            WHEN 3 THEN 1     -- Phones (under Electronics)
            WHEN 4 THEN NULL  -- Clothing (top level)
            ELSE NULL
        END AS parent_category_id
    FROM categories
)
SELECT 
    child.category_id,
    child.name AS category_name,
    parent.category_id AS parent_id,
    parent.name AS parent_category_name,
    COALESCE(parent.name, 'Top Level') AS hierarchy_level
FROM category_hierarchy child
LEFT JOIN category_hierarchy parent ON child.parent_category_id = parent.category_id
ORDER BY parent.name, child.name;

-- Multiple JOINs with different types
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    -- Orders (INNER JOIN - only customers with orders)
    COUNT(o.order_id) AS order_count,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    -- Recent orders (LEFT JOIN - all customers, recent orders if any)
    recent_orders.recent_order_count,
    recent_orders.recent_total
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
LEFT JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS recent_order_count,
        SUM(total_amount) AS recent_total
    FROM orders 
    WHERE order_date >= DATE('now', '-90 days')
    GROUP BY customer_id
) recent_orders ON c.customer_id = recent_orders.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.city, 
         recent_orders.recent_order_count, recent_orders.recent_total
HAVING COUNT(o.order_id) > 0  -- Only customers with orders
ORDER BY total_spent DESC;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  1. Advanced JOIN Types
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  NATURAL JOIN, CROSS JOIN, SELF JOIN, and complex combinations
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  NATURAL JOIN | CROSS JOIN | SELF JOIN | Multiple JOIN
                  combinations
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- UPSERT Operations - INSERT OR REPLACE patterns
-- SQLite UPSERT syntax variations

-- Method 1: INSERT OR REPLACE
-- Replaces entire row if primary key exists
INSERT OR REPLACE INTO customers (
    customer_id, first_name, last_name, email, phone, 
    address, city, country, registration_date
) VALUES (
    1, 'John', 'Smith', 'john.smith.updated@email.com', '555-0123',
    '123 Updated St', 'New York', 'USA', '2024-01-15'
);

-- Method 2: INSERT OR IGNORE
-- Ignores insert if primary key exists
INSERT OR IGNORE INTO customers (
    customer_id, first_name, last_name, email, phone, 
    address, city, country, registration_date
) VALUES (
    1, 'This', 'WillBeIgnored', 'ignored@email.com', '555-9999',
    'Ignored Address', 'Ignored City', 'USA', '2024-01-01'
);

-- Method 3: INSERT ... ON CONFLICT (modern SQLite)
-- More control over conflict resolution
INSERT INTO customers (
    customer_id, first_name, last_name, email, phone, 
    address, city, country, registration_date
) VALUES (
    1, 'John', 'Smith', 'john.smith.conflict@email.com', '555-1111',
    '123 Conflict St', 'Boston', 'USA', '2024-02-01'
)
ON CONFLICT(customer_id) DO UPDATE SET
    email = excluded.email,
    phone = excluded.phone,
    address = excluded.address,
    city = excluded.city;

-- Bulk UPSERT operations
-- Create temporary data for demonstration
CREATE TEMPORARY TABLE customer_updates (
    customer_id INTEGER,
    first_name TEXT,
    last_name TEXT,
    email TEXT,
    phone TEXT,
    city TEXT,
    country TEXT
);

INSERT INTO customer_updates VALUES
(1, 'John', 'Smith', 'john.updated@email.com', '555-0001', 'Miami', 'USA'),
(2, 'Jane', 'Doe', 'jane.updated@email.com', '555-0002', 'Seattle', 'USA'),
(999, 'New', 'Customer', 'new.customer@email.com', '555-9999', 'Portland', 'USA');

-- Bulk upsert using INSERT OR REPLACE
INSERT OR REPLACE INTO customers (
    customer_id, first_name, last_name, email, phone, city, country, registration_date
)
SELECT 
    cu.customer_id,
    cu.first_name,
    cu.last_name,
    cu.email,
    cu.phone,
    cu.city,
    cu.country,
    COALESCE(
        (SELECT registration_date FROM customers WHERE customer_id = cu.customer_id),
        CURRENT_DATE
    ) AS registration_date
FROM customer_updates cu;

-- Product inventory upsert example
CREATE TABLE IF NOT EXISTS product_inventory_updates (
    product_id INTEGER PRIMARY KEY,
    stock_adjustment INTEGER,
    update_reason TEXT,
    updated_by TEXT,
    update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert some sample inventory updates
INSERT INTO product_inventory_updates (product_id, stock_adjustment, update_reason, updated_by)
VALUES 
(1, 50, 'Received shipment', 'warehouse_system'),
(2, -10, 'Damaged goods removed', 'manager'),
(3, 25, 'Restocked', 'warehouse_system');

-- Apply inventory updates with UPSERT logic
UPDATE products 
SET stock_quantity = stock_quantity + (
    SELECT stock_adjustment 
    FROM product_inventory_updates 
    WHERE product_inventory_updates.product_id = products.product_id
)
WHERE product_id IN (SELECT product_id FROM product_inventory_updates);

-- UPSERT with conditional logic
-- Update product prices with business rules
INSERT INTO products (product_id, name, price, stock_quantity, category_id, sku, is_active)
VALUES (999, 'New Test Product', 99.99, 100, 1, 'TEST-999', 1)
ON CONFLICT(product_id) DO UPDATE SET
    price = CASE 
        WHEN excluded.price > products.price * 1.5 THEN products.price * 1.1  -- Limit price increases
        WHEN excluded.price < products.price * 0.5 THEN products.price * 0.9  -- Limit price decreases
        ELSE excluded.price
    END,
    stock_quantity = products.stock_quantity + excluded.stock_quantity,
    last_updated = CURRENT_TIMESTAMP;

-- Merge-like operation using CTE and UPSERT
WITH order_summary AS (
    SELECT 
        customer_id,
        COUNT(*) AS total_orders,
        SUM(total_amount) AS total_spent,
        MAX(order_date) AS last_order_date,
        AVG(total_amount) AS avg_order_value
    FROM orders
    GROUP BY customer_id
)
INSERT INTO customer_order_stats (
    customer_id, first_name, last_name, email, registration_date,
    total_orders, total_spent, avg_order_value, last_order_date, customer_type, customer_status
)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date,
    COALESCE(os.total_orders, 0),
    COALESCE(os.total_spent, 0),
    COALESCE(os.avg_order_value, 0),
    os.last_order_date,
    CASE 
        WHEN COALESCE(os.total_orders, 0) = 0 THEN 'No Orders'
        WHEN COALESCE(os.total_orders, 0) = 1 THEN 'One-time Customer'
        WHEN COALESCE(os.total_orders, 0) BETWEEN 2 AND 5 THEN 'Occasional Customer'
        ELSE 'Regular Customer'
    END,
    CASE 
        WHEN os.last_order_date >= DATE('now', '-30 days') THEN 'Active'
        WHEN os.last_order_date >= DATE('now', '-90 days') THEN 'Recent'
        WHEN os.last_order_date IS NOT NULL THEN 'Inactive'
        ELSE 'Prospect'
    END
FROM customers c
LEFT JOIN order_summary os ON c.customer_id = os.customer_id
ON CONFLICT(customer_id) DO UPDATE SET
    total_orders = excluded.total_orders,
    total_spent = excluded.total_spent,
    avg_order_value = excluded.avg_order_value,
    last_order_date = excluded.last_order_date,
    customer_type = excluded.customer_type,
    customer_status = excluded.customer_status;

-- Cleanup temporary tables
DROP TABLE IF EXISTS customer_updates;
DROP TABLE IF EXISTS product_inventory_updates;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  2. UPSERT Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  INSERT OR REPLACE, INSERT OR IGNORE, and ON CONFLICT patterns
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  INSERT OR REPLACE | INSERT OR IGNORE | ON CONFLICT DO UPDATE
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-violet-300"
          >
            Advanced JOIN Patterns and Multi-Table Operations
          </h2>
          <p class="text-gray-400 mb-4">
            Complex JOIN scenarios, multiple table joins, and advanced
            relationship patterns.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Multi-Table JOINs - 3+ Tables
-- Basic 3-table JOIN
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    oi.product_id,
    oi.quantity,
    oi.price AS item_price,
    p.name AS product_name
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
ORDER BY c.customer_id, o.order_date, oi.product_id;

-- 4-table JOIN with categories
SELECT 
    c.customer_id,
    c.first_name || ' ' || c.last_name AS customer_name,
    c.city,
    c.country,
    o.order_date,
    p.name AS product_name,
    cat.name AS category_name,
    oi.quantity,
    oi.price,
    oi.quantity * oi.price AS line_total
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
JOIN categories cat ON p.category_id = cat.category_id
WHERE o.order_date >= DATE('now', '-30 days')
ORDER BY o.order_date DESC, c.last_name;

-- Complex multi-table analysis
SELECT 
    cat.name AS category,
    c.country,
    COUNT(DISTINCT o.order_id) AS orders,
    COUNT(DISTINCT c.customer_id) AS customers,
    SUM(oi.quantity) AS units_sold,
    SUM(oi.quantity * oi.price) AS revenue,
    AVG(oi.price) AS avg_selling_price,
    AVG(p.price) AS avg_catalog_price
FROM categories cat
JOIN products p ON cat.category_id = p.category_id
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
JOIN customers c ON o.customer_id = c.customer_id
GROUP BY cat.name, c.country
HAVING SUM(oi.quantity * oi.price) > 1000
ORDER BY revenue DESC;

-- Mixed JOIN types in multi-table query
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.registration_date,
    -- Order info (INNER JOIN - only customers with orders)
    o.order_count,
    o.total_spent,
    o.last_order_date,
    -- Address info (LEFT JOIN - all customers, address if available)
    COALESCE(addr.address, 'No address on file') AS address,
    -- Recent orders (LEFT JOIN - all customers, recent orders if any)
    recent.recent_orders,
    recent.recent_total
FROM customers c
INNER JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS order_count,
        SUM(total_amount) AS total_spent,
        MAX(order_date) AS last_order_date
    FROM orders
    GROUP BY customer_id
) o ON c.customer_id = o.customer_id
LEFT JOIN (
    SELECT 
        customer_id,
        address || ', ' || city || ', ' || country AS address
    FROM customers
    WHERE address IS NOT NULL
) addr ON c.customer_id = addr.customer_id
LEFT JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS recent_orders,
        SUM(total_amount) AS recent_total
    FROM orders
    WHERE order_date >= DATE('now', '-90 days')
    GROUP BY customer_id
) recent ON c.customer_id = recent.customer_id
ORDER BY o.total_spent DESC;

-- Self-JOIN with multi-table context
-- Find customers who bought the same products
SELECT DISTINCT
    c1.customer_id AS customer1_id,
    c1.first_name || ' ' || c1.last_name AS customer1_name,
    c2.customer_id AS customer2_id,
    c2.first_name || ' ' || c2.last_name AS customer2_name,
    p.name AS common_product,
    cat.name AS product_category
FROM customers c1
JOIN orders o1 ON c1.customer_id = o1.customer_id
JOIN order_items oi1 ON o1.order_id = oi1.order_id
JOIN products p ON oi1.product_id = p.product_id
JOIN categories cat ON p.category_id = cat.category_id
JOIN order_items oi2 ON p.product_id = oi2.product_id
JOIN orders o2 ON oi2.order_id = o2.order_id
JOIN customers c2 ON o2.customer_id = c2.customer_id
WHERE c1.customer_id < c2.customer_id  -- Avoid duplicates and self-matches
ORDER BY common_product, c1.customer_id;

-- Hierarchical JOINs (self-referencing with multi-table)
-- Assuming we have employee hierarchy
CREATE TEMPORARY TABLE employees_hierarchy AS
SELECT 1 AS emp_id, 'John Manager' AS name, NULL AS manager_id, 'Sales' AS department
UNION ALL SELECT 2, 'Jane Lead', 1, 'Sales'
UNION ALL SELECT 3, 'Bob Rep', 2, 'Sales'
UNION ALL SELECT 4, 'Alice Rep', 2, 'Sales'
UNION ALL SELECT 5, 'Charlie Manager', NULL, 'IT'
UNION ALL SELECT 6, 'David Dev', 5, 'IT';

SELECT 
    e.emp_id,
    e.name AS employee_name,
    e.department,
    m.name AS manager_name,
    COALESCE(m.name, 'No Manager') AS manager_display,
    -- Count subordinates
    COALESCE(sub.subordinate_count, 0) AS direct_reports
FROM employees_hierarchy e
LEFT JOIN employees_hierarchy m ON e.manager_id = m.emp_id
LEFT JOIN (
    SELECT 
        manager_id,
        COUNT(*) AS subordinate_count
    FROM employees_hierarchy
    WHERE manager_id IS NOT NULL
    GROUP BY manager_id
) sub ON e.emp_id = sub.manager_id
ORDER BY e.department, e.emp_id;"
              >
                <h3 class="text-lg font-semibold text-violet-400 mb-2">
                  1. Multi-Table JOINs (3+ Tables)
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Complex scenarios joining multiple tables with mixed JOIN
                  types
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Multiple table JOINs | Mixed JOIN types | Hierarchical
                  relationships | Complex analysis
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced JOIN Patterns and Techniques
-- JOIN with multiple conditions
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id 
             AND o.order_date >= DATE('now', '-1 year')  -- Additional JOIN condition
             AND o.total_amount > 50
ORDER BY c.customer_id, o.order_date;

-- JOIN with range conditions
SELECT 
    p1.product_id AS product1_id,
    p1.name AS product1_name,
    p1.price AS product1_price,
    p2.product_id AS product2_id,
    p2.name AS product2_name,
    p2.price AS product2_price,
    ABS(p1.price - p2.price) AS price_difference
FROM products p1
JOIN products p2 ON p1.category_id = p2.category_id
                AND p1.product_id != p2.product_id
                AND ABS(p1.price - p2.price) <= 10  -- Similar priced products
ORDER BY p1.category_id, price_difference;

-- Conditional JOINs with CASE
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    CASE 
        WHEN o.total_amount > 1000 THEN 'High Value'
        WHEN o.total_amount > 500 THEN 'Medium Value'
        WHEN o.total_amount > 100 THEN 'Low Value'
        ELSE 'Minimal Value'
    END AS order_category
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE CASE 
    WHEN c.country = 'USA' THEN o.total_amount > 50
    WHEN c.country = 'Canada' THEN o.total_amount > 75
    ELSE o.total_amount > 100
END OR o.total_amount IS NULL  -- Include customers with no orders
ORDER BY c.customer_id, o.order_date;

-- JOIN with aggregated subqueries
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    customer_stats.order_count,
    customer_stats.total_spent,
    customer_stats.avg_order_value,
    customer_stats.first_order_date,
    customer_stats.last_order_date,
    -- Compare to category averages
    category_stats.category_avg_order_value,
    ROUND(customer_stats.avg_order_value - category_stats.category_avg_order_value, 2) AS variance_from_category_avg
FROM customers c
JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS order_count,
        SUM(total_amount) AS total_spent,
        AVG(total_amount) AS avg_order_value,
        MIN(order_date) AS first_order_date,
        MAX(order_date) AS last_order_date
    FROM orders
    GROUP BY customer_id
) customer_stats ON c.customer_id = customer_stats.customer_id
JOIN (
    SELECT 
        c.country,
        AVG(o.total_amount) AS category_avg_order_value
    FROM customers c
    JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.country
) category_stats ON c.country = category_stats.country
ORDER BY customer_stats.total_spent DESC;

-- Recursive-like JOINs (finding indirect relationships)
-- Find customers who bought products from the same suppliers (if we had supplier data)
WITH product_relationships AS (
    SELECT DISTINCT
        oi1.product_id AS product1_id,
        oi2.product_id AS product2_id,
        p1.name AS product1_name,
        p2.name AS product2_name,
        p1.category_id
    FROM order_items oi1
    JOIN order_items oi2 ON oi1.order_id = oi2.order_id 
                        AND oi1.product_id != oi2.product_id
    JOIN products p1 ON oi1.product_id = p1.product_id
    JOIN products p2 ON oi2.product_id = p2.product_id
    WHERE p1.category_id = p2.category_id
)
SELECT 
    pr.category_id,
    pr.product1_name,
    pr.product2_name,
    COUNT(*) AS times_bought_together
FROM product_relationships pr
GROUP BY pr.category_id, pr.product1_id, pr.product2_id, pr.product1_name, pr.product2_name
HAVING COUNT(*) > 1
ORDER BY times_bought_together DESC;

-- Pivoting with JOINs (creating pivot-like results)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    SUM(CASE WHEN cat.name = 'Electronics' THEN oi.quantity * oi.price ELSE 0 END) AS electronics_spent,
    SUM(CASE WHEN cat.name = 'Clothing' THEN oi.quantity * oi.price ELSE 0 END) AS clothing_spent,
    SUM(CASE WHEN cat.name = 'Books' THEN oi.quantity * oi.price ELSE 0 END) AS books_spent,
    SUM(CASE WHEN cat.name = 'Home' THEN oi.quantity * oi.price ELSE 0 END) AS home_spent,
    SUM(oi.quantity * oi.price) AS total_spent
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
JOIN categories cat ON p.category_id = cat.category_id
GROUP BY c.customer_id, c.first_name, c.last_name
HAVING SUM(oi.quantity * oi.price) > 100
ORDER BY total_spent DESC;

-- Time-series JOINs (comparing different time periods)
WITH monthly_sales AS (
    SELECT 
        strftime('%Y-%m', order_date) AS month,
        SUM(total_amount) AS monthly_revenue,
        COUNT(*) AS monthly_orders
    FROM orders
    GROUP BY strftime('%Y-%m', order_date)
)
SELECT 
    current_month.month AS current_month,
    current_month.monthly_revenue AS current_revenue,
    current_month.monthly_orders AS current_orders,
    prev_month.month AS previous_month,
    prev_month.monthly_revenue AS previous_revenue,
    prev_month.monthly_orders AS previous_orders,
    ROUND(
        (current_month.monthly_revenue - COALESCE(prev_month.monthly_revenue, 0)) * 100.0 / 
        NULLIF(COALESCE(prev_month.monthly_revenue, 0), 0), 2
    ) AS revenue_growth_pct,
    current_month.monthly_orders - COALESCE(prev_month.monthly_orders, 0) AS order_count_change
FROM monthly_sales current_month
LEFT JOIN monthly_sales prev_month ON 
    DATE(current_month.month || '-01', '+1 month') = DATE(prev_month.month || '-01', '+2 months')
ORDER BY current_month.month;

-- Performance optimization with JOIN ordering
-- Efficient: Join smaller result sets first
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    recent_orders.order_count,
    high_value_products.product_count
FROM (
    -- Start with filtered, smaller result set
    SELECT customer_id, COUNT(*) AS order_count
    FROM orders 
    WHERE order_date >= DATE('now', '-90 days')
    GROUP BY customer_id
) recent_orders
JOIN customers c ON recent_orders.customer_id = c.customer_id
LEFT JOIN (
    SELECT 
        o.customer_id,
        COUNT(DISTINCT oi.product_id) AS product_count
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN products p ON oi.product_id = p.product_id
    WHERE p.price > 100
    GROUP BY o.customer_id
) high_value_products ON c.customer_id = high_value_products.customer_id
ORDER BY recent_orders.order_count DESC;"
              >
                <h3 class="text-lg font-semibold text-violet-400 mb-2">
                  2. Advanced JOIN Patterns
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Complex conditions, range JOINs, pivoting, time-series, and
                  performance optimization
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Multiple JOIN conditions | Range JOINs | Conditional JOINs |
                  Performance patterns
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-cyan-300"
          >
            Table Relationships & Joins
          </h2>
          <p class="text-gray-400 mb-4">
            Combine data from multiple tables using JOIN operations. This is
            where relational databases shine!
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- INNER JOIN - only matching records
SELECT 
    p.name as product_name,
    c.name as category_name,
    p.price,
    p.stock_quantity
FROM products p
INNER JOIN categories c ON p.category_id = c.category_id
ORDER BY c.name, p.name;

-- Multiple table INNER JOIN
SELECT 
    o.order_id,
    CONCAT(cu.first_name, ' ', cu.last_name) as customer_name,
    o.order_date,
    o.total_amount
FROM orders o
INNER JOIN customers cu ON o.customer_id = cu.customer_id
WHERE o.status = 'completed'
ORDER BY o.order_date DESC;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  1. INNER JOIN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Return only rows that have matching values in both tables
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  INNER JOIN categories c ON p.category_id = c.category_id
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LEFT JOIN - all records from left table
SELECT 
    c.name as category_name,
    COUNT(p.product_id) as product_count,
    COALESCE(AVG(p.price), 0) as avg_price
FROM categories c
LEFT JOIN products p ON c.category_id = p.category_id
GROUP BY c.category_id, c.name
ORDER BY product_count DESC;

-- Find customers with no orders
SELECT 
    cu.customer_id,
    CONCAT(cu.first_name, ' ', cu.last_name) as customer_name,
    cu.email,
    cu.registration_date
FROM customers cu
LEFT JOIN orders o ON cu.customer_id = o.customer_id
WHERE o.customer_id IS NULL;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  2. LEFT JOIN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Return all rows from left table, with NULLs for non-matching
                  right table rows
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  LEFT JOIN products p ON c.category_id = p.category_id
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Complex JOIN with order details
SELECT 
    o.order_id,
    CONCAT(cu.first_name, ' ', cu.last_name) as customer_name,
    o.order_date,
    p.name as product_name,
    c.name as category_name,
    oi.quantity,
    oi.unit_price,
    (oi.quantity * oi.unit_price) as line_total
FROM orders o
INNER JOIN customers cu ON o.customer_id = cu.customer_id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.product_id
INNER JOIN categories c ON p.category_id = c.category_id
WHERE o.status IN ('completed', 'shipped')
ORDER BY o.order_date DESC, o.order_id;

-- Self-join example (if we had manager relationships)
-- Find products in same category
SELECT 
    p1.name as product1,
    p2.name as product2,
    c.name as category
FROM products p1
INNER JOIN products p2 ON p1.category_id = p2.category_id AND p1.product_id < p2.product_id
INNER JOIN categories c ON p1.category_id = c.category_id
ORDER BY c.name;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  3. Multi-Table Joins
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Join multiple tables to create comprehensive result sets
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  FROM orders o JOIN customers cu ON... JOIN order_items oi
                  ON...
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- RIGHT JOIN (less common)
SELECT 
    cu.first_name,
    cu.last_name,
    o.order_id,
    o.total_amount
FROM orders o
RIGHT JOIN customers cu ON o.customer_id = cu.customer_id
ORDER BY cu.last_name;

-- FULL OUTER JOIN
SELECT 
    cu.customer_id,
    cu.first_name,
    cu.last_name,
    o.order_id,
    o.total_amount
FROM customers cu
FULL OUTER JOIN orders o ON cu.customer_id = o.customer_id
ORDER BY cu.customer_id;

-- CROSS JOIN (Cartesian product)
SELECT 
    c.name as category_name,
    COUNT(p.product_id) as product_count
FROM categories c
CROSS JOIN (SELECT COUNT(*) as total FROM products) totals
LEFT JOIN products p ON c.category_id = p.category_id
GROUP BY c.category_id, c.name, totals.total;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  4. Other Join Types
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  RIGHT JOIN, FULL OUTER JOIN, and CROSS JOIN for special cases
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  RIGHT JOIN, FULL OUTER JOIN, CROSS JOIN
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-cyan-300"
          >
            Database & Schema Management (DDL)
          </h2>
          <p class="text-gray-400 mb-4">
            Data Definition Language (DDL) commands for creating, modifying, and
            managing database structures.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Database operations in DuckDB
-- DuckDB works with files, so database operations are file-based

-- Create a new database (connects to a file)
-- In browser, this creates an in-memory database
PRAGMA database_list;

-- Show current database information
SELECT current_database();

-- Attach additional database files
ATTACH 'sales_database.db' AS sales_db;
ATTACH 'analytics_database.db' AS analytics_db;

-- List all attached databases
PRAGMA database_list;

-- Use specific database (switch context)
USE sales_db;

-- Detach databases when done
DETACH sales_db;
DETACH analytics_db;

-- Show memory usage
PRAGMA database_size;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  1. Database Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Create, attach, and manage multiple databases
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ATTACH 'database.db' AS db_alias; USE database;
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Schema operations
-- Create schemas for organizing tables
CREATE SCHEMA IF NOT EXISTS sales;
CREATE SCHEMA IF NOT EXISTS inventory;
CREATE SCHEMA IF NOT EXISTS analytics;

-- List all schemas
SELECT schema_name FROM information_schema.schemata;

-- Create table in specific schema
CREATE TABLE sales.customers (
    customer_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE
);

CREATE TABLE inventory.products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(200) NOT NULL,
    category VARCHAR(50)
);

-- Set default schema
SET search_path = sales;

-- Query from specific schema
SELECT * FROM sales.customers;
SELECT * FROM inventory.products;

-- Drop schema (must be empty)
DROP SCHEMA IF EXISTS analytics CASCADE;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  2. Schema Management
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Organize tables into schemas for better structure
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE SCHEMA schema_name; DROP SCHEMA schema_name;
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Table information and metadata
-- Show all tables
SHOW TABLES;

-- Show tables from all schemas
SELECT table_schema, table_name, table_type 
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'pg_catalog');

-- Describe table structure
DESCRIBE customers;
PRAGMA table_info('customers');

-- Show create statement for table
SELECT sql FROM sqlite_master WHERE type='table' AND name='customers';

-- Get table sizes and row counts
SELECT 
    table_name,
    (SELECT COUNT(*) FROM customers) as row_count
FROM information_schema.tables 
WHERE table_name = 'customers';

-- Show column information
SELECT 
    column_name,
    data_type,
    is_nullable,
    column_default
FROM information_schema.columns 
WHERE table_name = 'customers'
ORDER BY ordinal_position;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  3. Table Information
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Inspect table structure and metadata
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DESCRIBE table_name; SHOW TABLES; PRAGMA table_info();
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-cyan-300"
          >
            Table Operations - CREATE, DROP, TRUNCATE
          </h2>
          <p class="text-gray-400 mb-4">
            Complete guide to creating tables from other tables, dropping, and
            truncating.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- CREATE TABLE AS SELECT (CTAS) - Create table from query results
-- Basic table creation from existing data
CREATE TABLE high_value_customers AS
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    MAX(o.order_date) AS last_order_date
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.registration_date
HAVING COALESCE(SUM(o.total_amount), 0) > 1000;

-- Create table with calculated columns
CREATE TABLE product_analytics AS
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.stock_quantity,
    p.category_id,
    c.name AS category_name,
    p.price * p.stock_quantity AS inventory_value,
    COALESCE(sales_data.units_sold, 0) AS units_sold,
    COALESCE(sales_data.revenue, 0) AS total_revenue,
    CASE 
        WHEN COALESCE(sales_data.units_sold, 0) = 0 THEN 'No Sales'
        WHEN COALESCE(sales_data.units_sold, 0) < 10 THEN 'Low Sales'
        WHEN COALESCE(sales_data.units_sold, 0) < 50 THEN 'Medium Sales'
        ELSE 'High Sales'
    END AS sales_category,
    ROUND(p.stock_quantity / NULLIF(COALESCE(sales_data.units_sold, 0), 0), 2) AS months_of_inventory
FROM products p
JOIN categories c ON p.category_id = c.category_id
LEFT JOIN (
    SELECT 
        oi.product_id,
        SUM(oi.quantity) AS units_sold,
        SUM(oi.price * oi.quantity) AS revenue
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    WHERE o.order_date >= DATE('now', '-12 months')
    GROUP BY oi.product_id
) sales_data ON p.product_id = sales_data.product_id;

-- Create summary tables for reporting
CREATE TABLE monthly_sales_summary AS
SELECT 
    strftime('%Y', order_date) AS year,
    strftime('%m', order_date) AS month,
    strftime('%Y-%m', order_date) AS year_month,
    COUNT(*) AS total_orders,
    COUNT(DISTINCT customer_id) AS unique_customers,
    SUM(total_amount) AS total_revenue,
    AVG(total_amount) AS avg_order_value,
    MIN(total_amount) AS min_order_value,
    MAX(total_amount) AS max_order_value,
    -- Calculate metrics
    SUM(total_amount) / COUNT(DISTINCT customer_id) AS revenue_per_customer,
    COUNT(*) / COUNT(DISTINCT customer_id) AS orders_per_customer
FROM orders
WHERE order_date IS NOT NULL
GROUP BY strftime('%Y-%m', order_date)
ORDER BY year_month;

-- Create temporary working tables
CREATE TEMPORARY TABLE customer_segments AS
WITH customer_metrics AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        c.registration_date,
        COUNT(o.order_id) AS order_count,
        COALESCE(SUM(o.total_amount), 0) AS total_spent,
        COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
        MAX(o.order_date) AS last_order_date,
        JULIANDAY('now') - JULIANDAY(MAX(o.order_date)) AS days_since_last_order
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name, c.registration_date
),
customer_scores AS (
    SELECT 
        *,
        NTILE(5) OVER (ORDER BY total_spent DESC) AS spending_quintile,
        NTILE(5) OVER (ORDER BY order_count DESC) AS frequency_quintile,
        CASE 
            WHEN days_since_last_order IS NULL THEN 5
            WHEN days_since_last_order <= 30 THEN 1
            WHEN days_since_last_order <= 90 THEN 2
            WHEN days_since_last_order <= 180 THEN 3
            WHEN days_since_last_order <= 365 THEN 4
            ELSE 5
        END AS recency_score
    FROM customer_metrics
)
SELECT 
    *,
    spending_quintile + frequency_quintile + recency_score AS total_score,
    CASE 
        WHEN spending_quintile = 1 AND frequency_quintile <= 2 AND recency_score <= 2 THEN 'Champions'
        WHEN spending_quintile <= 2 AND frequency_quintile <= 2 AND recency_score <= 2 THEN 'Loyal Customers'
        WHEN spending_quintile <= 3 AND frequency_quintile <= 2 AND recency_score <= 2 THEN 'Potential Loyalists'
        WHEN spending_quintile <= 2 AND frequency_quintile <= 3 AND recency_score <= 3 THEN 'New Customers'
        WHEN spending_quintile >= 3 AND frequency_quintile >= 3 AND recency_score <= 3 THEN 'Promising'
        WHEN spending_quintile <= 2 AND recency_score >= 3 THEN 'Need Attention'
        WHEN spending_quintile >= 3 AND frequency_quintile >= 3 AND recency_score >= 3 THEN 'About to Sleep'
        WHEN recency_score >= 4 THEN 'At Risk'
        ELSE 'Cannot Lose Them'
    END AS customer_segment
FROM customer_scores;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  1. CREATE TABLE AS SELECT
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Create new tables from query results with data and structure
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE TABLE new_table AS SELECT columns FROM existing_table
                  WHERE conditions
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- CREATE TABLE LIKE - Copy structure without data
-- Copy table structure only (note: syntax varies by database)
-- PostgreSQL/MySQL syntax:
-- CREATE TABLE customers_backup LIKE customers;

-- SQLite equivalent - create empty table with same structure
CREATE TABLE customers_backup AS 
SELECT * FROM customers WHERE 1=0;  -- WHERE 1=0 ensures no data is copied

-- Verify the structure was copied
SELECT sql FROM sqlite_master WHERE name = 'customers_backup';

-- Create table with modified structure
CREATE TABLE customers_enhanced AS
SELECT 
    customer_id,
    first_name,
    last_name,
    email,
    phone,
    address,
    city,
    country,
    registration_date,
    -- Add computed columns
    CURRENT_TIMESTAMP AS created_at,
    NULL AS last_login,
    0 AS total_orders,
    0.0 AS total_spent,
    'active' AS status
FROM customers
WHERE 1=0;  -- No data, structure only

-- Insert sample data into the new structure
INSERT INTO customers_enhanced (
    customer_id, first_name, last_name, email, phone, 
    address, city, country, registration_date, 
    total_orders, total_spent, status
)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.phone,
    c.address,
    c.city,
    c.country,
    c.registration_date,
    COALESCE(order_stats.order_count, 0),
    COALESCE(order_stats.total_amount, 0.0),
    CASE 
        WHEN order_stats.last_order_date >= DATE('now', '-90 days') THEN 'active'
        WHEN order_stats.last_order_date >= DATE('now', '-365 days') THEN 'inactive'
        WHEN order_stats.order_count = 0 THEN 'prospect'
        ELSE 'dormant'
    END
FROM customers c
LEFT JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS order_count,
        SUM(total_amount) AS total_amount,
        MAX(order_date) AS last_order_date
    FROM orders
    GROUP BY customer_id
) order_stats ON c.customer_id = order_stats.customer_id;

-- CREATE TABLE with explicit column definitions
CREATE TABLE order_archive (
    archive_id INTEGER PRIMARY KEY,
    original_order_id INTEGER NOT NULL,
    customer_id INTEGER NOT NULL,
    order_date DATE NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL,
    status TEXT NOT NULL,
    archived_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    archive_reason TEXT,
    original_data TEXT  -- JSON or serialized original data
);

-- Populate archive table
INSERT INTO order_archive (
    original_order_id, customer_id, order_date, 
    total_amount, status, archive_reason
)
SELECT 
    order_id,
    customer_id,
    order_date,
    total_amount,
    status,
    'Quarterly archive process'
FROM orders
WHERE order_date < DATE('now', '-2 years')
AND status IN ('completed', 'shipped', 'delivered');"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  2. CREATE TABLE LIKE and Structure Copy
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Copy table structure and create enhanced versions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE TABLE new_table LIKE existing_table | SELECT * FROM
                  table WHERE 1=0
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- DROP TABLE and DATABASE Operations
-- Basic table dropping
-- DROP TABLE customers_backup;  -- Permanently deletes the table

-- Safe dropping with IF EXISTS
DROP TABLE IF EXISTS customers_backup;
DROP TABLE IF EXISTS temp_analysis_table;
DROP TABLE IF EXISTS monthly_sales_summary;

-- Drop multiple related tables
DROP TABLE IF EXISTS order_archive;
DROP TABLE IF EXISTS customer_segments;
DROP TABLE IF EXISTS product_analytics;
DROP TABLE IF EXISTS high_value_customers;

-- Drop temporary tables (automatically dropped at session end)
DROP TABLE IF EXISTS temp_customer_analysis;

-- Verify tables are dropped
SELECT name, type, sql 
FROM sqlite_master 
WHERE type='table' 
AND name NOT LIKE 'sqlite_%'
ORDER BY name;

-- CASCADE and RESTRICT options (where supported)
-- Note: SQLite doesn't support CASCADE/RESTRICT, but other databases do
-- DROP TABLE orders CASCADE;    -- Also drops dependent views/constraints
-- DROP TABLE orders RESTRICT;   -- Fails if dependencies exist

-- Database operations (where supported)
-- CREATE DATABASE analytics_db;
-- DROP DATABASE analytics_db;
-- DROP DATABASE IF EXISTS old_analytics_db;

-- Schema operations
-- CREATE SCHEMA reporting;
-- DROP SCHEMA reporting CASCADE;

-- Best practices for dropping
-- 1. Always backup before dropping production tables
CREATE TABLE customers_backup_$(strftime('%Y%m%d_%H%M%S', 'now')) AS 
SELECT * FROM customers;

-- 2. Check for dependencies before dropping
SELECT 
    type,
    name,
    sql
FROM sqlite_master 
WHERE sql LIKE '%customers%'  -- Find references to customers table
AND type IN ('table', 'view', 'index', 'trigger');

-- 3. Document what you're dropping
-- Creating a log of dropped objects
CREATE TABLE IF NOT EXISTS drop_log (
    drop_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    object_type TEXT,
    object_name TEXT,
    drop_reason TEXT,
    backed_up BOOLEAN DEFAULT FALSE
);

INSERT INTO drop_log (object_type, object_name, drop_reason, backed_up)
VALUES ('table', 'old_analysis_table', 'Obsolete analysis table', TRUE);

-- 4. Safe dropping procedure
-- Step 1: Create backup
CREATE TABLE analysis_backup AS SELECT * FROM analysis_table;

-- Step 2: Verify backup
SELECT COUNT(*) AS original_count FROM analysis_table
UNION ALL
SELECT COUNT(*) AS backup_count FROM analysis_backup;

-- Step 3: Drop original (uncomment when ready)
-- DROP TABLE analysis_table;

-- Step 4: Log the action
INSERT INTO drop_log (object_type, object_name, drop_reason, backed_up)
VALUES ('table', 'analysis_table', 'Replaced with new version', TRUE);"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  3. DROP TABLE and Safe Deletion
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Safely remove tables with backup and verification procedures
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP TABLE [IF EXISTS] table_name | Create backups before
                  dropping
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- TRUNCATE TABLE - Remove all data, keep structure
-- Note: SQLite doesn't have TRUNCATE, use DELETE instead
-- Other databases: TRUNCATE TABLE table_name;

-- SQLite equivalent of TRUNCATE
DELETE FROM temp_table;  -- Removes all rows
-- VACUUM;  -- Optional: reclaim space

-- Demonstrate the difference between DELETE and TRUNCATE concepts
-- Create a test table
CREATE TABLE truncate_demo (
    id INTEGER PRIMARY KEY,
    name TEXT,
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert test data
INSERT INTO truncate_demo (name) 
VALUES ('Test 1'), ('Test 2'), ('Test 3'), ('Test 4'), ('Test 5');

-- Show current data
SELECT COUNT(*) AS row_count FROM truncate_demo;
SELECT * FROM truncate_demo;

-- Method 1: DELETE (equivalent to TRUNCATE in SQLite)
DELETE FROM truncate_demo;

-- Verify table is empty but structure remains
SELECT COUNT(*) AS row_count FROM truncate_demo;
SELECT sql FROM sqlite_master WHERE name = 'truncate_demo';

-- Insert new data to verify structure is intact
INSERT INTO truncate_demo (name) VALUES ('After truncate');
SELECT * FROM truncate_demo;

-- Comparison of data removal methods
CREATE TABLE data_removal_demo (
    id INTEGER PRIMARY KEY,
    category TEXT,
    value INTEGER,
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert sample data
INSERT INTO data_removal_demo (category, value)
SELECT 
    CASE (ROW_NUMBER() OVER()) % 3
        WHEN 0 THEN 'Category A'
        WHEN 1 THEN 'Category B'
        ELSE 'Category C'
    END,
    (ROW_NUMBER() OVER()) * 10
FROM (
    SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5
    UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10
);

-- Show original data
SELECT COUNT(*) AS total_rows, 
       COUNT(DISTINCT category) AS categories,
       AVG(value) AS avg_value
FROM data_removal_demo;

-- Method 1: DELETE with condition (partial removal)
DELETE FROM data_removal_demo WHERE category = 'Category A';

SELECT 'After DELETE Category A' AS operation,
       COUNT(*) AS remaining_rows,
       COUNT(DISTINCT category) AS categories
FROM data_removal_demo;

-- Method 2: DELETE all (TRUNCATE equivalent)
DELETE FROM data_removal_demo;

SELECT 'After DELETE all' AS operation,
       COUNT(*) AS remaining_rows
FROM data_removal_demo;

-- Verify structure still exists
SELECT name, sql FROM sqlite_master WHERE name = 'data_removal_demo';

-- Performance considerations
-- For large tables, consider:
-- 1. Batch deletion for very large tables
-- 2. Using transactions for safety
-- 3. VACUUM after large deletions to reclaim space

-- Batch deletion example (for large tables)
-- DELETE FROM large_table WHERE id IN (
--     SELECT id FROM large_table LIMIT 10000
-- );

-- Transaction-safe truncation
BEGIN TRANSACTION;

-- Create backup before truncation
CREATE TABLE truncate_backup AS 
SELECT * FROM data_removal_demo;

-- Perform truncation
DELETE FROM data_removal_demo;

-- Verify truncation
SELECT 'Original backup' AS source, COUNT(*) AS count FROM truncate_backup
UNION ALL
SELECT 'After truncate', COUNT(*) FROM data_removal_demo;

-- Commit or rollback based on verification
COMMIT;  -- Use ROLLBACK; if there are issues

-- Cleanup demonstration tables
DROP TABLE IF EXISTS truncate_demo;
DROP TABLE IF EXISTS data_removal_demo;
DROP TABLE IF EXISTS truncate_backup;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  4. TRUNCATE TABLE (DELETE Equivalent)
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Remove all data while preserving table structure
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  TRUNCATE TABLE table_name | DELETE FROM table_name (SQLite)
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-blue-300"
          >
            Getting Started
          </h2>
          <p class="text-gray-400 mb-4">
            Welcome to your interactive SQL playground powered by DuckDB
            WebAssembly! This environment runs entirely in your browser with no
            server required. Start experimenting with the sample data below or
            create your own tables.
          </p>
          <div
            class="bg-blue-900/30 border border-blue-700 rounded-lg p-4 mb-4"
          >
            <h3 class="text-blue-300 font-semibold mb-2">
               Quick Start Tips
            </h3>
            <ul class="text-blue-200 text-sm space-y-1">
              <li> Click any example to copy it to the editor</li>
              <li> Use Ctrl+Enter (Cmd+Enter on Mac) to run queries</li>
              <li> Watch the Schema Viewer update as you create tables</li>
              <li>
                 Try the progressive examples below to learn SQL concepts
              </li>
            </ul>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-yellow-300"
          >
            Basic Queries & Data Exploration
          </h2>
          <p class="text-gray-400 mb-4">
            Start with fundamental SQL operations to explore your data. These
            queries form the foundation of data analysis.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic SELECT operations
SELECT * FROM customers LIMIT 5;

-- Select specific columns
SELECT first_name, last_name, email, city FROM customers;

-- Count total records
SELECT COUNT(*) as total_customers FROM customers;

-- View table structure
DESCRIBE customers;"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  1. Basic SELECT Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Retrieve data from tables and explore table structure
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT * FROM customers; -- Get all customer data
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Filtering with WHERE clause
SELECT * FROM products WHERE price > 100;

-- Multiple conditions
SELECT name, price FROM products 
WHERE price BETWEEN 50 AND 200 AND stock_quantity > 50;

-- Text pattern matching
SELECT * FROM customers WHERE email LIKE '%gmail%';

-- Working with NULL values
SELECT * FROM products WHERE description IS NOT NULL;

-- Filtering dates
SELECT * FROM orders WHERE order_date >= '2024-01-18';"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  2. Filtering Data
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Use WHERE clauses to filter rows based on conditions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE price > 100 AND stock_quantity > 50
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Sorting results
SELECT name, price FROM products ORDER BY price DESC;

-- Multiple sort columns
SELECT first_name, last_name, city FROM customers 
ORDER BY city, last_name;

-- Limiting results
SELECT name, price FROM products 
ORDER BY price DESC 
LIMIT 5;

-- Pagination with OFFSET
SELECT name, price FROM products 
ORDER BY price DESC 
LIMIT 5 OFFSET 5;"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  3. Sorting and Limiting
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Order results and control the number of rows returned
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ORDER BY price DESC LIMIT 5
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Remove duplicates
SELECT DISTINCT city FROM customers;

-- Distinct with multiple columns
SELECT DISTINCT category_id, is_active FROM products;

-- Unique email domains
SELECT DISTINCT 
    substring(email FROM position('@' in email) + 1) as email_domain
FROM customers
ORDER BY email_domain;"
              >
                <h3 class="text-lg font-semibold text-yellow-400 mb-2">
                  4. Working with Unique Values
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Find distinct values and eliminate duplicates
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT DISTINCT city FROM customers
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-orange-300"
          >
            Aggregation & Grouping
          </h2>
          <p class="text-gray-400 mb-4">
            Summarize data using aggregate functions and GROUP BY to gain
            insights from your dataset.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic aggregate functions
SELECT 
    COUNT(*) as total_products,
    AVG(price) as average_price,
    MIN(price) as cheapest_price,
    MAX(price) as most_expensive,
    SUM(stock_quantity) as total_inventory
FROM products;

-- String aggregation
SELECT string_agg(name, ', ') as product_list
FROM products
WHERE category_id = 1;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  1. Aggregate Functions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Calculate summary statistics across your data
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  COUNT(*), AVG(price), MIN(price), MAX(price)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Group by single column
SELECT 
    category_id,
    COUNT(*) as product_count,
    AVG(price) as avg_price,
    SUM(stock_quantity) as total_stock
FROM products
GROUP BY category_id
ORDER BY product_count DESC;

-- Group by multiple columns
SELECT 
    city,
    country,
    COUNT(*) as customer_count
FROM customers
GROUP BY city, country
ORDER BY customer_count DESC;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  2. GROUP BY Basics
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Group rows by common values for aggregate calculations
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  GROUP BY category_id
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Filter groups with HAVING
SELECT 
    category_id,
    COUNT(*) as product_count,
    AVG(price) as avg_price
FROM products
GROUP BY category_id
HAVING COUNT(*) > 2 AND AVG(price) > 50
ORDER BY avg_price DESC;

-- HAVING vs WHERE
SELECT 
    status,
    COUNT(*) as order_count,
    AVG(total_amount) as avg_order_value
FROM orders
WHERE order_date >= '2024-01-16'  -- Filter rows before grouping
GROUP BY status
HAVING COUNT(*) > 1;              -- Filter groups after aggregation"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  3. HAVING Clause
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Filter groups after aggregation (WHERE filters before
                  grouping)
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  HAVING COUNT(*) > 2 AND AVG(price) > 50
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced grouping with ROLLUP
SELECT 
    city,
    country,
    COUNT(*) as customer_count
FROM customers
GROUP BY ROLLUP(country, city)
ORDER BY country, city;

-- Group by date parts
SELECT 
    DATE_TRUNC('month', order_date) as order_month,
    COUNT(*) as order_count,
    SUM(total_amount) as monthly_revenue
FROM orders
GROUP BY DATE_TRUNC('month', order_date)
ORDER BY order_month;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  4. Advanced Grouping
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Use ROLLUP and date functions for hierarchical analysis
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  GROUP BY ROLLUP(country, city)
                </div>
              </button>
            </div>
          </div>
        

<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-emerald-300"
          >
            ORDER BY, GROUP BY, and LIMIT Clauses
          </h2>
          <p class="text-gray-400 mb-4">
            Complete guide to sorting, grouping, and limiting query results with
            all variations.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- ORDER BY Clause - Complete Guide
-- Basic sorting - ascending (ASC) is default
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY last_name;  -- Default ASC

-- Explicit ascending sort
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY last_name ASC;

-- Descending sort
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY registration_date DESC;

-- Multiple column sorting
SELECT customer_id, first_name, last_name, city, country, registration_date
FROM customers
ORDER BY country ASC, city ASC, last_name ASC;

-- Mixed sorting directions
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY country ASC, registration_date DESC;

-- Sort by column position (not recommended, but possible)
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY 2, 3;  -- Sort by 2nd column (first_name), then 3rd column (last_name)

-- Sort by calculated expressions
SELECT 
    customer_id,
    first_name,
    last_name,
    first_name || ' ' || last_name AS full_name,
    JULIANDAY('now') - JULIANDAY(registration_date) AS days_since_registration
FROM customers
ORDER BY days_since_registration DESC;

-- Sort by aggregate functions (with GROUP BY)
SELECT 
    country,
    COUNT(*) AS customer_count,
    AVG(JULIANDAY('now') - JULIANDAY(registration_date)) AS avg_days_registered
FROM customers
GROUP BY country
ORDER BY customer_count DESC, avg_days_registered ASC;

-- Sort with CASE expressions for custom ordering
SELECT 
    customer_id,
    first_name,
    last_name,
    city,
    country
FROM customers
ORDER BY 
    CASE country 
        WHEN 'USA' THEN 1
        WHEN 'Canada' THEN 2
        WHEN 'UK' THEN 3
        ELSE 4
    END,
    city;

-- Sort with NULL handling
SELECT 
    customer_id,
    first_name,
    last_name,
    phone
FROM customers
ORDER BY 
    CASE WHEN phone IS NULL THEN 1 ELSE 0 END,  -- NULLs last
    phone;

-- Complex sorting with subqueries
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    (SELECT COUNT(*) FROM orders WHERE customer_id = c.customer_id) AS order_count,
    (SELECT COALESCE(SUM(total_amount), 0) FROM orders WHERE customer_id = c.customer_id) AS total_spent
FROM customers c
ORDER BY total_spent DESC, order_count DESC;

-- Sort products by price with ties handled differently
SELECT 
    product_id,
    name,
    price,
    category_id,
    -- Show how ties are handled
    ROW_NUMBER() OVER (ORDER BY price DESC) AS row_num,
    RANK() OVER (ORDER BY price DESC) AS rank_num,
    DENSE_RANK() OVER (ORDER BY price DESC) AS dense_rank_num
FROM products
ORDER BY price DESC, name ASC;  -- Secondary sort breaks ties

-- Sort with string functions
SELECT 
    customer_id,
    first_name,
    last_name,
    LENGTH(last_name) AS name_length
FROM customers
ORDER BY LENGTH(last_name) DESC, last_name ASC;

-- Sort by date parts
SELECT 
    order_id,
    customer_id,
    order_date,
    total_amount
FROM orders
ORDER BY 
    strftime('%Y', order_date) DESC,  -- Year descending
    strftime('%m', order_date) ASC,   -- Month ascending
    strftime('%d', order_date) ASC;   -- Day ascending"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  1. ORDER BY Clause - Complete Sorting
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  All sorting variations: ASC/DESC, multiple columns,
                  expressions, and custom ordering
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ORDER BY column [ASC|DESC], column2 [ASC|DESC] | Sort by
                  expressions and functions
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- GROUP BY Clause - Complete Grouping Guide
-- Basic grouping
SELECT 
    country,
    COUNT(*) AS customer_count
FROM customers
GROUP BY country
ORDER BY customer_count DESC;

-- Multiple column grouping
SELECT 
    country,
    city,
    COUNT(*) AS customer_count,
    MIN(registration_date) AS first_registration,
    MAX(registration_date) AS last_registration
FROM customers
GROUP BY country, city
ORDER BY country, city;

-- Grouping with all major aggregate functions
SELECT 
    category_id,
    COUNT(*) AS product_count,
    COUNT(DISTINCT price) AS unique_prices,
    MIN(price) AS min_price,
    MAX(price) AS max_price,
    AVG(price) AS avg_price,
    SUM(stock_quantity) AS total_inventory,
    SUM(price * stock_quantity) AS total_inventory_value
FROM products
GROUP BY category_id
ORDER BY total_inventory_value DESC;

-- Grouping by date parts
SELECT 
    strftime('%Y', order_date) AS year,
    strftime('%m', order_date) AS month,
    COUNT(*) AS order_count,
    SUM(total_amount) AS monthly_revenue,
    AVG(total_amount) AS avg_order_value,
    COUNT(DISTINCT customer_id) AS unique_customers
FROM orders
GROUP BY strftime('%Y', order_date), strftime('%m', order_date)
ORDER BY year DESC, month DESC;

-- Grouping by calculated expressions
SELECT 
    CASE 
        WHEN JULIANDAY('now') - JULIANDAY(registration_date) <= 30 THEN '0-30 days'
        WHEN JULIANDAY('now') - JULIANDAY(registration_date) <= 90 THEN '31-90 days'
        WHEN JULIANDAY('now') - JULIANDAY(registration_date) <= 365 THEN '91-365 days'
        ELSE 'Over 1 year'
    END AS customer_age_group,
    COUNT(*) AS customer_count,
    COUNT(*) * 100.0 / (SELECT COUNT(*) FROM customers) AS percentage
FROM customers
GROUP BY customer_age_group
ORDER BY 
    CASE customer_age_group
        WHEN '0-30 days' THEN 1
        WHEN '31-90 days' THEN 2
        WHEN '91-365 days' THEN 3
        ELSE 4
    END;

-- Grouping with HAVING clause (filtering groups)
SELECT 
    country,
    COUNT(*) AS customer_count,
    AVG(JULIANDAY('now') - JULIANDAY(registration_date)) AS avg_days_registered
FROM customers
GROUP BY country
HAVING COUNT(*) >= 5  -- Only countries with 5+ customers
ORDER BY customer_count DESC;

-- Complex grouping with multiple conditions in HAVING
SELECT 
    category_id,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price,
    SUM(stock_quantity) AS total_stock
FROM products
GROUP BY category_id
HAVING COUNT(*) > 3 
   AND AVG(price) > 50 
   AND SUM(stock_quantity) > 100
ORDER BY avg_price DESC;

-- Grouping with ROLLUP-like functionality (manual in SQLite)
-- Grand totals with UNION
SELECT 
    country,
    city,
    COUNT(*) AS customer_count
FROM customers
GROUP BY country, city

UNION ALL

SELECT 
    country,
    'ALL CITIES' AS city,
    COUNT(*) AS customer_count
FROM customers
GROUP BY country

UNION ALL

SELECT 
    'ALL COUNTRIES' AS country,
    'ALL CITIES' AS city,
    COUNT(*) AS customer_count
FROM customers

ORDER BY 
    CASE WHEN country = 'ALL COUNTRIES' THEN 'zzz' ELSE country END,
    CASE WHEN city = 'ALL CITIES' THEN 'zzz' ELSE city END;

-- GROUP BY with window functions
SELECT 
    category_id,
    COUNT(*) AS products_in_category,
    AVG(price) AS avg_price_in_category,
    -- Compare to overall averages
    AVG(price) - (SELECT AVG(price) FROM products) AS price_diff_from_overall,
    COUNT(*) * 100.0 / (SELECT COUNT(*) FROM products) AS pct_of_total_products
FROM products
GROUP BY category_id
ORDER BY products_in_category DESC;

-- Grouping by ranges/buckets
SELECT 
    CASE 
        WHEN price < 20 THEN '$0-$19'
        WHEN price < 50 THEN '$20-$49'
        WHEN price < 100 THEN '$50-$99'
        WHEN price < 200 THEN '$100-$199'
        ELSE '$200+'
    END AS price_range,
    COUNT(*) AS product_count,
    MIN(price) AS min_price,
    MAX(price) AS max_price,
    AVG(price) AS avg_price
FROM products
GROUP BY price_range
ORDER BY MIN(price);

-- GROUP BY with complex aggregations and calculations
SELECT 
    c.country,
    COUNT(DISTINCT c.customer_id) AS total_customers,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_revenue,
    ROUND(COUNT(o.order_id) * 1.0 / COUNT(DISTINCT c.customer_id), 2) AS orders_per_customer,
    ROUND(COALESCE(SUM(o.total_amount), 0) / COUNT(DISTINCT c.customer_id), 2) AS revenue_per_customer,
    ROUND(COALESCE(SUM(o.total_amount), 0) / NULLIF(COUNT(o.order_id), 0), 2) AS avg_order_value
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.country
HAVING COUNT(DISTINCT c.customer_id) > 0
ORDER BY total_revenue DESC;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  2. GROUP BY Clause - Complete Grouping
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  All grouping variations: multiple columns, expressions,
                  HAVING, and complex aggregations
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  GROUP BY column1, column2 | HAVING conditions | Aggregate
                  functions | Date grouping
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LIMIT and OFFSET Clauses - Result Set Control
-- Basic LIMIT - get first N rows
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY registration_date DESC
LIMIT 5;

-- LIMIT with OFFSET - pagination
-- Page 1 (first 10 records)
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY customer_id
LIMIT 10 OFFSET 0;

-- Page 2 (next 10 records)
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY customer_id
LIMIT 10 OFFSET 10;

-- Page 3 (next 10 records)
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY customer_id
LIMIT 10 OFFSET 20;

-- Calculate pagination info
WITH pagination_info AS (
    SELECT 
        COUNT(*) AS total_records,
        10 AS page_size,
        CAST((COUNT(*) + 9) / 10 AS INTEGER) AS total_pages  -- Ceiling division
    FROM customers
)
SELECT 
    total_records,
    page_size,
    total_pages,
    'Page 1: LIMIT ' || page_size || ' OFFSET 0' AS page_1_sql,
    'Page 2: LIMIT ' || page_size || ' OFFSET ' || page_size AS page_2_sql,
    'Last Page: LIMIT ' || page_size || ' OFFSET ' || ((total_pages - 1) * page_size) AS last_page_sql
FROM pagination_info;

-- Top N analysis patterns
-- Top 5 customers by total spending
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COUNT(o.order_id) AS order_count
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name
ORDER BY total_spent DESC
LIMIT 5;

-- Top 10 products by sales volume
SELECT 
    p.product_id,
    p.name,
    p.price,
    COALESCE(SUM(oi.quantity), 0) AS units_sold,
    COALESCE(SUM(oi.quantity * oi.price), 0) AS revenue
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name, p.price
ORDER BY units_sold DESC
LIMIT 10;

-- Bottom 5 performers (least sales)
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.stock_quantity,
    COALESCE(SUM(oi.quantity), 0) AS units_sold
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name, p.price, p.stock_quantity
ORDER BY units_sold ASC, p.stock_quantity DESC
LIMIT 5;

-- Sampling data with LIMIT and random ordering
-- Get random sample of 10 customers
SELECT customer_id, first_name, last_name, email
FROM customers
ORDER BY RANDOM()  -- SQLite specific random ordering
LIMIT 10;

-- LIMIT with complex queries and subqueries
-- Get the 3 most recent orders for each customer
WITH customer_recent_orders AS (
    SELECT 
        customer_id,
        order_id,
        order_date,
        total_amount,
        ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date DESC) AS order_rank
    FROM orders
)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    cro.order_id,
    cro.order_date,
    cro.total_amount,
    cro.order_rank
FROM customers c
JOIN customer_recent_orders cro ON c.customer_id = cro.customer_id
WHERE cro.order_rank <= 3
ORDER BY c.customer_id, cro.order_rank;

-- Performance considerations with LIMIT
-- Efficient: LIMIT with indexed ORDER BY
SELECT customer_id, first_name, last_name
FROM customers
ORDER BY customer_id  -- If customer_id is indexed (primary key)
LIMIT 10;

-- Less efficient: LIMIT with non-indexed ORDER BY
SELECT customer_id, first_name, last_name
FROM customers
ORDER BY first_name  -- If first_name is not indexed
LIMIT 10;

-- LIMIT with calculated pagination metadata
WITH paginated_results AS (
    SELECT 
        customer_id,
        first_name,
        last_name,
        registration_date,
        ROW_NUMBER() OVER (ORDER BY customer_id) AS row_num
    FROM customers
),
pagination_meta AS (
    SELECT 
        COUNT(*) AS total_records,
        20 AS page_size,
        2 AS current_page  -- Showing page 2
    FROM customers
)
SELECT 
    pr.customer_id,
    pr.first_name,
    pr.last_name,
    pr.registration_date,
    pr.row_num,
    pm.current_page,
    pm.total_records,
    CAST((pm.total_records + pm.page_size - 1) / pm.page_size AS INTEGER) AS total_pages,
    CASE 
        WHEN pr.row_num = (pm.current_page - 1) * pm.page_size + 1 THEN 'First on page'
        WHEN pr.row_num = MIN(pm.current_page * pm.page_size, pm.total_records) THEN 'Last on page'
        ELSE 'Middle of page'
    END AS position_on_page
FROM paginated_results pr
CROSS JOIN pagination_meta pm
WHERE pr.row_num > (pm.current_page - 1) * pm.page_size 
  AND pr.row_num <= pm.current_page * pm.page_size
ORDER BY pr.row_num;

-- LIMIT in different contexts
-- With aggregation (get top categories by product count)
SELECT 
    c.category_id,
    c.name AS category_name,
    COUNT(p.product_id) AS product_count,
    AVG(p.price) AS avg_price
FROM categories c
LEFT JOIN products p ON c.category_id = p.category_id
GROUP BY c.category_id, c.name
ORDER BY product_count DESC
LIMIT 3;

-- With window functions (top 2 products per category)
WITH ranked_products AS (
    SELECT 
        p.product_id,
        p.name,
        p.price,
        c.name AS category_name,
        ROW_NUMBER() OVER (PARTITION BY p.category_id ORDER BY p.price DESC) AS price_rank
    FROM products p
    JOIN categories c ON p.category_id = c.category_id
)
SELECT 
    category_name,
    name AS product_name,
    price,
    price_rank
FROM ranked_products
WHERE price_rank <= 2
ORDER BY category_name, price_rank;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  3. LIMIT and OFFSET Clauses
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Pagination, top N analysis, sampling, and result set control
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  LIMIT n | LIMIT n OFFSET m | Pagination patterns | Top N
                  queries
                </div>
              </button>
            </div>
          </div>
        
</section>
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-purple-300"
          >
            Understanding Relational Databases
          </h2>
          <p class="text-gray-400 mb-4">
            SQL databases organize data in <strong>tables</strong> with rows and
            columns. Tables can be related through
            <strong>foreign keys</strong>, enabling complex data relationships
            while maintaining consistency.
          </p>
          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div class="bg-gray-800 p-4 rounded-lg">
              <h3 class="text-purple-300 font-semibold mb-2">Key Concepts</h3>
              <ul class="text-gray-300 text-sm space-y-1">
                <li>
                  <strong>Table:</strong> Collection of related data in rows and
                  columns
                </li>
                <li>
                  <strong>Primary Key:</strong> Uniquely identifies each row
                </li>
                <li>
                  <strong>Foreign Key:</strong> Links to primary key in another
                  table
                </li>
                <li>
                  <strong>Schema:</strong> Structure defining table
                  relationships
                </li>
                <li>
                  <strong>ACID:</strong> Atomicity, Consistency, Isolation,
                  Durability
                </li>
              </ul>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg">
              <h3 class="text-purple-300 font-semibold mb-2">
                DuckDB Advantages
              </h3>
              <ul class="text-gray-300 text-sm space-y-1">
                <li><strong>In-Process:</strong> No separate server needed</li>
                <li>
                  <strong>Analytics-First:</strong> Optimized for analytical
                  queries
                </li>
                <li>
                  <strong>SQL Standard:</strong> Full SQL support with
                  extensions
                </li>
                <li><strong>Zero-Copy:</strong> Efficient data processing</li>
                <li>
                  <strong>Embeddable:</strong> Works in browsers and
                  applications
                </li>
              </ul>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-orange-300"
          >
            ALTER TABLE Operations
          </h2>
          <p class="text-gray-400 mb-4">
            Modify existing table structures - add, drop, modify columns and
            constraints.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Add columns to existing table
ALTER TABLE customers ADD COLUMN phone VARCHAR(15);
ALTER TABLE customers ADD COLUMN date_of_birth DATE;
ALTER TABLE customers ADD COLUMN loyalty_points INTEGER DEFAULT 0;
ALTER TABLE customers ADD COLUMN created_at TIMESTAMP DEFAULT NOW();

-- Add column with constraints
ALTER TABLE customers ADD COLUMN credit_limit DECIMAL(10,2) CHECK (credit_limit >= 0);

-- Add multiple columns at once (if supported)
ALTER TABLE customers 
ADD COLUMN address_line1 VARCHAR(255),
ADD COLUMN address_line2 VARCHAR(255),
ADD COLUMN city VARCHAR(100),
ADD COLUMN state VARCHAR(50),
ADD COLUMN postal_code VARCHAR(20),
ADD COLUMN country VARCHAR(50) DEFAULT 'USA';

-- Verify changes
DESCRIBE customers;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  1. Adding Columns
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Add new columns with or without constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ALTER TABLE table_name ADD COLUMN column_name data_type
                  constraints;
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Drop columns from table
ALTER TABLE customers DROP COLUMN phone;
ALTER TABLE customers DROP COLUMN date_of_birth;

-- Drop multiple columns (if supported)
ALTER TABLE customers 
DROP COLUMN address_line2,
DROP COLUMN loyalty_points;

-- Drop column with CASCADE to remove dependent objects
ALTER TABLE customers DROP COLUMN created_at CASCADE;

-- Rename columns
ALTER TABLE customers RENAME COLUMN first_name TO fname;
ALTER TABLE customers RENAME COLUMN last_name TO lname;

-- Rename table
ALTER TABLE customers RENAME TO client_list;
ALTER TABLE client_list RENAME TO customers;

-- Verify changes
DESCRIBE customers;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  2. Dropping & Renaming
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Remove columns and rename table elements
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ALTER TABLE table_name DROP COLUMN | RENAME COLUMN | RENAME TO
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Modify column data types and constraints
-- Change column data type
ALTER TABLE customers ALTER COLUMN email TYPE VARCHAR(150);
ALTER TABLE customers ALTER COLUMN credit_limit TYPE DECIMAL(12,2);

-- Set default values
ALTER TABLE customers ALTER COLUMN country SET DEFAULT 'United States';
ALTER TABLE customers ALTER COLUMN created_at SET DEFAULT CURRENT_TIMESTAMP;

-- Drop default values
ALTER TABLE customers ALTER COLUMN loyalty_points DROP DEFAULT;

-- Add NOT NULL constraint
ALTER TABLE customers ALTER COLUMN fname SET NOT NULL;
ALTER TABLE customers ALTER COLUMN lname SET NOT NULL;

-- Drop NOT NULL constraint
ALTER TABLE customers ALTER COLUMN phone DROP NOT NULL;

-- Note: In some databases, you might need to recreate the column
-- to change certain constraints or data types
DESCRIBE customers;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  3. Modifying Columns
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Change data types, defaults, and NULL constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ALTER COLUMN column_name TYPE | SET DEFAULT | DROP DEFAULT |
                  SET NOT NULL
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Add table-level constraints after table creation
-- Add primary key constraint
ALTER TABLE customers ADD CONSTRAINT pk_customers PRIMARY KEY (customer_id);

-- Add foreign key constraints
ALTER TABLE orders ADD CONSTRAINT fk_orders_customer 
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
    ON DELETE CASCADE ON UPDATE CASCADE;

-- Add unique constraints
ALTER TABLE customers ADD CONSTRAINT uk_customers_email UNIQUE (email);
ALTER TABLE products ADD CONSTRAINT uk_products_sku UNIQUE (sku);

-- Add check constraints
ALTER TABLE orders ADD CONSTRAINT chk_orders_total 
    CHECK (total_amount >= 0);
ALTER TABLE products ADD CONSTRAINT chk_products_price 
    CHECK (price > 0 AND price > cost);

-- Drop constraints
ALTER TABLE customers DROP CONSTRAINT uk_customers_email;
ALTER TABLE orders DROP CONSTRAINT chk_orders_total;
ALTER TABLE orders DROP CONSTRAINT fk_orders_customer;

-- Show constraint information
SELECT 
    constraint_name, 
    constraint_type, 
    table_name 
FROM information_schema.table_constraints 
WHERE table_name = 'customers';"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  4. Managing Constraints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Add and drop table constraints after creation
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ADD CONSTRAINT | DROP CONSTRAINT with CASCADE options
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-red-300"
          >
            DROP Operations & Cleanup
          </h2>
          <p class="text-gray-400 mb-4">
            Remove database objects safely with proper CASCADE handling.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Drop tables with different options
-- Drop single table
DROP TABLE IF EXISTS temp_table;

-- Drop table with CASCADE (removes dependent objects)
DROP TABLE IF EXISTS old_customers CASCADE;

-- Drop multiple tables
DROP TABLE IF EXISTS 
    temp_orders, 
    temp_products, 
    temp_categories;

-- Drop table only if no dependencies exist
DROP TABLE old_inventory; -- Will fail if foreign keys reference it

-- Check what objects depend on a table before dropping
SELECT 
    constraint_name,
    table_name as dependent_table,
    referenced_table_name
FROM information_schema.referential_constraints
WHERE referenced_table_name = 'customers';

-- Create and drop temporary table
CREATE TEMPORARY TABLE session_data (
    session_id VARCHAR(50),
    user_id INTEGER,
    created_at TIMESTAMP DEFAULT NOW()
);

DROP TABLE session_data;"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  1. Dropping Tables
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Remove tables with CASCADE and dependency checking
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP TABLE [IF EXISTS] table_name [CASCADE | RESTRICT];
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Drop other database objects
-- Drop schemas
DROP SCHEMA IF EXISTS temp_schema CASCADE;
DROP SCHEMA IF EXISTS old_analytics RESTRICT;

-- Drop views
DROP VIEW IF EXISTS customer_summary;
DROP VIEW IF EXISTS product_catalog CASCADE;

-- Drop indexes
DROP INDEX IF EXISTS idx_customers_email;
DROP INDEX IF EXISTS idx_products_category;

-- Drop sequences (auto-increment)
DROP SEQUENCE IF EXISTS custom_id_seq;

-- Create and drop a view example
CREATE VIEW active_customers AS
SELECT customer_id, fname, lname, email
FROM customers
WHERE created_at >= CURRENT_DATE - INTERVAL 30 DAY;

-- Show view
SELECT * FROM active_customers LIMIT 5;

-- Drop the view
DROP VIEW active_customers;

-- Drop database (disconnect from file)
-- In DuckDB, this is equivalent to closing the connection
DETACH DATABASE main; -- If you had attached it"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  2. Dropping Other Objects
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Remove views, indexes, schemas, and sequences
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP VIEW | INDEX | SEQUENCE | SCHEMA [CASCADE | RESTRICT]
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- DROP DATABASE - Complete database removal operations
-- Note: Database dropping is environment-specific. Examples show various approaches.

-- Method 1: DuckDB/SQLite approach (file-based databases)
-- Drop database by disconnecting and deleting file
DETACH DATABASE main;  -- Disconnect from current database
-- In file system, you would: rm database_file.db

-- Method 2: Multi-database environment cleanup
-- First, list all attached databases
PRAGMA database_list;

-- Detach all non-main databases
DETACH DATABASE sales_db;
DETACH DATABASE analytics_db;
DETACH DATABASE temp_db;

-- Method 3: PostgreSQL/MySQL style (for reference)
-- DROP DATABASE analytics_db;
-- DROP DATABASE IF EXISTS old_analytics_db;
-- DROP DATABASE test_db WITH (FORCE);  -- PostgreSQL force option

-- Method 4: Complete database cleanup with verification
-- Step 1: Check what databases exist
SELECT name, file FROM pragma_database_list();

-- Step 2: List all objects in database before dropping
SELECT 
    type,
    name,
    sql
FROM sqlite_master 
WHERE type IN ('table', 'view', 'index', 'trigger')
ORDER BY type, name;

-- Step 3: Drop all user objects first (safer approach)
-- Drop all views
SELECT 'DROP VIEW IF EXISTS ' || name || ';' as drop_statements
FROM sqlite_master 
WHERE type = 'view';

-- Drop all indexes (except auto-created ones)
SELECT 'DROP INDEX IF EXISTS ' || name || ';' as drop_statements
FROM sqlite_master 
WHERE type = 'index' 
AND name NOT LIKE 'sqlite_%';

-- Drop all triggers
SELECT 'DROP TRIGGER IF EXISTS ' || name || ';' as drop_statements
FROM sqlite_master 
WHERE type = 'trigger';

-- Drop all tables (in dependency order)
SELECT 'DROP TABLE IF EXISTS ' || name || ';' as drop_statements
FROM sqlite_master 
WHERE type = 'table' 
AND name NOT LIKE 'sqlite_%'
ORDER BY name;

-- Method 5: Database backup before dropping
-- Create backup before dropping
CREATE DATABASE backup_analytics AS COPY FROM analytics_db;

-- Verify backup
SELECT COUNT(*) as table_count 
FROM information_schema.tables 
WHERE table_schema = 'backup_analytics';

-- Now safe to drop original
-- DROP DATABASE analytics_db;

-- Method 6: Conditional database dropping with checks
-- Check if database has active connections
-- SELECT count(*) FROM pg_stat_activity WHERE datname = 'analytics_db';  -- PostgreSQL

-- Check database size before dropping
PRAGMA database_size;

-- Check if database is empty
SELECT 
    (SELECT COUNT(*) FROM sqlite_master WHERE type = 'table') as table_count,
    (SELECT COUNT(*) FROM sqlite_master WHERE type = 'view') as view_count,
    (SELECT COUNT(*) FROM sqlite_master WHERE type = 'index') as index_count;

-- Method 7: Scripted database cleanup
-- Generate cleanup script
WITH drop_statements AS (
    SELECT 1 as order_num, 'DROP VIEW IF EXISTS ' || name || ';' as stmt
    FROM sqlite_master WHERE type = 'view'
    UNION ALL
    SELECT 2, 'DROP TABLE IF EXISTS ' || name || ';'
    FROM sqlite_master WHERE type = 'table' AND name NOT LIKE 'sqlite_%'
    UNION ALL
    SELECT 3, 'DROP INDEX IF EXISTS ' || name || ';'
    FROM sqlite_master WHERE type = 'index' AND name NOT LIKE 'sqlite_%'
)
SELECT stmt as cleanup_commands
FROM drop_statements
ORDER BY order_num, stmt;

-- Method 8: Database recreation pattern
-- Drop and recreate database (fresh start)
-- In file systems: 
-- 1. Close connection
-- 2. Delete file
-- 3. Create new file
-- 4. Reconnect

-- Demonstrate with temporary database
ATTACH DATABASE ':memory:' AS temp_fresh_db;
-- Use temp_fresh_db for operations
DETACH DATABASE temp_fresh_db;

-- Method 9: Environment-specific considerations
-- Development environment
-- DROP DATABASE IF EXISTS test_db;
-- CREATE DATABASE test_db;

-- Production environment (with safeguards)
-- BACKUP DATABASE production_db TO 'backup_location';
-- DROP DATABASE production_db WITH CONFIRMATION;

-- Show final state
SELECT 'Database cleanup completed' as status,
       COUNT(*) as remaining_objects
FROM sqlite_master 
WHERE type IN ('table', 'view', 'index', 'trigger')
AND name NOT LIKE 'sqlite_%';"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  3. Complete Database Removal
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Comprehensive database dropping strategies with safety checks
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DROP DATABASE, DETACH, backup strategies, cleanup scripts
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-cyan-300"
          >
            Common Table Expressions (CTEs)
          </h2>
          <p class="text-gray-400 mb-4">
            Advanced query structuring with CTEs, recursive CTEs, and complex
            analytical queries.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic CTE (Common Table Expression)
-- Example: Calculate customer lifetime value with CTE
WITH customer_orders AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        c.registration_date,
        COUNT(o.order_id) AS total_orders,
        COALESCE(SUM(o.total_amount), 0) AS total_spent,
        COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
        MIN(o.order_date) AS first_order_date,
        MAX(o.order_date) AS last_order_date
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name, c.registration_date
)
SELECT 
    customer_id,
    first_name,
    last_name,
    registration_date,
    total_orders,
    total_spent,
    avg_order_value,
    first_order_date,
    last_order_date,
    CASE 
        WHEN total_spent = 0 THEN 'No Purchase'
        WHEN total_spent < 100 THEN 'Low Value'
        WHEN total_spent < 500 THEN 'Medium Value'
        WHEN total_spent < 1000 THEN 'High Value'
        ELSE 'VIP Customer'
    END AS customer_segment,
    CASE 
        WHEN total_orders = 0 THEN 0
        WHEN last_order_date >= DATE('now', '-30 days') THEN 1
        WHEN last_order_date >= DATE('now', '-90 days') THEN 0.7
        WHEN last_order_date >= DATE('now', '-180 days') THEN 0.5
        ELSE 0.2
    END AS activity_score,
    JULIANDAY('now') - JULIANDAY(registration_date) AS days_as_customer
FROM customer_orders
ORDER BY total_spent DESC;

-- Multiple CTEs in single query
WITH monthly_sales AS (
    SELECT 
        strftime('%Y-%m', order_date) AS month,
        COUNT(*) AS order_count,
        SUM(total_amount) AS revenue,
        AVG(total_amount) AS avg_order_value,
        COUNT(DISTINCT customer_id) AS unique_customers
    FROM orders
    WHERE order_date >= DATE('now', '-12 months')
    GROUP BY strftime('%Y-%m', order_date)
),
product_performance AS (
    SELECT 
        p.product_id,
        p.name,
        strftime('%Y-%m', o.order_date) AS month,
        SUM(oi.quantity) AS units_sold,
        SUM(oi.quantity * oi.unit_price) AS revenue
    FROM products p
    INNER JOIN order_items oi ON p.product_id = oi.product_id
    INNER JOIN orders o ON oi.order_id = o.order_id
    WHERE o.order_date >= DATE('now', '-12 months')
    GROUP BY p.product_id, p.name, strftime('%Y-%m', o.order_date)
)
SELECT 
    ms.month,
    ms.order_count,
    ms.revenue AS monthly_revenue,
    ms.avg_order_value,
    ms.unique_customers,
    COUNT(DISTINCT pp.product_id) AS products_sold,
    SUM(pp.units_sold) AS total_units_sold,
    ms.revenue / ms.unique_customers AS revenue_per_customer
FROM monthly_sales ms
LEFT JOIN product_performance pp ON ms.month = pp.month
GROUP BY ms.month, ms.order_count, ms.revenue, ms.avg_order_value, ms.unique_customers
ORDER BY ms.month DESC;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  1. Basic and Multiple CTEs
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Simplify complex queries with named temporary result sets
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WITH cte_name AS (SELECT...) SELECT FROM cte_name
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Recursive CTE Examples
-- Example 1: Generate number series
WITH RECURSIVE number_series(n) AS (
    -- Base case
    SELECT 1
    UNION ALL
    -- Recursive case
    SELECT n + 1 
    FROM number_series 
    WHERE n < 10
)
SELECT n AS number FROM number_series;

-- Example 2: Generate date series for the last 30 days
WITH RECURSIVE date_series(date_value) AS (
    -- Base case - 30 days ago
    SELECT DATE('now', '-30 days') AS date_value
    UNION ALL
    -- Recursive case - add one day
    SELECT DATE(date_value, '+1 day')
    FROM date_series
    WHERE date_value < DATE('now')
)
SELECT 
    date_value,
    strftime('%w', date_value) AS day_of_week,
    CASE strftime('%w', date_value)
        WHEN '0' THEN 'Sunday'
        WHEN '1' THEN 'Monday'
        WHEN '2' THEN 'Tuesday'
        WHEN '3' THEN 'Wednesday'
        WHEN '4' THEN 'Thursday'
        WHEN '5' THEN 'Friday'
        WHEN '6' THEN 'Saturday'
    END AS day_name,
    CASE 
        WHEN strftime('%w', date_value) IN ('0', '6') THEN 'Weekend'
        ELSE 'Weekday'
    END AS day_type
FROM date_series
ORDER BY date_value;

-- Example 3: Hierarchical data traversal (organizational chart)
CREATE TEMPORARY TABLE organization_chart (
    employee_id INTEGER PRIMARY KEY,
    name VARCHAR(100),
    title VARCHAR(100),
    manager_id INTEGER,
    department VARCHAR(50),
    level INTEGER
);

INSERT INTO organization_chart VALUES
(1, 'John CEO', 'Chief Executive Officer', NULL, 'Executive', 1),
(2, 'Sarah VP-Sales', 'Vice President of Sales', 1, 'Sales', 2),
(3, 'Mike VP-Tech', 'Vice President of Technology', 1, 'Technology', 2),
(4, 'Lisa Sales-Mgr', 'Sales Manager', 2, 'Sales', 3),
(5, 'Tom Dev-Mgr', 'Development Manager', 3, 'Technology', 3),
(6, 'Anna Sales-Rep1', 'Sales Representative', 4, 'Sales', 4),
(7, 'Bob Developer1', 'Senior Developer', 5, 'Technology', 4),
(8, 'Carol Sales-Rep2', 'Sales Representative', 4, 'Sales', 4),
(9, 'David Developer2', 'Junior Developer', 5, 'Technology', 4),
(10, 'Eve Intern', 'Development Intern', 7, 'Technology', 5);

-- Recursive CTE to show organizational hierarchy
WITH RECURSIVE org_hierarchy AS (
    -- Base case: Start with CEO (no manager)
    SELECT 
        employee_id,
        name,
        title,
        manager_id,
        department,
        level,
        name AS hierarchy_path,
        0 AS depth_level
    FROM organization_chart
    WHERE manager_id IS NULL
    
    UNION ALL
    
    -- Recursive case: Find direct reports
    SELECT 
        oc.employee_id,
        oc.name,
        oc.title,
        oc.manager_id,
        oc.department,
        oc.level,
        oh.hierarchy_path || ' -> ' || oc.name AS hierarchy_path,
        oh.depth_level + 1 AS depth_level
    FROM organization_chart oc
    INNER JOIN org_hierarchy oh ON oc.manager_id = oh.employee_id
)
SELECT 
    employee_id,
    SUBSTR('                    ', 1, depth_level * 4) || name AS indented_name,
    title,
    department,
    level,
    hierarchy_path,
    depth_level
FROM org_hierarchy
ORDER BY hierarchy_path;

-- Example 4: Calculate running totals with recursive CTE
WITH RECURSIVE daily_running_total AS (
    -- Base case: First order date
    SELECT 
        MIN(order_date) AS date_value,
        COALESCE(SUM(total_amount), 0) AS daily_total,
        COALESCE(SUM(total_amount), 0) AS running_total
    FROM orders
    WHERE order_date = (SELECT MIN(order_date) FROM orders)
    
    UNION ALL
    
    -- Recursive case: Next day
    SELECT 
        DATE(drt.date_value, '+1 day') AS date_value,
        COALESCE(SUM(o.total_amount), 0) AS daily_total,
        drt.running_total + COALESCE(SUM(o.total_amount), 0) AS running_total
    FROM daily_running_total drt
    LEFT JOIN orders o ON DATE(drt.date_value, '+1 day') = o.order_date
    WHERE DATE(drt.date_value, '+1 day') <= (SELECT MAX(order_date) FROM orders)
    GROUP BY DATE(drt.date_value, '+1 day'), drt.running_total
)
SELECT 
    date_value,
    daily_total,
    running_total,
    CASE 
        WHEN LAG(running_total) OVER (ORDER BY date_value) IS NULL THEN 0
        ELSE running_total - LAG(running_total) OVER (ORDER BY date_value)
    END AS daily_change,
    ROUND(
        running_total * 100.0 / MAX(running_total) OVER (), 
        2
    ) AS percentage_of_total
FROM daily_running_total
ORDER BY date_value;"
              >
                <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                  2. Recursive CTEs
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Generate series, traverse hierarchies, and perform iterative
                  calculations
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WITH RECURSIVE cte AS (base_case UNION ALL recursive_case)
                  SELECT FROM cte
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-violet-300"
          >
            Transaction Control Language (TCL)
          </h2>
          <p class="text-gray-400 mb-4">
            Manage database transactions for data consistency and integrity with
            ACID properties.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic transaction control
-- Start a transaction
BEGIN TRANSACTION;
-- Alternative: BEGIN; or START TRANSACTION;

-- Perform multiple operations
INSERT INTO customers (first_name, last_name, email) 
VALUES ('John', 'Smith', 'john.smith@example.com');

INSERT INTO orders (customer_id, order_date, total_amount) 
VALUES (1, CURRENT_DATE, 299.99);

INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES (1, 1, 2, 149.99);

-- Check the changes (still in transaction)
SELECT * FROM customers WHERE email = 'john.smith@example.com';

-- Commit the transaction to make changes permanent
COMMIT;

-- Verify the committed data
SELECT c.first_name, c.last_name, o.total_amount, o.order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE c.email = 'john.smith@example.com';"
              >
                <h3 class="text-lg font-semibold text-violet-400 mb-2">
                  1. Basic Transactions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  BEGIN, COMMIT for successful transaction completion
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  BEGIN TRANSACTION; ... COMMIT;
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Transaction rollback scenarios
-- Start transaction
BEGIN TRANSACTION;

-- Insert test data
INSERT INTO customers (first_name, last_name, email) 
VALUES ('Jane', 'Doe', 'jane.doe@example.com');

-- Check the inserted data (visible within transaction)
SELECT * FROM customers WHERE email = 'jane.doe@example.com';

-- Simulate an error condition or change of mind
-- ROLLBACK to undo all changes in this transaction
ROLLBACK;

-- Verify the data was not saved
SELECT * FROM customers WHERE email = 'jane.doe@example.com';
-- This should return no results

-- Example of conditional rollback with error handling
BEGIN TRANSACTION;

-- Create a temporary table for demonstration
CREATE TEMPORARY TABLE temp_test (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50) UNIQUE
);

-- Insert some data
INSERT INTO temp_test (name) VALUES ('Test1');
INSERT INTO temp_test (name) VALUES ('Test2');

-- Try to insert duplicate (will cause error)
-- INSERT INTO temp_test (name) VALUES ('Test1'); -- This would fail

-- In case of error, rollback the entire transaction
ROLLBACK;

-- Clean up
DROP TABLE IF EXISTS temp_test;"
              >
                <h3 class="text-lg font-semibold text-violet-400 mb-2">
                  2. ROLLBACK & Error Handling
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Undo transactions and handle errors properly
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  ROLLBACK; Error handling patterns
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced transaction patterns
-- Pattern 1: Safe inventory update with verification
BEGIN TRANSACTION;

-- Check current stock before update
SELECT product_id, name, stock_quantity 
FROM products 
WHERE product_id = 1;

-- Update inventory only if sufficient stock
UPDATE products 
SET stock_quantity = stock_quantity - 5,
    updated_at = CURRENT_TIMESTAMP
WHERE product_id = 1 AND stock_quantity >= 5;

-- Verify the update succeeded (check if any rows were affected)
-- In a real application, you'd check the return value
SELECT product_id, name, stock_quantity 
FROM products 
WHERE product_id = 1;

-- If stock was sufficient, commit; otherwise rollback
COMMIT;

-- Pattern 2: Order processing with multiple table updates
BEGIN TRANSACTION;

-- Create new order
INSERT INTO orders (customer_id, order_date, status, total_amount)
VALUES (1, CURRENT_DATE, 'processing', 0);

-- Get the order ID (simulate LAST_INSERT_ROWID())
-- In real application: SET @order_id = LAST_INSERT_ROWID();

-- Add order items
INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES (1, 1, 2, 149.99);

INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES (1, 2, 1, 299.99);

-- Update order total
UPDATE orders 
SET total_amount = (
    SELECT SUM(quantity * unit_price) 
    FROM order_items 
    WHERE order_id = 1
)
WHERE order_id = 1;

-- Update product inventory
UPDATE products 
SET stock_quantity = stock_quantity - 2
WHERE product_id = 1;

UPDATE products 
SET stock_quantity = stock_quantity - 1
WHERE product_id = 2;

-- Commit all changes
COMMIT;

-- Verify the final state
SELECT o.order_id, o.total_amount, o.status,
       oi.product_id, oi.quantity, oi.unit_price
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
WHERE o.order_id = 1;"
              >
                <h3 class="text-lg font-semibold text-violet-400 mb-2">
                  3. Real-World Transaction Patterns
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Inventory updates, order processing, and business logic
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Multi-step business operations with verification
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- SAVEPOINTS - Nested transaction control within transactions
-- Savepoints allow partial rollback within a transaction

BEGIN TRANSACTION;

-- Insert first customer
INSERT INTO customers (first_name, last_name, email) 
VALUES ('Alice', 'Johnson', 'alice.johnson@example.com');

-- Create savepoint after first operation
SAVEPOINT customer_inserted;

-- Insert an order for this customer
INSERT INTO orders (customer_id, order_date, total_amount) 
VALUES (1, CURRENT_DATE, 150.00);

-- Create another savepoint
SAVEPOINT order_inserted;

-- Try to insert order items (this might fail)
INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES (1, 999, 2, 75.00);  -- product_id 999 might not exist

-- If the above fails, rollback to the order savepoint
-- ROLLBACK TO SAVEPOINT order_inserted;

-- Or rollback to the customer savepoint
-- ROLLBACK TO SAVEPOINT customer_inserted;

-- Continue with valid operations
INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES (1, 1, 2, 75.00);

-- Release savepoint when no longer needed (optional)
RELEASE SAVEPOINT order_inserted;

-- Commit the entire transaction
COMMIT;

-- Advanced savepoint example with error handling simulation
BEGIN TRANSACTION;

-- Step 1: Update inventory
UPDATE products SET stock_quantity = stock_quantity - 5 WHERE product_id = 1;
SAVEPOINT inventory_updated;

-- Step 2: Create order
INSERT INTO orders (customer_id, order_date, status, total_amount)
VALUES (1, CURRENT_DATE, 'processing', 250.00);
SAVEPOINT order_created;

-- Step 3: Process payment (simulate failure)
-- If payment processing fails, we can rollback to order_created
-- but keep the inventory update
-- ROLLBACK TO SAVEPOINT order_created;

-- Step 4: If inventory check fails, rollback everything
-- ROLLBACK TO SAVEPOINT inventory_updated;

-- Successful completion
COMMIT;

-- Demonstrate nested savepoints
BEGIN TRANSACTION;

INSERT INTO customers (first_name, last_name, email) 
VALUES ('Bob', 'Smith', 'bob.smith@example.com');

SAVEPOINT level1;
    INSERT INTO orders (customer_id, order_date, total_amount) 
    VALUES (2, CURRENT_DATE, 100.00);
    
    SAVEPOINT level2;
        INSERT INTO order_items (order_id, product_id, quantity, unit_price)
        VALUES (2, 1, 1, 100.00);
        
        SAVEPOINT level3;
            -- This operation might fail
            UPDATE products SET stock_quantity = stock_quantity - 1 WHERE product_id = 1;
        
        -- Can rollback to any level
        -- ROLLBACK TO SAVEPOINT level3;  -- Undo stock update only
        -- ROLLBACK TO SAVEPOINT level2;  -- Undo stock update and order items
        -- ROLLBACK TO SAVEPOINT level1;  -- Undo everything except customer

COMMIT;"
              >
                <h3 class="text-lg font-semibold text-violet-400 mb-2">
                  4. Advanced Transaction Control - Savepoints
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Nested transaction control with partial rollback capabilities
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SAVEPOINT | ROLLBACK TO SAVEPOINT | RELEASE SAVEPOINT
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-pink-300"
          >
            Data Control Language (DCL)
          </h2>
          <p class="text-gray-400 mb-4">
            Complete guide to user permissions, access control, and security
            management.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- GRANT Statement - All Permission Types
-- Note: DCL commands are database-specific. These examples show standard SQL syntax
-- For DuckDB/SQLite, user management is typically handled at the connection level

-- Basic permission granting
-- GRANT SELECT ON customers TO user1;
-- GRANT INSERT, UPDATE ON products TO user2;  
-- GRANT DELETE ON orders TO manager_role;
-- GRANT ALL PRIVILEGES ON order_items TO admin_user;

-- Grant with specific columns
-- GRANT SELECT (first_name, last_name, email) ON customers TO hr_staff;
-- GRANT UPDATE (stock_quantity) ON products TO inventory_manager;

-- Grant to multiple users/roles
-- GRANT SELECT ON customers TO user1, user2, user3;
-- GRANT INSERT, UPDATE ON products TO sales_team, inventory_team;

-- Grant with GRANT OPTION (allows user to grant permissions to others)
-- GRANT SELECT ON customers TO team_lead WITH GRANT OPTION;
-- GRANT INSERT, UPDATE ON orders TO supervisor WITH GRANT OPTION;

-- Database-level permissions
-- GRANT CREATE TABLE TO developer_role;
-- GRANT CREATE VIEW TO analyst_role;  
-- GRANT CREATE INDEX TO dba_role;
-- GRANT CREATE PROCEDURE TO app_developer;

-- For demonstration in DuckDB environment, show permission concepts:
SELECT 'GRANT Concepts Demonstration' AS explanation;

-- Simulate permission checking query
SELECT 
    'customers' AS table_name,
    'SELECT' AS permission,
    'readonly_user' AS granted_to,
    'Allows viewing customer data' AS description
UNION ALL
SELECT 'customers', 'INSERT,UPDATE', 'data_entry_user', 'Allows adding and modifying customers'
UNION ALL  
SELECT 'orders', 'ALL', 'manager_user', 'Full access to orders table'
UNION ALL
SELECT 'ALL_TABLES', 'ALL', 'admin_user', 'Complete database access';

-- Show how permissions might be structured
WITH permission_matrix AS (
    SELECT 'readonly_user' AS role, 'customers' AS table_name, 'SELECT' AS permissions
    UNION ALL SELECT 'readonly_user', 'orders', 'SELECT'
    UNION ALL SELECT 'readonly_user', 'products', 'SELECT'
    UNION ALL SELECT 'data_entry_user', 'customers', 'SELECT,INSERT,UPDATE'
    UNION ALL SELECT 'data_entry_user', 'orders', 'SELECT,INSERT,UPDATE'  
    UNION ALL SELECT 'manager_user', 'customers', 'SELECT,INSERT,UPDATE,DELETE'
    UNION ALL SELECT 'manager_user', 'orders', 'SELECT,INSERT,UPDATE,DELETE'
    UNION ALL SELECT 'admin_user', 'ALL_TABLES', 'ALL'
)
SELECT 
    role,
    table_name,
    permissions,
    CASE 
        WHEN permissions LIKE '%ALL%' THEN 'Full Control'
        WHEN permissions LIKE '%DELETE%' THEN 'Modify & Delete'
        WHEN permissions LIKE '%INSERT%' THEN 'Read & Write'
        WHEN permissions LIKE '%SELECT%' THEN 'Read Only'
        ELSE 'No Access'
    END AS access_level
FROM permission_matrix
ORDER BY role, table_name;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  1. GRANT Permissions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Grant various types of permissions to users and roles
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  GRANT permission ON object TO user/role [WITH GRANT OPTION]
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- REVOKE Statement - Remove Permissions
-- Basic permission revocation
-- REVOKE SELECT ON customers FROM user1;
-- REVOKE INSERT, UPDATE ON products FROM user2;
-- REVOKE DELETE ON orders FROM manager_role;
-- REVOKE ALL PRIVILEGES ON order_items FROM admin_user;

-- Revoke with CASCADE (removes permissions granted by this user to others)
-- REVOKE SELECT ON customers FROM team_lead CASCADE;
-- REVOKE ALL ON orders FROM supervisor CASCADE;

-- Revoke vs RESTRICT (default - fails if user granted permissions to others)
-- REVOKE SELECT ON customers FROM team_lead RESTRICT;

-- For demonstration, show revocation concepts:
SELECT 'REVOKE Concepts Demonstration' AS explanation;

-- Simulate permission audit before revocation
WITH current_permissions AS (
    SELECT 'john_analyst' AS user_name, 'customers' AS table_name, 'SELECT' AS current_permissions
    UNION ALL SELECT 'john_analyst', 'orders', 'SELECT'
    UNION ALL SELECT 'sarah_clerk', 'customers', 'SELECT,INSERT,UPDATE'
    UNION ALL SELECT 'sarah_clerk', 'orders', 'SELECT,INSERT,UPDATE'
    UNION ALL SELECT 'mike_supervisor', 'customers', 'SELECT,INSERT,UPDATE,DELETE'
    UNION ALL SELECT 'mike_supervisor', 'orders', 'SELECT,INSERT,UPDATE,DELETE'
),
revocation_plan AS (
    SELECT 'john_analyst' AS user_name, 'orders' AS table_name, 'SELECT' AS permissions_to_revoke, 'Policy Change' AS reason
    UNION ALL SELECT 'sarah_clerk', 'customers', 'UPDATE', 'Security Restriction'
    UNION ALL SELECT 'mike_supervisor', 'orders', 'DELETE', 'Compliance Requirement'
)
SELECT 
    cp.user_name,
    cp.table_name,
    cp.current_permissions,
    COALESCE(rp.permissions_to_revoke, 'None') AS permissions_to_revoke,
    COALESCE(rp.reason, 'No Changes') AS revocation_reason,
    CASE 
        WHEN rp.permissions_to_revoke IS NOT NULL THEN 
            'REVOKE ' || rp.permissions_to_revoke || ' ON ' || cp.table_name || ' FROM ' || cp.user_name || ';'
        ELSE 'No Action Required'
    END AS revoke_statement
FROM current_permissions cp
LEFT JOIN revocation_plan rp ON cp.user_name = rp.user_name AND cp.table_name = rp.table_name
ORDER BY cp.user_name, cp.table_name;"
              >
                <h3 class="text-lg font-semibold text-pink-400 mb-2">
                  2. REVOKE Permissions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Remove permissions with CASCADE and RESTRICT options
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sh text-gray-300 overflow-x-auto"
                >
                  REVOKE permission ON object FROM user/role [CASCADE|RESTRICT]
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-emerald-300"
          >
            WHERE Clause - Complete Operators Guide
          </h2>
          <p class="text-gray-400 mb-4">
            Master all WHERE clause operators: LIKE, IN, BETWEEN, IS NULL, and
            comparison operators.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- LIKE operator - Pattern matching with wildcards
-- % wildcard matches any sequence of characters
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE first_name LIKE 'J%'  -- Names starting with 'J'
ORDER BY first_name;

-- Names ending with specific letters
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE last_name LIKE '%son'  -- Last names ending with 'son'
ORDER BY last_name;

-- Names containing specific text
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE email LIKE '%gmail%'  -- Email addresses containing 'gmail'
ORDER BY email;

-- _ wildcard matches exactly one character
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE first_name LIKE 'J_hn'  -- 'John', 'Jahn', etc.
ORDER BY first_name;

-- Multiple wildcards
SELECT product_id, name, sku
FROM products
WHERE name LIKE '%phone%'  -- Products with 'phone' anywhere in name
OR name LIKE '%Phone%'     -- Case variations
ORDER BY name;

-- LIKE with ESCAPE character for special characters
SELECT product_id, name, description
FROM products
WHERE description LIKE '%10\\% off%' ESCAPE '\\'  -- Find '10% off' in description
ORDER BY name;

-- NOT LIKE operator
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE email NOT LIKE '%@gmail.com'  -- Non-Gmail addresses
AND email NOT LIKE '%@yahoo.com'    -- Also not Yahoo
ORDER BY email;

-- Complex LIKE patterns
SELECT product_id, name, sku
FROM products
WHERE sku LIKE '[A-Z][A-Z][A-Z]-___'  -- SKU pattern: 3 letters, dash, 3 characters
OR sku LIKE 'PROD%'                   -- Or starting with 'PROD'
ORDER BY sku;

-- Case-insensitive LIKE (database-specific)
SELECT customer_id, first_name, last_name
FROM customers
WHERE UPPER(first_name) LIKE UPPER('john%')  -- Case-insensitive search
ORDER BY first_name;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  1. LIKE Pattern Matching
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Pattern matching with % (any chars) and _ (single char)
                  wildcards
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE column LIKE 'pattern%' | '%pattern%' | 'pattern_'
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- IN and NOT IN operators - Match against list of values
-- IN with explicit values
SELECT customer_id, first_name, last_name, city, country
FROM customers
WHERE country IN ('USA', 'Canada', 'Mexico')
ORDER BY country, city;

-- IN with multiple columns (if supported)
SELECT customer_id, first_name, last_name, city, country
FROM customers
WHERE (city, country) IN (('New York', 'USA'), ('Toronto', 'Canada'), ('London', 'UK'))
ORDER BY country, city;

-- NOT IN operator
SELECT customer_id, first_name, last_name, city, country
FROM customers
WHERE country NOT IN ('USA', 'Canada')
ORDER BY country, city;

-- IN with subquery
SELECT customer_id, first_name, last_name
FROM customers
WHERE customer_id IN (
    SELECT DISTINCT customer_id
    FROM orders
    WHERE total_amount > 200
)
ORDER BY customer_id;

-- NOT IN with subquery
SELECT customer_id, first_name, last_name, registration_date
FROM customers
WHERE customer_id NOT IN (
    SELECT DISTINCT customer_id
    FROM orders
    WHERE customer_id IS NOT NULL  -- Important: exclude NULLs
)
ORDER BY registration_date DESC;

-- IN with calculated values
SELECT product_id, name, price, category_id
FROM products
WHERE category_id IN (
    SELECT category_id
    FROM categories
    WHERE name IN ('Electronics', 'Books', 'Clothing')
)
ORDER BY category_id, price;

-- Complex IN conditions
SELECT order_id, customer_id, order_date, total_amount
FROM orders
WHERE customer_id IN (
    SELECT customer_id
    FROM customers
    WHERE city IN ('New York', 'Los Angeles', 'Chicago')
)
AND EXTRACT(YEAR FROM order_date) IN (2023, 2024)
ORDER BY order_date DESC;

-- IN with CASE statement
SELECT 
    customer_id,
    first_name,
    last_name,
    country,
    CASE 
        WHEN country IN ('USA', 'Canada') THEN 'North America'
        WHEN country IN ('UK', 'France', 'Germany') THEN 'Europe'
        WHEN country IN ('Japan', 'China', 'India') THEN 'Asia'
        ELSE 'Other'
    END AS region
FROM customers
ORDER BY region, country;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  2. IN and NOT IN
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Match values against a list or subquery results
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE column IN (value1, value2) | (SELECT values FROM table)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- BETWEEN operator - Range conditions
-- Numeric BETWEEN
SELECT product_id, name, price
FROM products
WHERE price BETWEEN 50 AND 200
ORDER BY price;

-- NOT BETWEEN
SELECT product_id, name, price
FROM products
WHERE price NOT BETWEEN 10 AND 100
ORDER BY price DESC;

-- Date BETWEEN
SELECT order_id, customer_id, order_date, total_amount
FROM orders
WHERE order_date BETWEEN DATE('2024-01-01') AND DATE('2024-03-31')
ORDER BY order_date;

-- BETWEEN with time
SELECT order_id, customer_id, order_date, total_amount
FROM orders
WHERE order_date BETWEEN DATE('2024-01-01') AND DATETIME('2024-01-31 23:59:59')
ORDER BY order_date;

-- String BETWEEN (alphabetical range)
SELECT customer_id, first_name, last_name
FROM customers
WHERE first_name BETWEEN 'A' AND 'J'
ORDER BY first_name;

-- BETWEEN with calculated values
SELECT 
    customer_id,
    first_name,
    last_name,
    (SELECT COUNT(*) FROM orders WHERE customer_id = c.customer_id) AS order_count
FROM customers c
WHERE (SELECT COUNT(*) FROM orders WHERE customer_id = c.customer_id) BETWEEN 2 AND 5
ORDER BY order_count DESC;

-- Complex BETWEEN conditions
SELECT order_id, customer_id, order_date, total_amount
FROM orders
WHERE total_amount BETWEEN 100 AND 500
AND order_date BETWEEN DATE('now', '-90 days') AND DATE('now')
ORDER BY order_date DESC, total_amount DESC;

-- BETWEEN with inclusive boundaries demonstration
SELECT 
    'Demonstration' AS note,
    'BETWEEN includes both boundary values' AS explanation;

-- Show products exactly at boundaries
SELECT product_id, name, price, 'At lower boundary' AS boundary_type
FROM products
WHERE price = 50
UNION ALL
SELECT product_id, name, price, 'At upper boundary'
FROM products
WHERE price = 200
UNION ALL
SELECT product_id, name, price, 'Within range'
FROM products
WHERE price BETWEEN 50 AND 200 AND price NOT IN (50, 200)
ORDER BY price;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  3. BETWEEN Range Conditions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Define ranges for numeric, date, and string values (inclusive)
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE column BETWEEN value1 AND value2 (inclusive)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- IS NULL and IS NOT NULL - Handle missing data
-- Find customers with missing phone numbers
SELECT customer_id, first_name, last_name, email, phone
FROM customers
WHERE phone IS NULL
ORDER BY last_name;

-- Find customers with phone numbers
SELECT customer_id, first_name, last_name, email, phone
FROM customers
WHERE phone IS NOT NULL
ORDER BY last_name;

-- Multiple NULL checks
SELECT customer_id, first_name, last_name, email, phone, date_of_birth
FROM customers
WHERE phone IS NULL
OR date_of_birth IS NULL
ORDER BY customer_id;

-- Find complete customer records
SELECT customer_id, first_name, last_name, email, phone, date_of_birth
FROM customers
WHERE phone IS NOT NULL
AND date_of_birth IS NOT NULL
AND email IS NOT NULL
ORDER BY customer_id;

-- NULL in calculations (NULLs propagate)
SELECT 
    product_id,
    name,
    price,
    weight_kg,
    price * weight_kg AS price_per_kg,  -- NULL if weight_kg is NULL
    CASE 
        WHEN weight_kg IS NULL THEN 'Weight not specified'
        ELSE 'Weight: ' || CAST(weight_kg AS TEXT) || ' kg'
    END AS weight_info
FROM products
ORDER BY product_id;

-- COALESCE to handle NULLs
SELECT 
    customer_id,
    first_name,
    last_name,
    COALESCE(phone, 'No phone provided') AS phone_display,
    COALESCE(date_of_birth, DATE('1900-01-01')) AS birth_date_display
FROM customers
ORDER BY customer_id;

-- NULL-safe comparisons
SELECT 
    customer_id,
    first_name,
    last_name,
    phone,
    CASE 
        WHEN phone IS NULL THEN 'No Phone'
        WHEN phone = '' THEN 'Empty Phone'
        ELSE 'Has Phone'
    END AS phone_status
FROM customers
ORDER BY customer_id;

-- Complex NULL handling in joins
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.total_amount,
    CASE 
        WHEN o.order_id IS NULL THEN 'No Orders'
        ELSE 'Has Orders'
    END AS order_status
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE c.registration_date IS NOT NULL  -- Ensure we have valid registration dates
ORDER BY c.customer_id, o.order_date;

-- Count NULL vs NOT NULL values
SELECT 
    'Total Customers' AS metric,
    COUNT(*) AS count
FROM customers
UNION ALL
SELECT 
    'Customers with Phone',
    COUNT(*)
FROM customers
WHERE phone IS NOT NULL
UNION ALL
SELECT 
    'Customers without Phone',
    COUNT(*)
FROM customers
WHERE phone IS NULL
UNION ALL
SELECT 
    'Customers with Birth Date',
    COUNT(*)
FROM customers
WHERE date_of_birth IS NOT NULL;"
              >
                <h3 class="text-lg font-semibold text-emerald-400 mb-2">
                  4. IS NULL and IS NOT NULL
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Handle missing data and NULL values properly
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE column IS NULL | IS NOT NULL (never use = NULL)
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-purple-300"
          >
            WHERE vs HAVING - Key Differences
          </h2>
          <p class="text-gray-400 mb-4">
            Understand when to use WHERE (before grouping) vs HAVING (after
            grouping).
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- WHERE clause - Filters rows BEFORE grouping
-- Example: Filter orders before grouping by customer
SELECT 
    customer_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent,
    AVG(total_amount) AS avg_order_value
FROM orders
WHERE order_date >= DATE('2024-01-01')  -- WHERE filters individual orders
AND total_amount > 50                   -- before grouping
GROUP BY customer_id
ORDER BY total_spent DESC;

-- WHERE with individual row conditions
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    COUNT(o.order_id) AS order_count,
    SUM(o.total_amount) AS total_spent
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE c.country = 'USA'           -- WHERE filters customers before grouping
AND o.order_date >= '2024-01-01'  -- and orders before grouping
GROUP BY c.customer_id, c.first_name, c.last_name
ORDER BY total_spent DESC;

-- Multiple WHERE conditions on base tables
SELECT 
    p.category_id,
    c.name AS category_name,
    COUNT(oi.order_item_id) AS items_sold,
    SUM(oi.quantity) AS total_quantity,
    SUM(oi.quantity * oi.unit_price) AS total_revenue
FROM products p
JOIN categories c ON p.category_id = c.category_id
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
WHERE p.is_active = true              -- Filter active products
AND o.order_date >= '2024-01-01'      -- Filter recent orders
AND oi.unit_price > 10                -- Filter higher-value items
GROUP BY p.category_id, c.name
ORDER BY total_revenue DESC;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  1. WHERE Clause Usage
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Filters individual rows BEFORE grouping and aggregation
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE condition (applied before GROUP BY)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- HAVING clause - Filters groups AFTER grouping and aggregation
-- Example: Filter customer groups based on aggregated values
SELECT 
    customer_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent,
    AVG(total_amount) AS avg_order_value
FROM orders
GROUP BY customer_id
HAVING COUNT(*) >= 3              -- HAVING filters groups after aggregation
AND SUM(total_amount) > 500       -- based on aggregate functions
ORDER BY total_spent DESC;

-- HAVING with complex aggregate conditions
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    COUNT(o.order_id) AS order_count,
    SUM(o.total_amount) AS total_spent,
    AVG(o.total_amount) AS avg_order_value,
    MAX(o.order_date) AS last_order_date
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name
HAVING COUNT(o.order_id) > 2           -- More than 2 orders
AND AVG(o.total_amount) > 100          -- Average order > $100
AND MAX(o.order_date) >= DATE('now', '-30 days')  -- Recent activity
ORDER BY total_spent DESC;

-- HAVING with multiple aggregate conditions
SELECT 
    p.category_id,
    c.name AS category_name,
    COUNT(DISTINCT p.product_id) AS product_count,
    COUNT(oi.order_item_id) AS items_sold,
    SUM(oi.quantity * oi.unit_price) AS total_revenue,
    AVG(oi.unit_price) AS avg_item_price
FROM products p
JOIN categories c ON p.category_id = c.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.category_id, c.name
HAVING COUNT(DISTINCT p.product_id) >= 3    -- Categories with 3+ products
AND COALESCE(SUM(oi.quantity * oi.unit_price), 0) > 1000  -- Revenue > $1000
AND AVG(oi.unit_price) > 25                 -- Average price > $25
ORDER BY total_revenue DESC;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  2. HAVING Clause Usage
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Filters groups AFTER grouping based on aggregate functions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  HAVING aggregate_condition (applied after GROUP BY)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- WHERE and HAVING combined - The complete picture
-- Example: Filter rows first, then filter groups
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.country,
    COUNT(o.order_id) AS order_count,
    SUM(o.total_amount) AS total_spent,
    AVG(o.total_amount) AS avg_order_value
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE c.country IN ('USA', 'Canada')      -- WHERE: Filter customers by country first
AND o.order_date >= '2024-01-01'          -- WHERE: Filter orders by date first
AND o.total_amount > 25                   -- WHERE: Filter small orders first
GROUP BY c.customer_id, c.first_name, c.last_name, c.country
HAVING COUNT(o.order_id) >= 2             -- HAVING: Then filter groups with 2+ orders
AND SUM(o.total_amount) > 300             -- HAVING: And total spending > $300
ORDER BY total_spent DESC;

-- Common mistake demonstration
-- WRONG: Cannot use aggregate functions in WHERE
-- SELECT customer_id, COUNT(*) as order_count 
-- FROM orders 
-- WHERE COUNT(*) > 2  -- ERROR: Can't use aggregate in WHERE
-- GROUP BY customer_id;

-- CORRECT: Use HAVING for aggregate conditions
SELECT customer_id, COUNT(*) as order_count 
FROM orders 
GROUP BY customer_id
HAVING COUNT(*) > 2;  -- CORRECT: Use HAVING for aggregates

-- Performance comparison example
-- Method 1: Filter early with WHERE (more efficient)
SELECT 
    category_id,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price
FROM products
WHERE is_active = true           -- Filter early
AND price > 0                    -- Filter early
GROUP BY category_id
HAVING COUNT(*) > 5;             -- Then filter groups

-- Method 2: Less efficient - more rows processed
SELECT 
    category_id,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price
FROM products
GROUP BY category_id
HAVING COUNT(*) > 5              -- Filter groups
AND AVG(CASE WHEN is_active = true AND price > 0 THEN 1 ELSE 0 END) = 1;  -- Less efficient

-- Complex real-world example
SELECT 
    EXTRACT(YEAR FROM o.order_date) AS order_year,
    EXTRACT(MONTH FROM o.order_date) AS order_month,
    COUNT(DISTINCT o.customer_id) AS unique_customers,
    COUNT(o.order_id) AS total_orders,
    SUM(o.total_amount) AS monthly_revenue,
    AVG(o.total_amount) AS avg_order_value
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2023-01-01'        -- WHERE: Filter orders from 2023+
AND c.country = 'USA'                     -- WHERE: Filter US customers only
AND o.total_amount > 0                    -- WHERE: Filter valid orders
GROUP BY EXTRACT(YEAR FROM o.order_date), EXTRACT(MONTH FROM o.order_date)
HAVING COUNT(o.order_id) >= 10            -- HAVING: Months with 10+ orders
AND SUM(o.total_amount) > 5000            -- HAVING: Months with $5000+ revenue
ORDER BY order_year DESC, order_month DESC;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  3. WHERE and HAVING Combined
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Best practices: Filter rows early with WHERE, then filter
                  groups with HAVING
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  WHERE row_condition GROUP BY columns HAVING group_condition
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-blue-300"
          >
            Set Operations - UNION, INTERSECT, EXCEPT
          </h2>
          <p class="text-gray-400 mb-4">
            Combine results from multiple queries using set operations with
            comprehensive examples.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- UNION - Combines results from multiple SELECT statements (removes duplicates)
-- Basic UNION example
SELECT customer_id, first_name, last_name, 'Customer' AS source_type
FROM customers
WHERE country = 'USA'
UNION
SELECT employee_id, first_name, last_name, 'Employee' AS source_type
FROM employees
WHERE department = 'Sales'
ORDER BY last_name, first_name;

-- UNION ALL - Includes all rows including duplicates
SELECT product_id, name, price, 'Current Products' AS status
FROM products
WHERE is_active = true
UNION ALL
SELECT product_id, name, price, 'Discontinued Products' AS status
FROM products
WHERE is_active = false
ORDER BY price DESC;

-- Complex UNION with calculated fields
SELECT 
    'Customer' AS entity_type,
    customer_id AS id,
    first_name || ' ' || last_name AS full_name,
    email AS contact,
    city,
    country,
    registration_date AS created_date,
    (SELECT COUNT(*) FROM orders WHERE customer_id = c.customer_id) AS activity_count
FROM customers c
WHERE registration_date >= DATE('now', '-1 year')
UNION
SELECT 
    'Employee' AS entity_type,
    employee_id AS id,
    first_name || ' ' || last_name AS full_name,
    work_email AS contact,
    office_city AS city,
    office_country AS country,
    hire_date AS created_date,
    (SELECT COUNT(*) FROM orders WHERE created_by = e.employee_id) AS activity_count
FROM employees e
WHERE hire_date >= DATE('now', '-1 year')
ORDER BY created_date DESC, entity_type;

-- UNION with aggregations
SELECT 
    'Daily' AS period_type,
    DATE(order_date) AS period,
    COUNT(*) AS order_count,
    SUM(total_amount) AS revenue
FROM orders
WHERE order_date >= DATE('now', '-7 days')
GROUP BY DATE(order_date)
UNION
SELECT 
    'Weekly' AS period_type,
    DATE(order_date, 'weekday 0', '-6 days') AS period,
    COUNT(*) AS order_count,
    SUM(total_amount) AS revenue
FROM orders
WHERE order_date >= DATE('now', '-4 weeks')
GROUP BY DATE(order_date, 'weekday 0', '-6 days')
UNION
SELECT 
    'Monthly' AS period_type,
    DATE(order_date, 'start of month') AS period,
    COUNT(*) AS order_count,
    SUM(total_amount) AS revenue
FROM orders
WHERE order_date >= DATE('now', '-12 months')
GROUP BY DATE(order_date, 'start of month')
ORDER BY period_type, period DESC;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  1. UNION and UNION ALL
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Combine results from multiple queries - UNION removes
                  duplicates, UNION ALL keeps all
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 UNION [ALL] SELECT columns FROM
                  table2
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- INTERSECT - Returns rows that exist in both result sets
-- Note: Not all databases support INTERSECT (alternative methods shown)

-- Customers who are also employees (if we had overlapping data)
-- INTERSECT syntax (where supported):
-- SELECT first_name, last_name, email FROM customers
-- INTERSECT 
-- SELECT first_name, last_name, email FROM employees;

-- Alternative using EXISTS (works in all databases):
SELECT c.customer_id, c.first_name, c.last_name, c.email
FROM customers c
WHERE EXISTS (
    SELECT 1 
    FROM employees e 
    WHERE e.first_name = c.first_name 
    AND e.last_name = c.last_name
    AND e.personal_email = c.email
);

-- Alternative using INNER JOIN:
SELECT DISTINCT c.customer_id, c.first_name, c.last_name, c.email
FROM customers c
INNER JOIN employees e ON e.first_name = c.first_name 
    AND e.last_name = c.last_name
    AND e.personal_email = c.email;

-- Find products ordered by customers from specific cities
-- Products ordered by customers from both 'New York' AND 'Los Angeles'
SELECT p.product_id, p.name, p.price
FROM products p
WHERE p.product_id IN (
    SELECT DISTINCT oi.product_id
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    JOIN customers c ON o.customer_id = c.customer_id
    WHERE c.city = 'New York'
)
AND p.product_id IN (
    SELECT DISTINCT oi.product_id
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    JOIN customers c ON o.customer_id = c.customer_id
    WHERE c.city = 'Los Angeles'
);

-- Complex INTERSECT-like operation with aggregation
-- Categories that have products in both price ranges: under $50 AND over $100
SELECT c.category_id, c.name
FROM categories c
WHERE c.category_id IN (
    SELECT category_id FROM products WHERE price < 50
)
AND c.category_id IN (
    SELECT category_id FROM products WHERE price > 100
);

-- Customers who ordered in both 2023 AND 2024
SELECT c.customer_id, c.first_name, c.last_name
FROM customers c
WHERE c.customer_id IN (
    SELECT DISTINCT customer_id FROM orders WHERE EXTRACT(YEAR FROM order_date) = 2023
)
AND c.customer_id IN (
    SELECT DISTINCT customer_id FROM orders WHERE EXTRACT(YEAR FROM order_date) = 2024
);

-- Advanced INTERSECT concept with multiple conditions
WITH high_value_customers AS (
    SELECT customer_id FROM orders 
    GROUP BY customer_id 
    HAVING SUM(total_amount) > 1000
),
frequent_customers AS (
    SELECT customer_id FROM orders 
    GROUP BY customer_id 
    HAVING COUNT(*) > 5
)
SELECT c.customer_id, c.first_name, c.last_name, c.email
FROM customers c
WHERE c.customer_id IN (SELECT customer_id FROM high_value_customers)
AND c.customer_id IN (SELECT customer_id FROM frequent_customers);"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  2. INTERSECT Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Find rows that exist in both result sets (with alternative
                  methods for compatibility)
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 INTERSECT SELECT columns FROM
                  table2
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- EXCEPT (MINUS) - Returns rows from first query that don't exist in second
-- Note: SQL Server uses EXCEPT, Oracle uses MINUS

-- Customers who haven't placed orders
-- EXCEPT syntax (where supported):
-- SELECT customer_id, first_name, last_name FROM customers
-- EXCEPT
-- SELECT customer_id, first_name, last_name FROM customers c
-- JOIN orders o ON c.customer_id = o.customer_id;

-- Alternative using NOT EXISTS (works in all databases):
SELECT c.customer_id, c.first_name, c.last_name, c.email, c.registration_date
FROM customers c
WHERE NOT EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id
);

-- Alternative using LEFT JOIN with NULL check:
SELECT c.customer_id, c.first_name, c.last_name, c.email
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE o.customer_id IS NULL;

-- Products that have never been ordered
SELECT p.product_id, p.name, p.price, p.stock_quantity
FROM products p
WHERE NOT EXISTS (
    SELECT 1 
    FROM order_items oi 
    WHERE oi.product_id = p.product_id
);

-- Customers who registered but never completed a purchase
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email,
    c.registration_date,
    JULIANDAY('now') - JULIANDAY(c.registration_date) AS days_since_registration
FROM customers c
WHERE NOT EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id 
    AND o.status IN ('completed', 'shipped', 'delivered')
)
ORDER BY days_since_registration DESC;

-- Products in inventory but not sold in last 90 days
SELECT 
    p.product_id,
    p.name,
    p.price,
    p.stock_quantity,
    p.created_date
FROM products p
WHERE p.stock_quantity > 0
AND NOT EXISTS (
    SELECT 1 
    FROM order_items oi 
    JOIN orders o ON oi.order_id = o.order_id
    WHERE oi.product_id = p.product_id 
    AND o.order_date >= DATE('now', '-90 days')
);

-- Complex EXCEPT operation with aggregation
-- Categories with products but no sales in current year
SELECT 
    c.category_id,
    c.name,
    COUNT(p.product_id) AS total_products,
    AVG(p.price) AS avg_price
FROM categories c
JOIN products p ON c.category_id = p.category_id
WHERE NOT EXISTS (
    SELECT 1
    FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    JOIN products p2 ON oi.product_id = p2.product_id
    WHERE p2.category_id = c.category_id
    AND EXTRACT(YEAR FROM o.order_date) = EXTRACT(YEAR FROM CURRENT_DATE)
)
GROUP BY c.category_id, c.name
ORDER BY total_products DESC;"
              >
                <h3 class="text-lg font-semibold text-blue-400 mb-2">
                  3. EXCEPT (MINUS) Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Find rows in first query that don't exist in second query
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SELECT columns FROM table1 EXCEPT SELECT columns FROM table2
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-orange-300"
          >
            String Functions - Complete Guide
          </h2>
          <p class="text-gray-400 mb-4">
            Comprehensive text processing and string manipulation functions.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic String Functions
-- String length and case conversion
SELECT 
    first_name,
    last_name,
    email,
    LENGTH(first_name) AS first_name_length,
    LENGTH(last_name) AS last_name_length,
    LENGTH(email) AS email_length,
    UPPER(first_name) AS uppercase_first,
    LOWER(last_name) AS lowercase_last,
    UPPER(email) AS uppercase_email,
    LOWER(email) AS lowercase_email
FROM customers
LIMIT 5;

-- String concatenation
SELECT 
    customer_id,
    first_name,
    last_name,
    -- Different concatenation methods
    first_name || ' ' || last_name AS full_name_concat,
    CONCAT(first_name, ' ', last_name) AS full_name_function,
    first_name || ' ' || UPPER(last_name) AS mixed_case_name,
    CONCAT(UPPER(first_name), ', ', UPPER(last_name)) AS formal_name,
    email || ' (' || first_name || ')' AS email_with_name
FROM customers
LIMIT 5;

-- Trimming whitespace
SELECT 
    '  test string  ' AS original,
    TRIM('  test string  ') AS trimmed,
    LTRIM('  test string  ') AS left_trimmed,
    RTRIM('  test string  ') AS right_trimmed,
    LENGTH('  test string  ') AS original_length,
    LENGTH(TRIM('  test string  ')) AS trimmed_length;

-- Real-world trimming example
SELECT 
    customer_id,
    first_name,
    TRIM(first_name) AS trimmed_first_name,
    LENGTH(first_name) AS original_length,
    LENGTH(TRIM(first_name)) AS trimmed_length,
    CASE 
        WHEN LENGTH(first_name) != LENGTH(TRIM(first_name)) THEN 'Has extra spaces'
        ELSE 'Clean'
    END AS space_status
FROM customers
WHERE first_name != TRIM(first_name)  -- Find records with extra spaces
OR first_name IS NULL;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  1. Basic String Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Length, case conversion, concatenation, and trimming
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  LENGTH() | UPPER() | LOWER() | CONCAT() | TRIM() | LTRIM() |
                  RTRIM()
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Substring and Positioning Functions
-- Extract parts of strings
SELECT 
    product_name,
    SUBSTR(product_name, 1, 10) AS first_10_chars,
    SUBSTR(product_name, -5) AS last_5_chars,
    SUBSTR(product_name, 3, 5) AS middle_5_chars,
    LEFT(product_name, 8) AS left_8_chars,
    RIGHT(product_name, 8) AS right_8_chars
FROM (
    SELECT 'Smartphone Pro Max 256GB' AS product_name
    UNION ALL SELECT 'Laptop Gaming Ultra 2024'
    UNION ALL SELECT 'Tablet Air 128GB WiFi'
    UNION ALL SELECT 'Headphones Wireless Noise-Cancelling'
) products;

-- Find position of substrings
SELECT 
    email,
    INSTR(email, '@') AS at_position,
    INSTR(email, '.') AS first_dot_position,
    INSTR(SUBSTR(email, INSTR(email, '@')), '.') AS dot_after_at,
    SUBSTR(email, 1, INSTR(email, '@') - 1) AS username,
    SUBSTR(email, INSTR(email, '@') + 1) AS domain,
    SUBSTR(email, INSTR(email, '@') + 1, 
           INSTR(SUBSTR(email, INSTR(email, '@')), '.') - 1) AS domain_name,
    SUBSTR(email, INSTR(email, '.', INSTR(email, '@'))) AS extension
FROM customers
WHERE email LIKE '%@%.%'  -- Valid email format
LIMIT 5;

-- Advanced substring operations
SELECT 
    sku,
    name,
    -- Extract product category from SKU (assuming format: CAT-PROD-001)
    CASE 
        WHEN INSTR(sku, '-') > 0 THEN SUBSTR(sku, 1, INSTR(sku, '-') - 1)
        ELSE sku
    END AS category_code,
    -- Extract product code
    CASE 
        WHEN INSTR(sku, '-') > 0 AND INSTR(SUBSTR(sku, INSTR(sku, '-') + 1), '-') > 0 THEN
            SUBSTR(sku, INSTR(sku, '-') + 1, 
                   INSTR(SUBSTR(sku, INSTR(sku, '-') + 1), '-') - 1)
        ELSE NULL
    END AS product_code,
    -- Extract sequence number
    CASE 
        WHEN INSTR(sku, '-') > 0 AND INSTR(SUBSTR(sku, INSTR(sku, '-') + 1), '-') > 0 THEN
            SUBSTR(sku, LENGTH(sku) - 2)  -- Last 3 characters
        ELSE NULL
    END AS sequence_number
FROM products
WHERE sku LIKE '%-%'  -- SKUs with separators
LIMIT 5;

-- String replacement and manipulation
SELECT 
    name,
    REPLACE(name, ' ', '_') AS underscore_name,
    REPLACE(name, 'Pro', 'Professional') AS expanded_name,
    REPLACE(UPPER(name), ' ', '') AS compact_uppercase,
    -- Remove common words
    REPLACE(REPLACE(REPLACE(name, ' Pro', ''), ' Max', ''), ' Ultra', '') AS simplified_name
FROM products
WHERE name LIKE '% Pro %' OR name LIKE '% Max %' OR name LIKE '% Ultra %'
LIMIT 5;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  2. Substring and Text Extraction
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Extract parts of strings and find positions of substrings
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  SUBSTR() | LEFT() | RIGHT() | INSTR() | REPLACE()
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced String Functions and Pattern Matching
-- String validation and cleaning
SELECT 
    email,
    phone,
    -- Email validation
    CASE 
        WHEN email LIKE '%@%.%' AND LENGTH(email) > 5 THEN 'Valid Format'
        ELSE 'Invalid Format'
    END AS email_status,
    -- Phone number cleaning and formatting
    REPLACE(REPLACE(REPLACE(REPLACE(phone, '(', ''), ')', ''), '-', ''), ' ', '') AS clean_phone,
    -- Format phone number
    CASE 
        WHEN LENGTH(REPLACE(REPLACE(REPLACE(REPLACE(phone, '(', ''), ')', ''), '-', ''), ' ', '')) = 10 THEN
            SUBSTR(REPLACE(REPLACE(REPLACE(REPLACE(phone, '(', ''), ')', ''), '-', ''), ' ', ''), 1, 3) || '-' ||
            SUBSTR(REPLACE(REPLACE(REPLACE(REPLACE(phone, '(', ''), ')', ''), '-', ''), ' ', ''), 4, 3) || '-' ||
            SUBSTR(REPLACE(REPLACE(REPLACE(REPLACE(phone, '(', ''), ')', ''), '-', ''), ' ', ''), 7, 4)
        ELSE phone
    END AS formatted_phone
FROM customers
WHERE phone IS NOT NULL
LIMIT 5;

-- Text analysis and statistics
SELECT 
    description,
    LENGTH(description) AS char_count,
    LENGTH(description) - LENGTH(REPLACE(description, ' ', '')) + 1 AS word_count,
    LENGTH(description) - LENGTH(REPLACE(UPPER(description), 'A', '')) AS letter_a_count,
    LENGTH(description) - LENGTH(REPLACE(description, '.', '')) AS sentence_count,
    -- Calculate reading time (average 200 words per minute)
    ROUND((LENGTH(description) - LENGTH(REPLACE(description, ' ', '')) + 1) / 200.0, 1) AS reading_time_minutes
FROM products
WHERE description IS NOT NULL
AND LENGTH(description) > 50  -- Only longer descriptions
LIMIT 5;

-- String padding and formatting
SELECT 
    product_id,
    name,
    price,
    -- Pad numbers with zeros
    PRINTF('%05d', product_id) AS padded_id,
    -- Format prices
    '$' || PRINTF('%.2f', price) AS formatted_price,
    -- Create display codes
    UPPER(SUBSTR(name, 1, 3)) || '-' || PRINTF('%04d', product_id) AS display_code,
    -- Truncate long names with ellipsis
    CASE 
        WHEN LENGTH(name) > 20 THEN SUBSTR(name, 1, 17) || '...'
        ELSE name
    END AS short_name
FROM products
LIMIT 5;

-- Advanced text processing
WITH text_analysis AS (
    SELECT 
        name,
        description,
        -- Extract words that appear to be model numbers
        CASE 
            WHEN description LIKE '%[0-9][0-9][0-9]%' THEN 'Has Model Number'
            ELSE 'No Model Number'
        END AS has_model,
        -- Count uppercase letters
        LENGTH(name) - LENGTH(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
            REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
            name, 'A', ''), 'B', ''), 'C', ''), 'D', ''), 'E', ''), 'F', ''), 'G', ''), 'H', ''), 'I', ''), 'J', ''), 'K', ''), 'L', ''),
            'M', ''), 'N', ''), 'O', ''), 'P', ''), 'Q', ''), 'R', ''), 'S', ''), 'T', ''), 'U', ''), 'V', ''), 'W', ''), 'X', ''), 'Y', ''), 'Z', '')) AS uppercase_count
    FROM products
    WHERE description IS NOT NULL
)
SELECT 
    name,
    has_model,
    uppercase_count,
    CASE 
        WHEN uppercase_count > 5 THEN 'Many Capitals'
        WHEN uppercase_count > 2 THEN 'Some Capitals'
        ELSE 'Few Capitals'
    END AS capitalization_level
FROM text_analysis
LIMIT 5;"
              >
                <h3 class="text-lg font-semibold text-orange-400 mb-2">
                  3. Advanced String Processing
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Validation, cleaning, formatting, and text analysis
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  PRINTF() | Pattern matching | Text statistics | Data cleaning
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-amber-300"
          >
            Database Objects and Sequences
          </h2>
          <p class="text-gray-400 mb-4">
            Complete guide to database objects, sequences, and auto-increment
            functionality.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- SEQUENCES - Auto-incrementing numbers (Database-specific implementations)
-- Note: SQLite uses AUTOINCREMENT, other databases use SEQUENCE objects

-- SQLite AUTOINCREMENT (built-in sequence)
CREATE TABLE products_auto_demo (
    product_id INTEGER PRIMARY KEY AUTOINCREMENT,  -- Auto-incrementing sequence
    name TEXT NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert data - ID will auto-increment
INSERT INTO products_auto_demo (name, price) VALUES 
('Product 1', 19.99),
('Product 2', 29.99),
('Product 3', 39.99);

-- View the auto-generated IDs
SELECT * FROM products_auto_demo;

-- SQLite sequence information
SELECT name, seq FROM sqlite_sequence WHERE name = 'products_auto_demo';

-- Other database sequence syntax (for reference):
-- PostgreSQL/Oracle/SQL Server:
-- CREATE SEQUENCE product_id_seq START WITH 1 INCREMENT BY 1;
-- CREATE TABLE products (
--     product_id INTEGER DEFAULT nextval('product_id_seq') PRIMARY KEY,
--     name TEXT NOT NULL
-- );

-- SQL Server IDENTITY (equivalent to AUTOINCREMENT):
-- CREATE TABLE products (
--     product_id INT IDENTITY(1,1) PRIMARY KEY,
--     name NVARCHAR(100) NOT NULL
-- );

-- MySQL AUTO_INCREMENT (equivalent to AUTOINCREMENT):
-- CREATE TABLE products (
--     product_id INT AUTO_INCREMENT PRIMARY KEY,
--     name VARCHAR(100) NOT NULL
-- );

-- Custom sequence simulation in SQLite using triggers
CREATE TABLE custom_sequence_demo (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    custom_seq_num INTEGER
);

-- Create a sequence tracking table
CREATE TABLE sequence_tracker (
    sequence_name TEXT PRIMARY KEY,
    current_value INTEGER DEFAULT 0
);

-- Initialize sequence
INSERT INTO sequence_tracker VALUES ('custom_seq', 1000);

-- Trigger to auto-assign sequence numbers
CREATE TRIGGER tr_custom_sequence_demo_insert
AFTER INSERT ON custom_sequence_demo
FOR EACH ROW
WHEN NEW.custom_seq_num IS NULL
BEGIN
    UPDATE custom_sequence_demo 
    SET custom_seq_num = (
        SELECT current_value 
        FROM sequence_tracker 
        WHERE sequence_name = 'custom_seq'
    )
    WHERE rowid = NEW.rowid;
    
    UPDATE sequence_tracker 
    SET current_value = current_value + 1 
    WHERE sequence_name = 'custom_seq';
END;

-- Test custom sequence
INSERT INTO custom_sequence_demo (name) VALUES 
('Item 1'), 
('Item 2'), 
('Item 3');

SELECT * FROM custom_sequence_demo;
SELECT * FROM sequence_tracker;

-- Manual sequence number assignment
INSERT INTO custom_sequence_demo (name, custom_seq_num) VALUES ('Manual Item', 5000);

-- Sequence management functions (conceptual for other databases)
-- nextval('sequence_name') - Get next value
-- currval('sequence_name') - Get current value  
-- setval('sequence_name', value) - Set sequence to specific value
-- ALTER SEQUENCE sequence_name RESTART WITH value;

-- Generate sequential numbers for existing data
WITH numbered_customers AS (
    SELECT 
        customer_id,
        first_name,
        last_name,
        ROW_NUMBER() OVER (ORDER BY registration_date) AS sequence_number
    FROM customers
)
SELECT 
    customer_id,
    first_name,
    last_name,
    'CUST' || PRINTF('%05d', sequence_number) AS customer_code
FROM numbered_customers;

-- Gaps in sequences and handling
-- Sequences may have gaps due to:
-- 1. Rolled back transactions
-- 2. Failed inserts
-- 3. Deleted records
-- 4. Concurrent access

-- Find gaps in sequence
WITH sequence_gaps AS (
    SELECT 
        product_id,
        LAG(product_id) OVER (ORDER BY product_id) AS prev_id,
        product_id - LAG(product_id) OVER (ORDER BY product_id) - 1 AS gap_size
    FROM products_auto_demo
    ORDER BY product_id
)
SELECT 
    prev_id + 1 AS gap_start,
    product_id - 1 AS gap_end,
    gap_size
FROM sequence_gaps
WHERE gap_size > 0;"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  1. Sequences and Auto-Increment
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Auto-incrementing IDs, custom sequences, and gap analysis
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  INTEGER PRIMARY KEY AUTOINCREMENT | CREATE SEQUENCE | Custom
                  sequence with triggers
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- COMPREHENSIVE SEQUENCE EXPLANATION AND ADVANCED PATTERNS
-- ===========================================================================
-- SEQUENCE FUNDAMENTALS: What sequences are and why they matter
-- ===========================================================================

-- DEFINITION: A sequence is a database object that generates unique, 
-- sequential numeric values. Primarily used for primary keys and unique identifiers.

-- CHARACTERISTICS:
-- 1. Uniqueness: Each value generated is unique
-- 2. Ordering: Values follow a predictable sequence
-- 3. Performance: Optimized for high-concurrency environments
-- 4. Persistence: Sequence state survives database restarts

-- ===========================================================================
-- SEQUENCE TYPES AND IMPLEMENTATIONS
-- ===========================================================================

-- Type 1: Built-in Auto-increment (SQLite/DuckDB)
CREATE TABLE demo_autoincrement (
    id INTEGER PRIMARY KEY AUTOINCREMENT,  -- Automatically managed sequence
    data TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Type 2: Manual sequence management with metadata table
CREATE TABLE sequence_metadata (
    seq_name TEXT PRIMARY KEY,
    current_val INTEGER,
    increment_by INTEGER DEFAULT 1,
    min_value INTEGER DEFAULT 1,
    max_value INTEGER,
    cycle_flag BOOLEAN DEFAULT FALSE,
    cache_size INTEGER DEFAULT 1,
    format_pattern TEXT DEFAULT NULL
);

-- Initialize various sequence types
INSERT INTO sequence_metadata VALUES
('customer_seq', 10000, 1, 10000, 99999, FALSE, 1, 'CUST-{value}'),
('order_seq', 1, 1, 1, 999999999, FALSE, 50, 'ORD-{value:08d}'),
('invoice_seq', 100000, 1, 100000, 999999999, FALSE, 10, 'INV-{value}'),
('batch_seq', 1, 5, 1, 9999, TRUE, 1, 'BATCH-{value:04d}');

-- Type 3: UUID-based sequences (for distributed systems)
CREATE TABLE demo_uuid_sequence (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(4))) || '-' || 
                                  lower(hex(randomblob(2))) || '-' || 
                                  lower(hex(randomblob(2))) || '-' || 
                                  lower(hex(randomblob(2))) || '-' || 
                                  lower(hex(randomblob(6)))),
    data TEXT,
    sequence_num INTEGER
);

-- ===========================================================================
-- ADVANCED SEQUENCE OPERATIONS
-- ===========================================================================

-- Get next sequence value (atomic operation)
CREATE TABLE demo_next_val (
    id INTEGER PRIMARY KEY,
    ref_number TEXT,
    data TEXT
);

-- Trigger for atomic next value generation
CREATE TRIGGER tr_demo_next_val_insert
AFTER INSERT ON demo_next_val
FOR EACH ROW
WHEN NEW.ref_number IS NULL
BEGIN
    UPDATE demo_next_val 
    SET ref_number = (
        SELECT format_pattern 
        FROM sequence_metadata s
        WHERE s.seq_name = 'customer_seq'
    )
    WHERE id = NEW.id;
    
    -- Update sequence (atomic)
    UPDATE sequence_metadata 
    SET current_val = current_val + increment_by
    WHERE seq_name = 'customer_seq';
END;

-- Test atomic sequence generation
INSERT INTO demo_next_val (data) VALUES 
('First record'),
('Second record'),
('Third record');

SELECT * FROM demo_next_val;

-- ===========================================================================
-- SEQUENCE ADMINISTRATION AND MONITORING
-- ===========================================================================

-- Current sequence status report
SELECT 
    seq_name,
    current_val,
    increment_by,
    min_value,
    max_value,
    CASE WHEN cycle_flag THEN 'YES' ELSE 'NO' END AS cycles,
    cache_size,
    format_pattern,
    -- Calculate capacity metrics
    CASE 
        WHEN max_value IS NOT NULL THEN 
            ROUND(((current_val - min_value) * 100.0) / (max_value - min_value), 2)
        ELSE NULL
    END AS percent_used,
    CASE 
        WHEN max_value IS NOT NULL THEN 
            max_value - current_val
        ELSE NULL
    END AS remaining_values
FROM sequence_metadata
ORDER BY seq_name;

-- Sequence performance analysis
WITH sequence_usage AS (
    SELECT 
        'customer_seq' AS seq_name,
        COUNT(*) AS records_created,
        MIN(id) AS first_id,
        MAX(id) AS last_id,
        MAX(id) - MIN(id) + 1 AS id_range,
        COUNT(*) AS actual_records,
        MAX(id) - MIN(id) + 1 - COUNT(*) AS gaps
    FROM demo_autoincrement
)
SELECT 
    seq_name,
    records_created,
    first_id,
    last_id,
    id_range,
    gaps,
    ROUND((gaps * 100.0) / id_range, 2) AS gap_percentage,
    CASE 
        WHEN gap_percentage > 50 THEN 'High fragmentation - consider cleanup'
        WHEN gap_percentage > 20 THEN 'Moderate fragmentation'
        ELSE 'Good density'
    END AS fragmentation_status
FROM sequence_usage;

-- ===========================================================================
-- SEQUENCE MAINTENANCE OPERATIONS
-- ===========================================================================

-- Reset sequence to specific value
UPDATE sequence_metadata 
SET current_val = 50000 
WHERE seq_name = 'customer_seq';

-- Increment sequence by large amount (batch reservation)
UPDATE sequence_metadata 
SET current_val = current_val + 1000 
WHERE seq_name = 'order_seq';

-- Set sequence to maximum used value plus buffer
UPDATE sequence_metadata 
SET current_val = (
    SELECT MAX(id) + 100 
    FROM demo_autoincrement
)
WHERE seq_name = 'customer_seq';

-- Sequence synchronization (after data import)
WITH max_ids AS (
    SELECT MAX(id) as max_customer_id FROM demo_autoincrement
    UNION ALL
    SELECT MAX(id) FROM demo_next_val
)
UPDATE sequence_metadata 
SET current_val = (SELECT MAX(max_customer_id) + 1 FROM max_ids)
WHERE seq_name = 'customer_seq';

-- ===========================================================================
-- CROSS-DATABASE SEQUENCE EQUIVALENTS
-- ===========================================================================

-- PostgreSQL comprehensive sequence syntax:
/*
-- Create sequence with all options
CREATE SEQUENCE order_id_seq 
    AS BIGINT
    START WITH 1000
    INCREMENT BY 1
    MINVALUE 1000
    MAXVALUE 999999999999
    CACHE 50
    NO CYCLE
    OWNED BY orders.order_id;

-- Sequence functions
SELECT nextval('order_id_seq');           -- Get next value
SELECT currval('order_id_seq');           -- Get current session value
SELECT setval('order_id_seq', 5000);      -- Set to specific value
SELECT setval('order_id_seq', 5000, true); -- Set and mark as 'is_called'

-- Sequence information
SELECT * FROM order_id_seq;  -- View sequence object
\\d order_id_seq             -- Describe sequence (psql command)

-- Alter sequence
ALTER SEQUENCE order_id_seq RESTART WITH 10000;
ALTER SEQUENCE order_id_seq INCREMENT BY 2;
ALTER SEQUENCE order_id_seq MAXVALUE 99999999;
*/

-- SQL Server IDENTITY comprehensive syntax:
/*
-- Table with IDENTITY
CREATE TABLE orders (
    order_id BIGINT IDENTITY(1000, 1) PRIMARY KEY,  -- START, INCREMENT
    customer_id INT NOT NULL,
    order_date DATE DEFAULT GETDATE()
);

-- IDENTITY functions
SELECT SCOPE_IDENTITY();     -- Last identity in current scope
SELECT @@IDENTITY;           -- Last identity in session
SELECT IDENT_CURRENT('orders'); -- Current identity for specific table

-- Reseed identity
DBCC CHECKIDENT('orders', RESEED, 5000);

-- Get identity information
SELECT 
    IDENT_SEED('orders') AS seed_value,
    IDENT_INCR('orders') AS increment_value,
    IDENT_CURRENT('orders') AS current_value;
*/

-- MySQL AUTO_INCREMENT comprehensive syntax:
/*
-- Table with AUTO_INCREMENT
CREATE TABLE orders (
    order_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT NOT NULL,
    order_date DATE DEFAULT CURRENT_DATE
) AUTO_INCREMENT = 1000;

-- AUTO_INCREMENT functions
SELECT LAST_INSERT_ID();     -- Last auto-generated value

-- Alter AUTO_INCREMENT
ALTER TABLE orders AUTO_INCREMENT = 5000;

-- Get AUTO_INCREMENT information
SELECT AUTO_INCREMENT 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'database_name' 
AND TABLE_NAME = 'orders';
*/

-- Oracle SEQUENCE comprehensive syntax:
/*
-- Create sequence
CREATE SEQUENCE order_seq 
    START WITH 1000
    INCREMENT BY 1
    MAXVALUE 999999999999
    MINVALUE 1000
    CACHE 100
    NOCYCLE
    ORDER;

-- Sequence usage
SELECT order_seq.NEXTVAL FROM DUAL;  -- Next value
SELECT order_seq.CURRVAL FROM DUAL;  -- Current value

-- Sequence in table
CREATE TABLE orders (
    order_id NUMBER DEFAULT order_seq.NEXTVAL PRIMARY KEY,
    customer_id NUMBER NOT NULL
);

-- Alter sequence
ALTER SEQUENCE order_seq INCREMENT BY 5;
ALTER SEQUENCE order_seq MAXVALUE 99999999999;
*/

-- ===========================================================================
-- TROUBLESHOOTING AND BEST PRACTICES
-- ===========================================================================

-- Common sequence issues and solutions:

-- Issue 1: Sequence exhaustion
SELECT 
    seq_name,
    current_val,
    max_value,
    max_value - current_val AS remaining,
    CASE 
        WHEN max_value - current_val < 1000 THEN 'CRITICAL: Expand range'
        WHEN max_value - current_val < 10000 THEN 'WARNING: Monitor closely'
        ELSE 'OK'
    END AS status
FROM sequence_metadata
WHERE max_value IS NOT NULL;

-- Issue 2: Sequence gaps analysis
WITH gap_analysis AS (
    SELECT 
        id,
        LAG(id) OVER (ORDER BY id) AS prev_id,
        id - LAG(id) OVER (ORDER BY id) AS gap_size
    FROM demo_autoincrement
    ORDER BY id
)
SELECT 
    COUNT(CASE WHEN gap_size > 1 THEN 1 END) AS total_gaps,
    SUM(CASE WHEN gap_size > 1 THEN gap_size - 1 ELSE 0 END) AS total_missing_ids,
    MAX(gap_size) AS largest_gap,
    AVG(CASE WHEN gap_size > 1 THEN gap_size END) AS avg_gap_size
FROM gap_analysis;

-- Best practices summary
SELECT 
    'Best Practice' AS category,
    'Use appropriate data type (INTEGER vs BIGINT)' AS recommendation
UNION ALL SELECT 'Performance', 'Cache sequences for high-volume inserts'
UNION ALL SELECT 'Monitoring', 'Set up alerts for sequence exhaustion'
UNION ALL SELECT 'Backup', 'Include sequence state in backup procedures'
UNION ALL SELECT 'Concurrency', 'Use database-native sequences for thread safety'
UNION ALL SELECT 'Design', 'Consider UUID for distributed systems'
UNION ALL SELECT 'Maintenance', 'Regular gap analysis and cleanup';"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  2. Advanced Sequence Concepts & Administration
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Comprehensive sequence management, monitoring, and
                  cross-database patterns
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Sequence administration | Performance monitoring |
                  Cross-platform syntax | Best practices
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- DATABASE OBJECTS - Complete overview
-- List all database objects in SQLite
SELECT 
    type,
    name,
    tbl_name,
    CASE type
        WHEN 'table' THEN 'Stores data in rows and columns'
        WHEN 'view' THEN 'Virtual table based on query result'
        WHEN 'index' THEN 'Improves query performance'
        WHEN 'trigger' THEN 'Executes code on data changes'
    END AS description
FROM sqlite_master 
WHERE name NOT LIKE 'sqlite_%'
ORDER BY type, name;

-- TRIGGERS - Execute code automatically on data changes
CREATE TABLE audit_customers (
    audit_id INTEGER PRIMARY KEY AUTOINCREMENT,
    operation TEXT NOT NULL,  -- INSERT, UPDATE, DELETE
    customer_id INTEGER,
    old_first_name TEXT,
    new_first_name TEXT,
    old_last_name TEXT,
    new_last_name TEXT,
    old_email TEXT,
    new_email TEXT,
    changed_by TEXT DEFAULT 'system',
    changed_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- INSERT trigger
CREATE TRIGGER tr_customers_insert_audit
AFTER INSERT ON customers
FOR EACH ROW
BEGIN
    INSERT INTO audit_customers (
        operation, customer_id, new_first_name, new_last_name, new_email
    ) VALUES (
        'INSERT', NEW.customer_id, NEW.first_name, NEW.last_name, NEW.email
    );
END;

-- UPDATE trigger
CREATE TRIGGER tr_customers_update_audit
AFTER UPDATE ON customers
FOR EACH ROW
BEGIN
    INSERT INTO audit_customers (
        operation, customer_id, 
        old_first_name, new_first_name,
        old_last_name, new_last_name,
        old_email, new_email
    ) VALUES (
        'UPDATE', NEW.customer_id,
        OLD.first_name, NEW.first_name,
        OLD.last_name, NEW.last_name,
        OLD.email, NEW.email
    );
END;

-- DELETE trigger
CREATE TRIGGER tr_customers_delete_audit
AFTER DELETE ON customers
FOR EACH ROW
BEGIN
    INSERT INTO audit_customers (
        operation, customer_id, old_first_name, old_last_name, old_email
    ) VALUES (
        'DELETE', OLD.customer_id, OLD.first_name, OLD.last_name, OLD.email
    );
END;

-- INSTEAD OF triggers (for views)
CREATE VIEW customer_contact_info AS
SELECT 
    customer_id,
    first_name || ' ' || last_name AS full_name,
    email,
    phone
FROM customers;

-- Make view updatable with INSTEAD OF trigger
CREATE TRIGGER tr_customer_contact_instead_update
INSTEAD OF UPDATE ON customer_contact_info
FOR EACH ROW
BEGIN
    UPDATE customers 
    SET email = NEW.email, phone = NEW.phone
    WHERE customer_id = NEW.customer_id;
END;

-- SCHEMA objects and organization
-- In SQLite, everything is in the main schema, but other databases support:
-- CREATE SCHEMA sales;
-- CREATE SCHEMA inventory;
-- CREATE TABLE sales.orders (...);
-- CREATE TABLE inventory.products (...);

-- USER-DEFINED FUNCTIONS (database-specific)
-- SQLite doesn't support user-defined SQL functions, but other databases do:
-- CREATE FUNCTION calculate_age(birth_date DATE) 
-- RETURNS INTEGER
-- AS
-- BEGIN
--     RETURN DATEDIFF(YEAR, birth_date, GETDATE());
-- END;

-- STORED PROCEDURES (database-specific)
-- SQLite doesn't support stored procedures, but other databases do:
-- CREATE PROCEDURE GetCustomerOrders(IN customer_id INT)
-- BEGIN
--     SELECT * FROM orders WHERE customer_id = customer_id;
-- END;

-- DOMAINS/USER-DEFINED TYPES (database-specific)
-- PostgreSQL example:
-- CREATE DOMAIN email_type AS VARCHAR(255) CHECK (VALUE ~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$');

-- SYNONYMS/ALIASES (database-specific)
-- Oracle/SQL Server example:
-- CREATE SYNONYM customers_alias FOR main_schema.customers;

-- List all triggers
SELECT 
    name,
    tbl_name,
    sql
FROM sqlite_master 
WHERE type = 'trigger'
AND name NOT LIKE 'sqlite_%'
ORDER BY tbl_name, name;

-- Drop database objects
-- DROP TRIGGER IF EXISTS tr_customers_insert_audit;
-- DROP VIEW IF EXISTS customer_contact_info;
-- DROP TABLE IF EXISTS audit_customers;

-- Database metadata queries
-- Get table column information
PRAGMA table_info(customers);

-- Get foreign key information
PRAGMA foreign_key_list(orders);

-- Get index information
PRAGMA index_list(customers);
PRAGMA index_info(idx_customers_email);

-- Database statistics
SELECT 
    'Tables' AS object_type,
    COUNT(*) AS count
FROM sqlite_master 
WHERE type = 'table' AND name NOT LIKE 'sqlite_%'
UNION ALL
SELECT 'Views', COUNT(*) 
FROM sqlite_master 
WHERE type = 'view'
UNION ALL
SELECT 'Indexes', COUNT(*) 
FROM sqlite_master 
WHERE type = 'index' AND name NOT LIKE 'sqlite_%'
UNION ALL
SELECT 'Triggers', COUNT(*) 
FROM sqlite_master 
WHERE type = 'trigger';"
              >
                <h3 class="text-lg font-semibold text-amber-400 mb-2">
                  2. Database Objects Overview
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Tables, views, indexes, triggers, and metadata queries
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE TRIGGER | sqlite_master | PRAGMA commands | Object
                  metadata
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-lime-300"
          >
            HELP and DESCRIBE Commands
          </h2>
          <p class="text-gray-400 mb-4">
            Database introspection and help commands for exploring schema and
            getting assistance.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- SQLite PRAGMA commands for database introspection
-- Get database information
PRAGMA database_list;

-- Get table structure
PRAGMA table_info(customers);
PRAGMA table_info(orders);
PRAGMA table_info(products);

-- Get foreign key information  
PRAGMA foreign_key_list(orders);
PRAGMA foreign_key_list(order_items);

-- Get index information
PRAGMA index_list(customers);
PRAGMA index_info(idx_customers_email);

-- Get compile options
PRAGMA compile_options;

-- Get database integrity check
PRAGMA integrity_check;

-- Quick integrity check
PRAGMA quick_check;

-- Database schema version
PRAGMA schema_version;

-- User version (application-defined)
PRAGMA user_version;

-- Get table and column statistics
PRAGMA table_xinfo(customers);  -- Extended table info

-- Database file information
PRAGMA page_count;
PRAGMA page_size;
PRAGMA freelist_count;

-- WAL mode information
PRAGMA journal_mode;
PRAGMA wal_checkpoint;

-- Other databases DESCRIBE/HELP equivalents:
-- MySQL: DESCRIBE table_name; or SHOW COLUMNS FROM table_name;
-- PostgreSQL: \d table_name; or \dt (list tables)
-- SQL Server: sp_help 'table_name' or sp_columns 'table_name'
-- Oracle: DESCRIBE table_name; or DESC table_name;

-- Custom DESCRIBE function using SQLite system tables
-- Simulate DESCRIBE command
SELECT 
    cid AS column_id,
    name AS column_name,
    type AS data_type,
    CASE notnull WHEN 1 THEN 'NOT NULL' ELSE 'NULL' END AS nullable,
    dflt_value AS default_value,
    CASE pk WHEN 1 THEN 'PRIMARY KEY' ELSE '' END AS key_info
FROM PRAGMA_TABLE_INFO('customers')
ORDER BY cid;

-- Get all tables with their column count
SELECT 
    m.name AS table_name,
    COUNT(p.name) AS column_count,
    m.sql AS create_statement
FROM sqlite_master m
LEFT JOIN PRAGMA_TABLE_INFO(m.name) p ON 1=1
WHERE m.type = 'table' 
AND m.name NOT LIKE 'sqlite_%'
GROUP BY m.name, m.sql
ORDER BY m.name;

-- Show foreign key relationships
SELECT 
    m.name AS table_name,
    f.id AS fk_id,
    f.'from' AS local_column,
    f.'table' AS foreign_table,
    f.'to' AS foreign_column,
    f.on_delete,
    f.on_update
FROM sqlite_master m
JOIN PRAGMA_FOREIGN_KEY_LIST(m.name) f
WHERE m.type = 'table'
ORDER BY m.name, f.id;

-- Show all constraints (approximation in SQLite)
WITH table_constraints AS (
    -- Primary Keys
    SELECT 
        t.name AS table_name,
        'PRIMARY KEY' AS constraint_type,
        p.name AS column_name,
        '' AS constraint_name
    FROM sqlite_master t
    JOIN PRAGMA_TABLE_INFO(t.name) p ON p.pk > 0
    WHERE t.type = 'table'
    
    UNION ALL
    
    -- Foreign Keys
    SELECT 
        t.name AS table_name,
        'FOREIGN KEY' AS constraint_type,
        f.'from' AS column_name,
        'FK to ' || f.'table' || '(' || f.'to' || ')' AS constraint_name
    FROM sqlite_master t
    JOIN PRAGMA_FOREIGN_KEY_LIST(t.name) f
    WHERE t.type = 'table'
    
    UNION ALL
    
    -- Unique constraints (from CREATE statements)
    SELECT 
        name AS table_name,
        'UNIQUE' AS constraint_type,
        'See SQL' AS column_name,
        'Check CREATE statement' AS constraint_name
    FROM sqlite_master 
    WHERE type = 'table' 
    AND sql LIKE '%UNIQUE%'
)
SELECT * FROM table_constraints
ORDER BY table_name, constraint_type;

-- Database size and statistics
SELECT 
    name AS table_name,
    CASE type 
        WHEN 'table' THEN 'Table'
        WHEN 'index' THEN 'Index' 
        WHEN 'view' THEN 'View'
        WHEN 'trigger' THEN 'Trigger'
    END AS object_type,
    CASE 
        WHEN type = 'table' THEN 
            (SELECT COUNT(*) FROM (SELECT sql FROM sqlite_master WHERE name = outer.name))
        ELSE NULL
    END AS estimated_rows
FROM sqlite_master outer
WHERE name NOT LIKE 'sqlite_%'
ORDER BY type, name;

-- Show database objects hierarchy
SELECT 
    CASE type 
        WHEN 'table' THEN ' Table'
        WHEN 'view' THEN ' View'
        WHEN 'index' THEN ' Index'
        WHEN 'trigger' THEN ' Trigger'
    END AS icon,
    name,
    tbl_name AS belongs_to_table,
    CASE 
        WHEN LENGTH(sql) > 100 THEN SUBSTR(sql, 1, 97) || '...'
        ELSE sql
    END AS definition_preview
FROM sqlite_master 
WHERE name NOT LIKE 'sqlite_%'
ORDER BY 
    CASE type 
        WHEN 'table' THEN 1
        WHEN 'view' THEN 2  
        WHEN 'index' THEN 3
        WHEN 'trigger' THEN 4
    END,
    name;"
              >
                <h3 class="text-lg font-semibold text-lime-400 mb-2">
                  1. Database Introspection Commands
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  PRAGMA commands and system table queries for exploring
                  database structure
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  PRAGMA table_info(table) | PRAGMA foreign_key_list(table) |
                  sqlite_master queries
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced Database Analysis and Documentation
-- Generate database documentation automatically
WITH database_summary AS (
    SELECT 
        COUNT(CASE WHEN type = 'table' THEN 1 END) AS table_count,
        COUNT(CASE WHEN type = 'view' THEN 1 END) AS view_count,
        COUNT(CASE WHEN type = 'index' THEN 1 END) AS index_count,
        COUNT(CASE WHEN type = 'trigger' THEN 1 END) AS trigger_count
    FROM sqlite_master 
    WHERE name NOT LIKE 'sqlite_%'
)
SELECT 
    'Database Summary' AS section,
    'Tables: ' || table_count || 
    ', Views: ' || view_count || 
    ', Indexes: ' || index_count || 
    ', Triggers: ' || trigger_count AS information
FROM database_summary;

-- Table relationships analysis
WITH table_relationships AS (
    SELECT 
        m.name AS table_name,
        f.'from' AS local_column,
        f.'table' AS references_table,
        f.'to' AS references_column,
        'MANY-TO-ONE' AS relationship_type
    FROM sqlite_master m
    JOIN PRAGMA_FOREIGN_KEY_LIST(m.name) f
    WHERE m.type = 'table'
)
SELECT 
    table_name || '.' || local_column AS from_field,
    '' AS relationship,
    references_table || '.' || references_column AS to_field,
    relationship_type
FROM table_relationships
ORDER BY table_name;

-- Column analysis across all tables
SELECT 
    t.name AS table_name,
    c.name AS column_name,
    c.type AS data_type,
    CASE c.notnull WHEN 1 THEN 'NOT NULL' ELSE 'NULLABLE' END AS null_constraint,
    CASE c.pk WHEN 1 THEN 'PRIMARY KEY' ELSE '' END AS primary_key,
    c.dflt_value AS default_value,
    -- Check if column appears in multiple tables (common fields)
    (SELECT COUNT(*) 
     FROM sqlite_master m2 
     JOIN PRAGMA_TABLE_INFO(m2.name) c2 ON c2.name = c.name
     WHERE m2.type = 'table' AND m2.name != t.name) AS appears_in_other_tables
FROM sqlite_master t
JOIN PRAGMA_TABLE_INFO(t.name) c
WHERE t.type = 'table' 
AND t.name NOT LIKE 'sqlite_%'
ORDER BY t.name, c.cid;

-- Index analysis and recommendations
SELECT 
    i.name AS index_name,
    i.tbl_name AS table_name,
    ii.name AS indexed_column,
    CASE i.unique WHEN 1 THEN 'UNIQUE' ELSE 'NON-UNIQUE' END AS index_type,
    'Improves performance for WHERE, JOIN, ORDER BY on ' || ii.name AS purpose
FROM sqlite_master i
JOIN PRAGMA_INDEX_INFO(i.name) ii
WHERE i.type = 'index'
AND i.name NOT LIKE 'sqlite_%'
ORDER BY i.tbl_name, i.name;

-- Table size estimation (row counts)
-- Note: This creates dynamic SQL - in practice, you'd run these individually
SELECT 
    'SELECT ''' || name || ''' AS table_name, COUNT(*) AS row_count FROM ' || name AS sql_to_run
FROM sqlite_master 
WHERE type = 'table' 
AND name NOT LIKE 'sqlite_%'
ORDER BY name;

-- Find naming patterns and conventions
SELECT 
    'Column Naming Analysis' AS analysis_type,
    CASE 
        WHEN name LIKE '%_id' THEN 'ID Column Pattern'
        WHEN name LIKE '%_date' THEN 'Date Column Pattern'
        WHEN name LIKE '%_name' THEN 'Name Column Pattern'
        WHEN name LIKE '%_email' THEN 'Email Column Pattern'
        WHEN name LIKE '%_phone' THEN 'Phone Column Pattern'
        WHEN name LIKE '%_address' THEN 'Address Column Pattern'
        WHEN name LIKE '%_amount' THEN 'Amount Column Pattern'
        ELSE 'Other'
    END AS pattern,
    COUNT(*) AS frequency
FROM (
    SELECT c.name
    FROM sqlite_master t
    JOIN PRAGMA_TABLE_INFO(t.name) c
    WHERE t.type = 'table' 
    AND t.name NOT LIKE 'sqlite_%'
)
GROUP BY pattern
ORDER BY frequency DESC;

-- Data type usage analysis
SELECT 
    type AS data_type,
    COUNT(*) AS usage_count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM (
        SELECT c.type
        FROM sqlite_master t
        JOIN PRAGMA_TABLE_INFO(t.name) c
        WHERE t.type = 'table' 
        AND t.name NOT LIKE 'sqlite_%'
    )), 2) AS percentage
FROM (
    SELECT c.type
    FROM sqlite_master t
    JOIN PRAGMA_TABLE_INFO(t.name) c
    WHERE t.type = 'table' 
    AND t.name NOT LIKE 'sqlite_%'
)
GROUP BY type
ORDER BY usage_count DESC;

-- Find potential data quality issues
SELECT 
    'Potential Issues Analysis' AS section,
    issue_type,
    COUNT(*) AS occurrences
FROM (
    SELECT 'Tables without primary key' AS issue_type
    FROM sqlite_master t
    WHERE t.type = 'table' 
    AND t.name NOT LIKE 'sqlite_%'
    AND NOT EXISTS (
        SELECT 1 FROM PRAGMA_TABLE_INFO(t.name) WHERE pk > 0
    )
    
    UNION ALL
    
    SELECT 'Tables without foreign keys' AS issue_type
    FROM sqlite_master t
    WHERE t.type = 'table' 
    AND t.name NOT LIKE 'sqlite_%'
    AND NOT EXISTS (
        SELECT 1 FROM PRAGMA_FOREIGN_KEY_LIST(t.name)
    )
    
    UNION ALL
    
    SELECT 'Columns that might need indexes' AS issue_type
    FROM sqlite_master t
    JOIN PRAGMA_TABLE_INFO(t.name) c ON c.name LIKE '%_id' AND c.pk = 0
    WHERE t.type = 'table' 
    AND t.name NOT LIKE 'sqlite_%'
    AND NOT EXISTS (
        SELECT 1 FROM sqlite_master i 
        WHERE i.type = 'index' 
        AND i.tbl_name = t.name
        AND i.sql LIKE '%' || c.name || '%'
    )
)
GROUP BY issue_type;

-- Generate CREATE statement recreation (backup documentation)
SELECT 
    name AS object_name,
    type AS object_type,
    sql || ';' AS create_statement
FROM sqlite_master 
WHERE sql IS NOT NULL
AND name NOT LIKE 'sqlite_%'
ORDER BY 
    CASE type 
        WHEN 'table' THEN 1
        WHEN 'index' THEN 2
        WHEN 'view' THEN 3
        WHEN 'trigger' THEN 4
    END,
    name;"
              >
                <h3 class="text-lg font-semibold text-lime-400 mb-2">
                  2. Database Analysis and Documentation
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Automated analysis, relationship mapping, and database
                  documentation generation
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Relationship analysis | Column patterns | Data quality checks
                  | Documentation generation
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-green-300"
          >
            Sample Dataset Setup
          </h2>
          <div
            class="bg-green-900/20 border border-green-700 rounded-lg p-4 mb-4"
          >
            <h3 class="text-green-300 font-semibold mb-2">
               E-Commerce Database Schema
            </h3>
            <p class="text-green-200 text-sm">
              We'll create tables for customers, products, categories, and
              orders with proper relationships.
            </p>
          </div>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Create complete e-commerce database schema
DROP TABLE IF EXISTS order_items;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS categories;
DROP TABLE IF EXISTS customers;

-- Categories table
CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT
);

-- Customers table
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20),
    registration_date DATE DEFAULT CURRENT_DATE,
    city VARCHAR(50),
    country VARCHAR(50) DEFAULT 'USA'
);

-- Products table
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL CHECK (price > 0),
    stock_quantity INTEGER DEFAULT 0 CHECK (stock_quantity >= 0),
    category_id INTEGER,
    created_date DATE DEFAULT CURRENT_DATE,
    is_active BOOLEAN DEFAULT true,
    FOREIGN KEY (category_id) REFERENCES categories(category_id)
);

-- Orders table
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL,
    order_date TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'pending',
    total_amount DECIMAL(10,2) DEFAULT 0,
    shipping_address TEXT,
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
);

-- Order items junction table
CREATE TABLE order_items (
    order_item_id SERIAL PRIMARY KEY,
    order_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);

SELECT 'Database schema created successfully!' as result;"
              >
                <h3 class="text-lg font-semibold text-green-400 mb-2">
                  1. Create Database Schema
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Set up the complete table structure with relationships and
                  constraints
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CREATE TABLE categories, customers, products, orders,
                  order_items...
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Insert sample data for our e-commerce database

-- Insert categories
INSERT INTO categories (name, description) VALUES
('Electronics', 'Electronic devices and gadgets'),
('Clothing', 'Apparel and fashion items'),
('Books', 'Physical and digital books'),
('Home & Garden', 'Home improvement and gardening supplies'),
('Sports', 'Sports equipment and fitness gear');

-- Insert customers
INSERT INTO customers (first_name, last_name, email, phone, city, country) VALUES
('John', 'Doe', 'john.doe@email.com', '555-0101', 'New York', 'USA'),
('Jane', 'Smith', 'jane.smith@email.com', '555-0102', 'Los Angeles', 'USA'),
('Bob', 'Johnson', 'bob.johnson@email.com', '555-0103', 'Chicago', 'USA'),
('Alice', 'Williams', 'alice.williams@email.com', '555-0104', 'Houston', 'USA'),
('Charlie', 'Brown', 'charlie.brown@email.com', '555-0105', 'Phoenix', 'USA'),
('Diana', 'Davis', 'diana.davis@email.com', '555-0106', 'Philadelphia', 'USA'),
('Eva', 'Miller', 'eva.miller@email.com', '555-0107', 'San Antonio', 'USA'),
('Frank', 'Wilson', 'frank.wilson@email.com', '555-0108', 'San Diego', 'USA');

-- Insert products
INSERT INTO products (name, description, price, stock_quantity, category_id) VALUES
('Smartphone Pro', 'Latest smartphone with advanced features', 899.99, 50, 1),
('Laptop Ultra', 'High-performance laptop for professionals', 1299.99, 25, 1),
('Wireless Headphones', 'Premium noise-canceling headphones', 199.99, 100, 1),
('Smart Watch', 'Fitness tracking smartwatch', 299.99, 75, 1),
('Denim Jeans', 'Classic blue denim jeans', 79.99, 200, 2),
('Cotton T-Shirt', 'Comfortable cotton t-shirt', 24.99, 300, 2),
('Winter Jacket', 'Warm winter jacket', 149.99, 80, 2),
('SQL Mastery Book', 'Complete guide to SQL databases', 49.99, 150, 3),
('Programming Fundamentals', 'Learn programming basics', 39.99, 120, 3),
('Garden Tools Set', 'Complete gardening tool kit', 89.99, 60, 4),
('Indoor Plant Pot', 'Decorative pot for indoor plants', 19.99, 180, 4),
('Tennis Racket', 'Professional tennis racket', 129.99, 40, 5),
('Running Shoes', 'Comfortable running shoes', 99.99, 150, 5);

-- Insert orders
INSERT INTO orders (customer_id, order_date, status, shipping_address) VALUES
(1, '2024-01-15 10:30:00', 'completed', '123 Main St, New York, NY'),
(2, '2024-01-16 14:20:00', 'completed', '456 Oak Ave, Los Angeles, CA'),
(3, '2024-01-17 09:15:00', 'shipped', '789 Pine St, Chicago, IL'),
(4, '2024-01-18 16:45:00', 'pending', '321 Elm St, Houston, TX'),
(1, '2024-01-19 11:20:00', 'completed', '123 Main St, New York, NY'),
(5, '2024-01-20 13:30:00', 'shipped', '654 Maple Dr, Phoenix, AZ');

-- Insert order items
INSERT INTO order_items (order_id, product_id, quantity, unit_price) VALUES
(1, 1, 1, 899.99),
(1, 3, 1, 199.99),
(2, 2, 1, 1299.99),
(2, 5, 2, 79.99),
(3, 4, 1, 299.99),
(3, 6, 3, 24.99),
(4, 8, 2, 49.99),
(4, 9, 1, 39.99),
(5, 7, 1, 149.99),
(5, 11, 2, 19.99),
(6, 12, 1, 129.99),
(6, 13, 1, 99.99);

-- Update order totals
UPDATE orders SET total_amount = (
    SELECT SUM(quantity * unit_price)
    FROM order_items
    WHERE order_items.order_id = orders.order_id
);

SELECT 'Sample data inserted successfully!' as result;"
              >
                <h3 class="text-lg font-semibold text-green-400 mb-2">
                  2. Insert Sample Data
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Populate tables with realistic e-commerce data for testing
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  INSERT INTO categories, customers, products, orders...
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-red-300"
          >
            Data Modification & Transactions
          </h2>
          <p class="text-gray-400 mb-4">
            Insert, update, and delete data while maintaining database integrity
            with transactions.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic INSERT operations
INSERT INTO customers (first_name, last_name, email, city, country)
VALUES ('Sarah', 'Connor', 'sarah.connor@email.com', 'Los Angeles', 'USA');

-- Insert multiple rows
INSERT INTO products (name, description, price, stock_quantity, category_id) VALUES
('Gaming Mouse', 'High-precision gaming mouse', 79.99, 50, 1),
('Mechanical Keyboard', 'RGB mechanical keyboard', 149.99, 30, 1),
('USB-C Cable', 'High-speed USB-C cable', 19.99, 200, 1);

-- Insert from SELECT (data migration)
CREATE TABLE high_value_customers AS
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE customer_id IN (
    SELECT customer_id FROM orders GROUP BY customer_id HAVING SUM(total_amount) > 500
);"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  1. INSERT Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Add new data to tables with various INSERT techniques
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  INSERT INTO customers (first_name, last_name...)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic UPDATE operations
UPDATE products 
SET price = price * 1.10 
WHERE category_id = 1;  -- 10% price increase for Electronics

-- Conditional UPDATE with CASE
UPDATE products
SET stock_quantity = CASE
    WHEN stock_quantity < 20 THEN stock_quantity + 50
    WHEN stock_quantity < 50 THEN stock_quantity + 25
    ELSE stock_quantity + 10
END;

-- UPDATE with JOIN (update based on related data)
UPDATE products
SET price = price * 0.95  -- 5% discount
WHERE product_id IN (
    SELECT DISTINCT oi.product_id
    FROM order_items oi
    INNER JOIN orders o ON oi.order_id = o.order_id
    WHERE o.order_date >= '2024-01-18'
);"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  2. UPDATE Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Modify existing data with conditional logic and joins
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  UPDATE products SET price = price * 1.10 WHERE...
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic DELETE operations
DELETE FROM order_items 
WHERE order_id IN (SELECT order_id FROM orders WHERE status = 'cancelled');

-- Cascade delete (delete related records)
DELETE FROM orders WHERE customer_id = 999;  -- This would fail due to foreign keys

-- Safe delete with verification
SELECT COUNT(*) as orders_to_delete
FROM orders 
WHERE customer_id IN (
    SELECT customer_id FROM customers WHERE email LIKE '%@tempmail.%'
);

-- DELETE using EXISTS
DELETE FROM products p
WHERE NOT EXISTS (
    SELECT 1 FROM order_items oi WHERE oi.product_id = p.product_id
) AND p.stock_quantity = 0;"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  3. DELETE Operations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Remove data safely with proper checks and relationships
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  DELETE FROM orders WHERE status = 'cancelled'
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Transaction example
BEGIN TRANSACTION;

-- Create a new order
INSERT INTO orders (customer_id, order_date, status, shipping_address)
VALUES (1, NOW(), 'pending', '123 Main St, New York, NY');

-- Get the new order ID (in a real application, you'd use RETURNING or similar)
-- For demo, we'll use a specific order_id
INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES 
    (7, 1, 1, 899.99),
    (7, 3, 1, 199.99);

-- Update product stock
UPDATE products SET stock_quantity = stock_quantity - 1 WHERE product_id = 1;
UPDATE products SET stock_quantity = stock_quantity - 1 WHERE product_id = 3;

-- Update order total
UPDATE orders 
SET total_amount = (SELECT SUM(quantity * unit_price) FROM order_items WHERE order_id = 7)
WHERE order_id = 7;

-- If everything looks good, commit the transaction
COMMIT;

-- To rollback instead: ROLLBACK;"
              >
                <h3 class="text-lg font-semibold text-red-400 mb-2">
                  4. Transactions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Ensure data consistency with BEGIN, COMMIT, and ROLLBACK
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  BEGIN TRANSACTION; ... COMMIT; / ROLLBACK;
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-green-300"
          >
            Conditional Logic & Case Statements
          </h2>
          <p class="text-gray-400 mb-4">
            Add business logic to your queries with conditional statements and
            data transformations.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Basic CASE statement
SELECT 
    name,
    price,
    CASE 
        WHEN price < 50 THEN 'Budget'
        WHEN price < 200 THEN 'Mid-Range'
        WHEN price < 500 THEN 'Premium'
        ELSE 'Luxury'
    END as price_category,
    CASE 
        WHEN stock_quantity = 0 THEN 'Out of Stock'
        WHEN stock_quantity < 10 THEN 'Low Stock'
        WHEN stock_quantity < 50 THEN 'Moderate Stock'
        ELSE 'Well Stocked'
    END as stock_status
FROM products
ORDER BY price;"
              >
                <h3 class="text-lg font-semibold text-green-400 mb-2">
                  1. Basic CASE Statements
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Create categorical data and status indicators
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CASE WHEN price < 50 THEN 'Budget' ELSE 'Premium' END
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- CASE in aggregations
SELECT 
    category_id,
    COUNT(*) as total_products,
    COUNT(CASE WHEN price > 100 THEN 1 END) as expensive_products,
    COUNT(CASE WHEN stock_quantity > 50 THEN 1 END) as well_stocked_products,
    SUM(CASE WHEN price > 100 THEN price ELSE 0 END) as expensive_products_value,
    AVG(CASE WHEN price > 100 THEN price END) as avg_expensive_price
FROM products
GROUP BY category_id;

-- Pivot-like analysis with CASE
SELECT 
    status,
    COUNT(*) as total_orders,
    SUM(CASE WHEN total_amount > 500 THEN 1 ELSE 0 END) as high_value_orders,
    SUM(CASE WHEN total_amount BETWEEN 100 AND 500 THEN 1 ELSE 0 END) as medium_value_orders,
    SUM(CASE WHEN total_amount < 100 THEN 1 ELSE 0 END) as low_value_orders
FROM orders
GROUP BY status;"
              >
                <h3 class="text-lg font-semibold text-green-400 mb-2">
                  2. CASE in Aggregations
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Use CASE statements within aggregate functions for conditional
                  counting
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  COUNT(CASE WHEN price > 100 THEN 1 END)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- NULL handling functions
SELECT 
    name,
    description,
    COALESCE(description, 'No description available') as description_with_default,
    NULLIF(stock_quantity, 0) as stock_or_null,
    IFNULL(description, 'Product description missing') as description_alt
FROM products;

-- Complex conditional logic
SELECT 
    customer_id,
    first_name,
    last_name,
    CASE 
        WHEN email LIKE '%@gmail.%' THEN 'Gmail'
        WHEN email LIKE '%@yahoo.%' THEN 'Yahoo'
        WHEN email LIKE '%@hotmail.%' OR email LIKE '%@outlook.%' THEN 'Microsoft'
        ELSE 'Other'
    END as email_provider,
    CASE 
        WHEN city IN ('New York', 'Los Angeles', 'Chicago') THEN 'Major City'
        WHEN city IS NULL THEN 'Unknown Location'
        ELSE 'Other City'
    END as city_category
FROM customers;"
              >
                <h3 class="text-lg font-semibold text-green-400 mb-2">
                  3. NULL Handling
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Handle NULL values and complex conditional logic
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  COALESCE(description, 'Default'), NULLIF(value, 0)
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced conditional logic
SELECT 
    o.order_id,
    o.customer_id,
    o.total_amount,
    CASE 
        WHEN o.total_amount > 1000 THEN 'VIP Order'
        WHEN o.total_amount > 500 AND EXISTS (
            SELECT 1 FROM orders o2 
            WHERE o2.customer_id = o.customer_id 
            AND o2.order_id != o.order_id
        ) THEN 'Repeat Customer High Value'
        WHEN EXISTS (
            SELECT 1 FROM orders o2 
            WHERE o2.customer_id = o.customer_id 
            AND o2.order_id != o.order_id
        ) THEN 'Repeat Customer'
        ELSE 'New Customer'
    END as order_classification,
    CASE 
        WHEN DATE_DIFF('day', o.order_date, CURRENT_DATE) <= 1 THEN 'Same Day'
        WHEN DATE_DIFF('day', o.order_date, CURRENT_DATE) <= 7 THEN 'This Week'
        WHEN DATE_DIFF('day', o.order_date, CURRENT_DATE) <= 30 THEN 'This Month'
        ELSE 'Older'
    END as recency
FROM orders o
ORDER BY o.order_date DESC;"
              >
                <h3 class="text-lg font-semibold text-green-400 mb-2">
                  4. Advanced Conditional Logic
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Combine CASE with subqueries and complex business rules
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  CASE with EXISTS subqueries and date calculations
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-purple-300"
          >
            Business Intelligence Queries
          </h2>
          <p class="text-gray-400 mb-4">
            Put it all together with real-world business intelligence queries
            for actionable insights.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Customer analysis dashboard
WITH customer_metrics AS (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        c.email,
        c.registration_date,
        COUNT(o.order_id) as total_orders,
        COALESCE(SUM(o.total_amount), 0) as total_spent,
        COALESCE(AVG(o.total_amount), 0) as avg_order_value,
        MAX(o.order_date) as last_order_date,
        DATE_DIFF('day', MAX(o.order_date), CURRENT_DATE) as days_since_last_order
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.registration_date
)
SELECT 
    *,
    CASE 
        WHEN total_orders = 0 THEN 'Never Purchased'
        WHEN days_since_last_order <= 30 THEN 'Active'
        WHEN days_since_last_order <= 90 THEN 'At Risk'
        ELSE 'Churned'
    END as customer_status,
    CASE 
        WHEN total_spent > 1000 THEN 'High Value'
        WHEN total_spent > 300 THEN 'Medium Value'
        WHEN total_spent > 0 THEN 'Low Value'
        ELSE 'No Value'
    END as value_segment
FROM customer_metrics
ORDER BY total_spent DESC;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  1. Customer Analysis
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Comprehensive customer segmentation and lifecycle analysis
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Customer metrics with status and value segmentation
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Product performance analysis
WITH product_performance AS (
    SELECT 
        p.product_id,
        p.name,
        c.name as category,
        p.price,
        p.stock_quantity,
        COUNT(oi.order_item_id) as times_ordered,
        COALESCE(SUM(oi.quantity), 0) as total_quantity_sold,
        COALESCE(SUM(oi.quantity * oi.unit_price), 0) as total_revenue
    FROM products p
    INNER JOIN categories c ON p.category_id = c.category_id
    LEFT JOIN order_items oi ON p.product_id = oi.product_id
    GROUP BY p.product_id, p.name, c.name, p.price, p.stock_quantity
)
SELECT 
    *,
    CASE 
        WHEN times_ordered = 0 THEN 'Never Sold'
        WHEN times_ordered >= 5 THEN 'Best Seller'
        WHEN times_ordered >= 2 THEN 'Popular'
        ELSE 'Slow Mover'
    END as performance_category,
    RANK() OVER (PARTITION BY category ORDER BY total_revenue DESC) as revenue_rank_in_category,
    total_revenue / NULLIF(times_ordered, 0) as avg_revenue_per_order
FROM product_performance
ORDER BY total_revenue DESC;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  2. Product Performance
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Analyze product sales performance and profitability
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Product revenue ranking and performance categorization
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Sales trend analysis
WITH monthly_sales AS (
    SELECT 
        DATE_TRUNC('month', order_date) as month,
        COUNT(*) as orders,
        SUM(total_amount) as revenue,
        AVG(total_amount) as avg_order_value,
        COUNT(DISTINCT customer_id) as unique_customers
    FROM orders
    GROUP BY DATE_TRUNC('month', order_date)
),
sales_with_growth AS (
    SELECT 
        *,
        LAG(revenue, 1) OVER (ORDER BY month) as prev_month_revenue,
        LAG(orders, 1) OVER (ORDER BY month) as prev_month_orders
    FROM monthly_sales
)
SELECT 
    month,
    orders,
    revenue,
    avg_order_value,
    unique_customers,
    revenue / NULLIF(unique_customers, 0) as revenue_per_customer,
    CASE 
        WHEN prev_month_revenue IS NULL THEN NULL
        ELSE ROUND(((revenue - prev_month_revenue) / prev_month_revenue * 100), 2)
    END as revenue_growth_pct,
    CASE 
        WHEN prev_month_orders IS NULL THEN NULL
        ELSE ROUND(((orders - prev_month_orders) / prev_month_orders * 100), 2)
    END as order_growth_pct
FROM sales_with_growth
ORDER BY month;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  3. Sales Trends
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Month-over-month growth analysis and trend identification
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Growth rates and trend analysis with LAG functions
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced business metrics
WITH cohort_analysis AS (
    SELECT 
        DATE_TRUNC('month', c.registration_date) as registration_month,
        DATE_TRUNC('month', o.order_date) as order_month,
        COUNT(DISTINCT c.customer_id) as customers
    FROM customers c
    INNER JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY DATE_TRUNC('month', c.registration_date), DATE_TRUNC('month', o.order_date)
),
inventory_turnover AS (
    SELECT 
        p.product_id,
        p.name,
        p.stock_quantity,
        COALESCE(SUM(oi.quantity), 0) as total_sold,
        CASE 
            WHEN p.stock_quantity > 0 THEN COALESCE(SUM(oi.quantity), 0) / p.stock_quantity
            ELSE NULL
        END as turnover_ratio
    FROM products p
    LEFT JOIN order_items oi ON p.product_id = oi.product_id
    GROUP BY p.product_id, p.name, p.stock_quantity
)
SELECT 
    'Inventory Analysis' as metric_type,
    'Average Turnover Ratio' as metric_name,
    ROUND(AVG(turnover_ratio), 2) as metric_value
FROM inventory_turnover
WHERE turnover_ratio IS NOT NULL

UNION ALL

SELECT 
    'Customer Metrics' as metric_type,
    'Customer Lifetime Value (Avg)' as metric_name,
    ROUND(AVG(total_spent), 2) as metric_value
FROM (
    SELECT customer_id, SUM(total_amount) as total_spent
    FROM orders GROUP BY customer_id
) customer_totals

UNION ALL

SELECT 
    'Sales Metrics' as metric_type,
    'Total Revenue' as metric_name,
    SUM(total_amount) as metric_value
FROM orders;"
              >
                <h3 class="text-lg font-semibold text-purple-400 mb-2">
                  4. Advanced Business Metrics
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Cohort analysis, inventory turnover, and key performance
                  indicators
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Complex business calculations and KPI dashboard
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-gray-300"
          >
            DuckDB Advanced Features
          </h2>
          <p class="text-gray-400 mb-4">
            Explore DuckDB's unique capabilities including file handling, JSON
            processing, and analytical extensions.
          </p>

          <div class="space-y-6">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Array and list operations (DuckDB specific)
SELECT 
    customer_id,
    first_name,
    last_name,
    -- Create arrays of order amounts for each customer
    list(total_amount ORDER BY order_date) as order_amounts,
    array_length(list(total_amount ORDER BY order_date)) as order_count,
    list_sum(list(total_amount ORDER BY order_date)) as total_spent
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name
HAVING array_length(list(total_amount ORDER BY order_date)) > 0;

-- String operations and pattern matching
SELECT 
    name,
    length(name) as name_length,
    upper(name) as uppercase_name,
    lower(name) as lowercase_name,
    split(name, ' ') as name_parts,
    regexp_extract(name, '[A-Z][a-z]+') as first_word
FROM products
WHERE name ~ '[0-9]'  -- Products with numbers in name
ORDER BY name_length DESC;"
              >
                <h3 class="text-lg font-semibold text-gray-400 mb-2">
                  1. Array & String Functions
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Use DuckDB's advanced array aggregation and string processing
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  list(column ORDER BY...), regexp_extract, string arrays
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Statistical functions
SELECT 
    category_id,
    COUNT(*) as product_count,
    AVG(price) as mean_price,
    median(price) as median_price,
    mode(price) as mode_price,
    stddev(price) as price_stddev,
    percentile_cont(0.25) WITHIN GROUP (ORDER BY price) as q1_price,
    percentile_cont(0.75) WITHIN GROUP (ORDER BY price) as q3_price,
    mad(price) as median_absolute_deviation
FROM products
GROUP BY category_id
ORDER BY category_id;

-- Correlation analysis
SELECT 
    corr(p.price, oi.quantity) as price_quantity_correlation,
    corr(p.stock_quantity, oi.quantity) as stock_sales_correlation
FROM products p
INNER JOIN order_items oi ON p.product_id = oi.product_id;"
              >
                <h3 class="text-lg font-semibold text-gray-400 mb-2">
                  2. Statistical Analysis
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Advanced statistical functions for data analysis
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  median(), mode(), stddev(), percentile_cont(), corr()
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Advanced analytical queries
SELECT 
    customer_id,
    order_date,
    total_amount,
    -- Cumulative sum
    SUM(total_amount) OVER (
        PARTITION BY customer_id 
        ORDER BY order_date 
        ROWS UNBOUNDED PRECEDING
    ) as cumulative_spending,
    -- Moving average (3 orders)
    AVG(total_amount) OVER (
        PARTITION BY customer_id 
        ORDER BY order_date 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) as moving_avg_3_orders,
    -- Percent of total customer spending
    total_amount / SUM(total_amount) OVER (PARTITION BY customer_id) * 100 as pct_of_customer_total
FROM orders
WHERE customer_id IN (1, 2, 3)  -- Focus on specific customers
ORDER BY customer_id, order_date;

-- Time series analysis
SELECT 
    DATE_TRUNC('day', order_date) as order_day,
    SUM(total_amount) as daily_revenue,
    LAG(SUM(total_amount), 1) OVER (ORDER BY DATE_TRUNC('day', order_date)) as prev_day_revenue,
    SUM(total_amount) - LAG(SUM(total_amount), 1) OVER (ORDER BY DATE_TRUNC('day', order_date)) as day_over_day_change
FROM orders
GROUP BY DATE_TRUNC('day', order_date)
ORDER BY order_day;"
              >
                <h3 class="text-lg font-semibold text-gray-400 mb-2">
                  3. Advanced Analytics
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Time series analysis and advanced window functions
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  Cumulative sums, moving averages, time series analysis
                </div>
              </button>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <button
                class="copy-example w-full text-left p-4 hover:bg-gray-700 transition-colors"
                data-example="-- Database information and performance
SHOW TABLES;

-- Table and database statistics
SELECT 
    table_name,
    estimated_size,
    column_count
FROM information_schema.tables
WHERE table_schema = 'main';

-- Query performance tips
EXPLAIN SELECT 
    p.name,
    c.name as category,
    COUNT(oi.order_item_id) as times_sold
FROM products p
INNER JOIN categories c ON p.category_id = c.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name, c.name
ORDER BY times_sold DESC;

-- Memory usage and optimization
PRAGMA database_size;
PRAGMA table_info('products');"
              >
                <h3 class="text-lg font-semibold text-gray-400 mb-2">
                  4. Performance & Optimization
                </h3>
                <p class="text-gray-400 text-sm mb-3">
                  Query planning, performance analysis, and database
                  introspection
                </p>
                <div
                  class="bg-gray-900 p-3 rounded font-mono text-sm text-gray-300 overflow-x-auto"
                >
                  EXPLAIN queries, PRAGMA commands, information_schema
                </div>
              </button>
            </div>
          </div>
        
</section>
<section class="mb-8">
          <h2
            class="text-2xl font-semibold border-b border-gray-600 pb-2 mb-4 text-blue-300"
          >
            SQL Fundamentals Reference
          </h2>
          <p class="text-gray-400 mb-4">
            Quick reference for core SQL concepts and DuckDB-specific features.
          </p>

          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-gray-800 p-4 rounded-lg">
              <h3 class="text-blue-300 font-semibold mb-3">
                SQL Execution Order
              </h3>
              <ol
                class="list-decimal list-inside space-y-1 text-sm text-gray-300"
              >
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">FROM</code> /
                  <code class="bg-gray-700 px-2 py-1 rounded">JOIN</code> -
                  Assemble data
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">WHERE</code> -
                  Filter rows
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">GROUP BY</code> -
                  Group rows
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">HAVING</code> -
                  Filter groups
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">SELECT</code> -
                  Choose columns
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">DISTINCT</code> -
                  Remove duplicates
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">ORDER BY</code> -
                  Sort results
                </li>
                <li>
                  <code class="bg-gray-700 px-2 py-1 rounded">LIMIT</code> -
                  Restrict rows
                </li>
              </ol>
            </div>

            <div class="bg-gray-800 p-4 rounded-lg">
              <h3 class="text-blue-300 font-semibold mb-3">
                Common Data Types
              </h3>
              <div class="space-y-2 text-sm">
                <div>
                  <code class="text-blue-400">INTEGER</code> - Whole numbers
                </div>
                <div>
                  <code class="text-blue-400">VARCHAR</code> - Variable-length
                  text
                </div>
                <div>
                  <code class="text-blue-400">DECIMAL(p,s)</code> - Fixed-point
                  numbers
                </div>
                <div>
                  <code class="text-blue-400">BOOLEAN</code> - True/false values
                </div>
                <div><code class="text-blue-400">DATE</code> - Date values</div>
                <div>
                  <code class="text-blue-400">TIMESTAMP</code> - Date and time
                </div>
                <div>
                  <code class="text-blue-400">SERIAL</code> - Auto-incrementing
                  integer
                </div>
              </div>
            </div>
          </div>

          <div
            class="mt-6 bg-blue-900/20 border border-blue-700 rounded-lg p-4"
          >
            <h3 class="text-blue-300 font-semibold mb-2"> Learn More</h3>
            <p class="text-blue-200 text-sm mb-2">
              This playground covers essential SQL concepts with DuckDB. For
              advanced features and complete documentation:
            </p>
            <a
              href="https://duckdb.org/docs/stable/sql/introduction"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-400 hover:underline text-sm"
              > DuckDB Official Documentation</a
            >
          </div>
        
</section><script type="module">
      import * as duckdb from "https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/+esm";

      document.addEventListener("DOMContentLoaded", async () => {
        const editor = CodeMirror.fromTextArea(
          document.getElementById("sql-editor"),
          {
            mode: "text/x-sql",
            theme: "material-darker",
            lineNumbers: true,
            autofocus: true,
            value: `-- Welcome to your SQL Playground!
-- Click 'Examples' to find commands.

CREATE TABLE books (
  id INTEGER,
  title VARCHAR,
  author VARCHAR,
  published_year INTEGER
);

INSERT INTO books VALUES (1, '1984', 'George Orwell', 1949);

SELECT * FROM books;`,
          }
        );

        const runQueryBtn = document.getElementById("run-query-btn");
        const schemaViewer = document.getElementById("schema-viewer");
        const resultsContainer = document.getElementById("results-container");
        const statusIndicator = document.getElementById("status-indicator");
        const statusText = document.getElementById("status-text");
        const playgroundView = document.getElementById("playground-view");
        const examplesView = document.getElementById("examples-view");
        const leftPanel = document.getElementById("left-panel");
        const rightPanel = document.getElementById("right-panel");
        const schemaContent = document.getElementById("schema-content");
        const visualizationContent = document.getElementById(
          "visualization-content"
        );
        const outputContent = document.getElementById("output-content");
        const schemaDiagram = document.getElementById("schema-diagram");

        let db_connection;
        runQueryBtn.disabled = true;

        try {
          const JSDELIVR_BUNDLES = duckdb.getJsDelivrBundles();
          const bundle = await duckdb.selectBundle(JSDELIVR_BUNDLES);
          const worker_url = URL.createObjectURL(
            new Blob([`importScripts("${bundle.mainWorker}");`], {
              type: "text/javascript",
            })
          );
          const worker = new Worker(worker_url);
          const logger = new duckdb.ConsoleLogger();
          const db = new duckdb.AsyncDuckDB(logger, worker);
          await db.instantiate(bundle.mainModule, bundle.pthreadWorker);
          URL.revokeObjectURL(worker_url);
          db_connection = await db.connect();

          statusIndicator.classList.replace("bg-yellow-500", "bg-green-500");
          statusIndicator.classList.remove("animate-pulse");
          statusText.textContent = "Database Ready";
          runQueryBtn.disabled = false;
        } catch (e) {
          console.error("DuckDB initialization failed:", e);
          statusIndicator.classList.replace("bg-yellow-500", "bg-red-500");
          statusIndicator.classList.remove("animate-pulse");
          statusText.textContent = "DB Failed to Load";
          resultsContainer.innerHTML = `<div class="p-3 text-sm text-red-400 bg-red-900 rounded-md"><strong>Fatal Error:</strong> Could not initialize the in-browser database. ${e.message}</div>`;
        }

        const renderTable = (data, container) => {
          if (!data || data.length === 0) {
            container.innerHTML = `<p class="text-gray-400">Query executed successfully, but returned no rows.</p>`;
            return;
          }
          const headers = Object.keys(data[0]);
          let tableHTML = `<div class="overflow-x-auto custom-scrollbar"><table class="w-full text-sm text-left text-gray-400"><thead class="text-xs text-gray-300 uppercase bg-gray-700"><tr>`;
          headers.forEach(
            (h) =>
              (tableHTML += `<th scope="col" class="px-4 py-2 whitespace-nowrap">${h}</th>`)
          );
          tableHTML += `</tr></thead><tbody>`;
          data.forEach((row) => {
            tableHTML += `<tr class="border-b bg-gray-800 border-gray-700">`;
            headers.forEach((h) => {
              let value = row[h];
              if (typeof value === "bigint") value = value.toString();
              if (value === null) value = "NULL";
              tableHTML += `<td class="px-4 py-2 whitespace-nowrap">${value}</td>`;
            });
            tableHTML += `</tr>`;
          });
          tableHTML += `</tbody></table></div>`;
          container.innerHTML = tableHTML;
        };

        const updateSchemaViewer = async () => {
          if (!db_connection) return;
          try {
            const tablesArrow = await db_connection.query(`SHOW TABLES;`);
            const tables = tablesArrow.toArray().map((row) => row.toJSON());

            if (tables.length === 0) {
              schemaViewer.innerHTML = `<p class="text-gray-500 text-sm">No tables found. Run a 'CREATE TABLE' statement to begin.</p>`;
              updateVisualization([]);
              return;
            }

            let schemaHTML = '<div class="space-y-4">';
            const tableInfo = [];

            for (const table of tables) {
              const tableName = table.name;
              schemaHTML += `<div class="bg-gray-800 p-3 rounded-md">`;
              schemaHTML += `<h3 class="font-semibold text-teal-400 font-mono">${tableName}</h3>`;

              const columnsArrow = await db_connection.query(
                `PRAGMA table_info('${tableName}');`
              );
              const columns = columnsArrow.toArray().map((row) => row.toJSON());

              schemaHTML += `<ul class="text-xs text-gray-400 mt-2 pl-3 space-y-1">`;
              columns.forEach((col) => {
                let badge = "";
                if (col.pk)
                  badge += '<span class="text-yellow-400 text-xs">PK</span> ';
                if (col.notnull)
                  badge +=
                    '<span class="text-blue-400 text-xs">NOT NULL</span> ';
                schemaHTML += `<li><span class="font-mono">${col.name}</span> <span class="text-gray-500">${col.type}</span> ${badge}</li>`;
              });
              schemaHTML += `</ul></div>`;

              tableInfo.push({ name: tableName, columns: columns });
            }
            schemaHTML += "</div>";
            schemaViewer.innerHTML = schemaHTML;
            updateVisualization(tableInfo);
          } catch (e) {
            console.error("Failed to update schema:", e);
            schemaViewer.innerHTML = `<p class="text-red-400 text-sm">Error fetching schema.</p>`;
            updateVisualization([]);
          }
        };

        const updateVisualization = (tableInfo) => {
          if (tableInfo.length === 0) {
            schemaDiagram.innerHTML = `
                        <div class="flex items-center justify-center h-full text-gray-500">
                            <div class="text-center">
                                <div class="text-4xl mb-4"></div>
                                <p>No tables to visualize</p>
                                <p class="text-sm mt-2">Create some tables to see the schema diagram</p>
                            </div>
                        </div>
                    `;
            return;
          }

          let diagramHTML = `
                    <div class="space-y-6">
                        <div class="text-center mb-6">
                            <h4 class="text-lg font-semibold text-gray-200">E-Commerce Database Schema</h4>
                            <p class="text-sm text-gray-400">Relational structure with foreign key relationships</p>
                        </div>
                `;

          // Create visual representation of tables
          tableInfo.forEach((table, index) => {
            const isEven = index % 2 === 0;
            diagramHTML += `
                        <div class="bg-gray-700 rounded-lg p-4 border-l-4 ${getTableColor(
                          table.name
                        )}" style="margin-left: ${isEven ? "0" : "40px"}">
                            <div class="flex items-center mb-2">
                                <div class="w-3 h-3 ${getTableIconColor(
                                  table.name
                                )} rounded-full mr-2"></div>
                                <h4 class="font-bold text-gray-100 font-mono">${
                                  table.name
                                }</h4>
                            </div>
                            <div class="grid gap-1">
                    `;

            table.columns.forEach((col) => {
              let typeColor = "text-blue-300";
              if (col.type.includes("INTEGER") || col.type.includes("SERIAL"))
                typeColor = "text-green-300";
              else if (
                col.type.includes("VARCHAR") ||
                col.type.includes("TEXT")
              )
                typeColor = "text-yellow-300";
              else if (col.type.includes("DECIMAL"))
                typeColor = "text-purple-300";
              else if (
                col.type.includes("DATE") ||
                col.type.includes("TIMESTAMP")
              )
                typeColor = "text-pink-300";

              diagramHTML += `
                            <div class="flex justify-between items-center text-sm py-1 px-2 rounded ${
                              col.pk ? "bg-yellow-900/30" : ""
                            }">
                                <span class="font-mono text-gray-200">${
                                  col.name
                                }</span>
                                <div class="flex items-center gap-2">
                                    <span class="${typeColor} text-xs">${
                col.type
              }</span>
                                    ${
                                      col.pk
                                        ? '<span class="bg-yellow-600 text-yellow-100 px-1 rounded text-xs">PK</span>'
                                        : ""
                                    }
                                    ${
                                      col.name.includes("_id") && !col.pk
                                        ? '<span class="bg-blue-600 text-blue-100 px-1 rounded text-xs">FK</span>'
                                        : ""
                                    }
                                </div>
                            </div>
                        `;
            });

            diagramHTML += `
                            </div>
                        </div>
                    `;
          });

          // Add relationship indicators
          diagramHTML += `
                    <div class="mt-6 p-4 bg-gray-700 rounded-lg">
                        <h5 class="font-semibold text-gray-200 mb-3"> Relationships</h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                                <span class="text-gray-300">customers.customer_id  orders.customer_id</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                <span class="text-gray-300">orders.order_id  order_items.order_id</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <span class="text-gray-300">products.product_id  order_items.product_id</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                <span class="text-gray-300">categories.category_id  products.category_id</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 bg-gray-700 rounded-lg">
                        <h5 class="font-semibold text-gray-200 mb-3"> Schema Insights</h5>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <div class="font-medium text-gray-300">Tables: ${
                                  tableInfo.length
                                }</div>
                                <div class="text-gray-400">Total columns: ${tableInfo.reduce(
                                  (sum, table) => sum + table.columns.length,
                                  0
                                )}</div>
                            </div>
                            <div>
                                <div class="font-medium text-gray-300">Relationships: ${
                                  tableInfo.filter((t) =>
                                    t.columns.some(
                                      (c) => c.name.includes("_id") && !c.pk
                                    )
                                  ).length
                                }</div>
                                <div class="text-gray-400">Primary keys: ${
                                  tableInfo.filter((t) =>
                                    t.columns.some((c) => c.pk)
                                  ).length
                                }</div>
                            </div>
                        </div>
                    </div>
                </div>
                `;

          schemaDiagram.innerHTML = diagramHTML;
        };

        const getTableColor = (tableName) => {
          const colors = {
            customers: "border-yellow-400",
            orders: "border-blue-400",
            order_items: "border-green-400",
            products: "border-purple-400",
            categories: "border-pink-400",
          };
          return colors[tableName] || "border-gray-400";
        };

        const getTableIconColor = (tableName) => {
          const colors = {
            customers: "bg-yellow-400",
            orders: "bg-blue-400",
            order_items: "bg-green-400",
            products: "bg-purple-400",
            categories: "bg-pink-400",
          };
          return colors[tableName] || "bg-gray-400";
        };

        const handleRunQuery = async () => {
          if (!db_connection || runQueryBtn.disabled) return;

          const userQuery = editor.getValue();
          if (userQuery.trim() === "") {
            resultsContainer.innerHTML = `<p class="text-gray-500 text-sm">Editor is empty. Please enter a SQL query.</p>`;
            return;
          }

          runQueryBtn.disabled = true;
          resultsContainer.innerHTML = `<p class="text-yellow-400 text-sm">Executing query...</p>`;

          try {
            const resultArrow = await db_connection.query(userQuery);
            const results = resultArrow.toArray().map((row) => row.toJSON());

            if (resultArrow.numRows > 0) {
              renderTable(results, resultsContainer);
            } else {
              resultsContainer.innerHTML = `<div class="p-3 text-sm text-green-400 bg-green-900 rounded-md"><strong>Success!</strong> Query executed with no errors.</div>`;
            }
          } catch (e) {
            resultsContainer.innerHTML = `<div class="p-3 text-sm text-red-400 bg-red-900 rounded-md"><strong>Error:</strong> ${e.message}</div>`;
          } finally {
            runQueryBtn.disabled = false;
            await updateSchemaViewer();
            if (window.innerWidth <= 768) {
              showMobilePlaygroundView("output");
            }
          }
        };

        runQueryBtn.addEventListener("click", handleRunQuery);
        editor.setOption("extraKeys", {
          "Ctrl-Enter": handleRunQuery,
          "Cmd-Enter": handleRunQuery,
        });

        const headerTabs = document.querySelectorAll(".header-tab");
        const mobileNavButtons = document.querySelectorAll(".mobile-nav-btn");

        const showMainView = (viewName) => {
          playgroundView.style.display =
            viewName === "playground" ? "flex" : "none";
          examplesView.style.display =
            viewName === "examples" ? "flex" : "none";

          headerTabs.forEach((tab) => {
            const isActive = tab.dataset.view === viewName;
            tab.classList.toggle("active", isActive);
            tab.classList.toggle("text-gray-400", !isActive);
            tab.classList.toggle("border-transparent", !isActive);
          });

          mobileNavButtons.forEach((btn) => {
            if (btn.dataset.view === "examples") {
              btn.classList.toggle("active", viewName === "examples");
            }
          });

          if (viewName === "playground") {
            setTimeout(() => editor.refresh(), 1);
          }
        };

        const showMobilePlaygroundView = (viewName) => {
          leftPanel.style.display = viewName === "editor" ? "flex" : "none";

          if (viewName === "output") {
            rightPanel.style.display = "flex";
            // Ensure results are shown in mobile output view
            schemaContent.classList.add("hidden");
            visualizationContent.classList.add("hidden");
            outputContent.classList.remove("hidden");
          } else if (viewName === "schema") {
            rightPanel.style.display = "flex";
            // Show schema content in fullscreen mobile mode
            schemaContent.classList.remove("hidden");
            visualizationContent.classList.add("hidden");
            outputContent.classList.add("hidden");
          } else if (viewName === "visualization") {
            rightPanel.style.display = "flex";
            // Show visualization content in fullscreen mobile mode
            schemaContent.style.display = "block";
            visualizationContent.style.display = "block";
            outputContent.classList.add("hidden");

            // Make schema/viz area take full height on mobile
            schemaContent.style.height = "calc(100vh - 200px)";
            visualizationContent.style.height = "calc(100vh - 200px)";
          } else {
            rightPanel.style.display = "none";
          }

          mobileNavButtons.forEach((btn) => {
            if (
              btn.dataset.view === "editor" ||
              btn.dataset.view === "output" ||
              btn.dataset.view === "schema" ||
              btn.dataset.view === "visualization"
            ) {
              btn.classList.toggle("active", btn.dataset.view === viewName);
            }
          });

          if (viewName === "editor") {
            setTimeout(() => editor.refresh(), 1);
          }
        };

        const handleViewChange = (view) => {
          if (
            view === "editor" ||
            view === "output" ||
            view === "visualization" ||
            view === "schema"
          ) {
            showMainView("playground");
            showMobilePlaygroundView(view);
          } else if (view === "examples") {
            showMainView("examples");
          } else if (view === "playground") {
            showMainView("playground");
            showMobilePlaygroundView("editor");
          }
        };

        headerTabs.forEach((tab) =>
          tab.addEventListener("click", () =>
            handleViewChange(tab.dataset.view)
          )
        );
        mobileNavButtons.forEach((btn) =>
          btn.addEventListener("click", () =>
            handleViewChange(btn.dataset.view)
          )
        );

        const resizer = document.getElementById("resizer");
        resizer.addEventListener("mousedown", (e) => {
          e.preventDefault();
          document.addEventListener("mousemove", handleMouseMove);
          document.addEventListener("mouseup", () => {
            document.removeEventListener("mousemove", handleMouseMove);
            editor.refresh();
          });
        });

        const handleMouseMove = (e) => {
          const totalWidth = playgroundView.offsetWidth;
          const newLeftWidth = (e.clientX / totalWidth) * 100;
          if (newLeftWidth > 20 && newLeftWidth < 80) {
            leftPanel.style.width = `${newLeftWidth}%`;
            rightPanel.style.width = `${100 - newLeftWidth}%`;
          }
        };

        const checkLayout = () => {
          if (window.innerWidth <= 768) {
            const currentPlaygroundView = document
              .querySelector('.mobile-nav-btn[data-view="editor"]')
              .classList.contains("active")
              ? "editor"
              : document
                  .querySelector('.mobile-nav-btn[data-view="output"]')
                  .classList.contains("active")
              ? "output"
              : document
                  .querySelector('.mobile-nav-btn[data-view="visualization"]')
                  .classList.contains("active")
              ? "visualization"
              : "editor";
            const currentMainViewIsPlayground =
              playgroundView.style.display !== "none";
            if (currentMainViewIsPlayground)
              showMobilePlaygroundView(currentPlaygroundView);
          } else {
            showMainView(
              document.querySelector(".header-tab.active")?.dataset.view ||
                "playground"
            );
            leftPanel.style.display = "flex";
            rightPanel.style.display = "flex";

            // Reset mobile-specific styles
            schemaContent.style.height = "";
            visualizationContent.style.height = "";
          }
        };

        window.addEventListener("resize", checkLayout);

        await updateSchemaViewer();
        checkLayout();
        hljs.highlightAll();

        // Copy example functionality
        const copyButtons = document.querySelectorAll(".copy-example");
        copyButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const example = button.dataset.example;
            if (example) {
              editor.setValue(example);
              editor.focus();

              // Visual feedback
              button.classList.add("copied");
              setTimeout(() => {
                button.classList.remove("copied");
              }, 2000);

              // Switch to playground view on mobile
              if (window.innerWidth <= 768) {
                showMainView("playground");
                showMobilePlaygroundView("editor");
              } else {
                showMainView("playground");
              }
            }
          });
        });

        // Schema tab functionality
        const schemaTabs = document.querySelectorAll(".schema-tab");
        schemaTabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            const isSchemaTab = tab.id === "schema-tab";
            const isVisualizationTab = tab.id === "visualization-tab";
            const isOutputTab = tab.id === "output-tab";

            // Update tab appearance
            schemaTabs.forEach((t) => {
              t.classList.remove("active", "border-blue-500", "text-blue-400");
              t.classList.add("border-transparent", "text-gray-400");
            });
            tab.classList.add("active", "border-blue-500", "text-blue-400");
            tab.classList.remove("border-transparent", "text-gray-400");

            // Show/hide content
            if (isSchemaTab) {
              schemaContent.classList.remove("hidden");
              visualizationContent.classList.add("hidden");
              outputContent.classList.add("hidden");
            } else if (isVisualizationTab) {
              schemaContent.classList.add("hidden");
              visualizationContent.classList.remove("hidden");
              outputContent.classList.add("hidden");
            } else if (isOutputTab) {
              schemaContent.classList.add("hidden");
              visualizationContent.classList.add("hidden");
              outputContent.classList.remove("hidden");
            }
          });
        });
      });
    </script>
  </body>
</html>
